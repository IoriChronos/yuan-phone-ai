/* å…¨å±€èƒŒæ™¯ï¼šä½é¥±å’Œæš—çº¢è‰² â†’ æ·±ç° */
:root {
    --bg-top: #1b1017;
    --bg-bottom: #050509;
    --glass: rgba(5, 6, 10, 0.82);
    --border: rgba(255, 255, 255, 0.12);
    --accent: #f4b6c4;
    --accent-soft: rgba(244, 182, 196, 0.18);
    --text-main: #f6f3f7;
    --text-sub: rgba(244, 243, 247, 0.72);
}

* {
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

/* é»˜è®¤ç¦æ­¢é€‰ä¸­æ–‡æœ¬ */
html, body, #app {
    -webkit-user-select: none;
    user-select: none;
}

/* åªå…è®¸å¯¹è¯æ°”æ³¡ä¸­çš„æ–‡å­—å¯é€‰ */
.story-bubble {
    -webkit-user-select: text;
    user-select: text;
}

body {
    margin: 0;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    color: var(--text-main);
    background: radial-gradient(circle at 0% 0%, #25121c, transparent 55%),
                radial-gradient(circle at 100% 100%, #1a101c, transparent 55%),
                linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    display: flex;
    justify-content: center;
    align-items: stretch;
    overflow: hidden;          /* ğŸ”’ é”ä½æ•´é¡µæ»šåŠ¨æ¡ */
}

/* å¤–å±‚å¸ƒå±€ï¼šPC ä¸Šå·¦å³æ’åˆ—ï¼Œæ‰‹æœºä¸Šä¸Šä¸‹æ’åˆ— */
#app {
    width: 100%;  
    height: 100%;              /* å¡«æ»¡ body */
    padding: 14px;
    display: flex;
    gap: 14px;
    align-items: stretch;
}

body.mobile-mode #app {
    flex-direction: column;
}

/* å‰§æƒ…ä¸»é¢æ¿ */
#story-panel {
    flex: 1;
    min-height: 80vh;
    border-radius: 22px;
    padding: 14px 14px 16px;
    position: relative;
    z-index: 1;
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 65%),
        radial-gradient(circle at 60% 60%, rgba(200, 80, 110, 0.18), transparent 65%),
        linear-gradient(180deg, #2a0f18 0%, #090609 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    display: flex;
    flex-direction: column;
}

#story-header {
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    margin-bottom: 10px;
}

.story-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.06em;
}

.story-subtitle {
    margin-top: 4px;
    font-size: 12px;
    color: var(--text-sub);
}

/* å‰§æƒ…å†…å®¹åŒº + è¾“å…¥åŒº */
#story-log {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    position: relative;
    width: 100%;
    z-index: 5;
}

/* éšè—æ»šåŠ¨æ¡æ ·å¼ */
#story-log::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-log {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.story-bubble {
    position: relative;
    margin: 0;
    padding: 12px 18px;
    border-radius: 26px;
    font-size: 13px;
    line-height: 1.4;
    width: auto;
    max-width: 88%;
    border: none;
    min-width: fit-content;
    background:
        radial-gradient(circle at 10% 20%, rgba(255,160,200,0.08), transparent 60%),
        radial-gradient(circle at 80% 60%, rgba(140,140,255,0.05), transparent 65%),
        linear-gradient(150deg, rgba(15,10,16,0.96), rgba(20,12,18,0.7));
    box-shadow: 0 0 28px rgba(0,0,0,0.25);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    align-self: flex-start;
    display: inline-block;
    z-index: 1;
    overflow: visible;
    isolation: isolate;
}

.story-bubble.bubble-center {
    align-self: center;
    text-align: center;
}

.story-bubble .bubble-content {
    position: relative;
    z-index: 4;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-bubble.bubble-user {
    align-self: flex-end;
    background: linear-gradient(135deg, rgba(50,25,35,0.95), rgba(25,12,20,0.7));
    color: #fef8ff;
    text-align: right;
    box-shadow: 0 0 30px rgba(255,160,190,0.18);
}

.story-bubble.bubble-assistant {
    align-self: flex-start;
    color: #f7f4fa;
    text-align: left;
}

.story-bubble.dialog-short {
    padding: 12px 16px;
    box-shadow: 0 0 22px rgba(255,170,205,0.12);
}

.story-bubble.dialog-long {
    background: linear-gradient(150deg, rgba(12,8,12,0.92), rgba(6,4,8,0.82));
    box-shadow: 0 0 18px rgba(0,0,0,0.32);
}

.story-bubble.bubble-thought {
    max-width: 70%;
    color: #f2d4ff;
    background:
        radial-gradient(circle at 20% 20%, rgba(150,80,200,0.18), transparent 70%),
        linear-gradient(150deg, rgba(32,10,40,0.85), rgba(12,6,18,0.75));
    box-shadow: 0 15px 35px rgba(110,40,150,0.25);
    position: relative;
}

.story-bubble.bubble-thought::after {
    content: "";
    position: absolute;
    inset: 10% 16%;
    border-radius: 40%;
    border: 1px solid rgba(255,190,255,0.2);
    filter: blur(8px);
    opacity: 0.6;
    animation: thoughtPulse 4s ease-in-out infinite;
}

.story-bubble.bubble-thought + .story-bubble.bubble-thought {
    margin-top: 14px;
}

.story-bubble.bubble-narration {
    max-width: 80%;
    color: #ffe5d6;
    background:
        radial-gradient(circle at 15% 30%, rgba(255,190,205,0.08), transparent 55%),
        radial-gradient(circle at 80% 60%, rgba(70,20,40,0.25), transparent 65%),
        linear-gradient(135deg, rgba(28,12,20,0.92), rgba(8,4,10,0.78));
    border: 1px solid rgba(255,255,255,0.05);
    align-self: flex-start;
    text-align: left;
}

.story-bubble.bubble-narration + .story-bubble.bubble-narration {
    margin-top: 6px;
}

.story-bubble.bubble-system-input {
    border: 1px dashed rgba(255,200,210,0.25);
    box-shadow: 0 0 24px rgba(255,150,190,0.18);
}

.bubble-system-chip {
    position: absolute;
    top: -11px;
    left: 18px;
    font-size: 10px;
    letter-spacing: 0.18em;
    color: rgba(255,220,240,0.8);
    text-transform: uppercase;
    z-index: 5;
}

.story-bubble.bubble-user .bubble-system-chip {
    left: auto;
    right: 18px;
}

.story-bubble.bubble-action {
    color: #ffe1e1;
    background: linear-gradient(145deg, rgba(70,10,24,0.95), rgba(35,6,18,0.8));
    box-shadow: 0 12px 32px rgba(120,30,50,0.3);
}

.story-bubble.dialogue {
    max-width: 75%;
    border-radius: 26px;
    padding: 12px 20px;
    line-height: 1.55;
    color: #f7f4ff;
    background: rgba(15,12,18,0.72);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:
        0 0 10px rgba(80,130,255,0.12),
        inset 0 0 6px rgba(255,255,255,0.04);
    text-align: left;
}

.story-bubble.dialogue .bubble-content {
    animation: dialogueBreath 3.2s ease-in-out infinite;
}

.story-bubble.dialogue-tight {
    letter-spacing: 0.04em;
    font-size: 13.2px;
}

.story-bubble.dialogue-normal {
    background:
        radial-gradient(circle at 30% 20%, rgba(140,100,160,0.12), transparent 60%),
        linear-gradient(140deg, rgba(18,10,24,0.85), rgba(6,4,12,0.7));
}

.story-bubble.dialogue-whisper-dark {
    padding-top: 18px;
    padding-bottom: 18px;
}

.story-bubble.dialogue-intim {
    padding-top: 16px;
    padding-bottom: 16px;
}

.story-bubble.dialogue-low {
    background:
        radial-gradient(circle at 80% 50%, rgba(255,190,220,0.1), transparent 70%),
        linear-gradient(150deg, rgba(15,10,18,0.76), rgba(4,2,8,0.6));
    border-color: rgba(255,255,255,0.04);
    color: rgba(247,244,255,0.85);
    box-shadow: 0 0 14px rgba(255,190,220,0.16);
}

.story-bubble.dialogue-low .bubble-content {
    animation-duration: 3.8s;
}

.story-bubble.dialogue-command {
    background:
        radial-gradient(circle at 15% 40%, rgba(255,110,150,0.2), transparent 65%),
        linear-gradient(145deg, rgba(26,8,12,0.9), rgba(6,4,6,0.78));
    border-color: rgba(255,120,150,0.28);
    box-shadow:
        0 0 18px rgba(255,70,110,0.25),
        inset 0 0 6px rgba(255,160,160,0.08);
}

.story-bubble.dialogue-threat {
    background:
        radial-gradient(circle at 40% 50%, rgba(180,20,40,0.18), transparent 70%),
        linear-gradient(150deg, rgba(8,0,0,0.88), rgba(6,0,0,0.72));
    border-color: rgba(255,80,100,0.35);
    color: #ffd9d9;
    box-shadow:
        0 0 20px rgba(255,30,60,0.22),
        inset 0 0 10px rgba(255,120,120,0.08);
}

.story-bubble.dialogue-intim {
    background:
        radial-gradient(circle at 65% 70%, rgba(255,200,150,0.15), transparent 75%),
        linear-gradient(140deg, rgba(40,6,22,0.9), rgba(18,4,16,0.78));
    border-color: rgba(255,200,160,0.28);
    box-shadow:
        0 0 18px rgba(255,180,150,0.2),
        inset 0 0 12px rgba(255,255,255,0.08);
}

.story-bubble.dialogue-whisper-dark {
    background:
        radial-gradient(circle at 60% 30%, rgba(60,20,80,0.25), transparent 80%),
        linear-gradient(160deg, rgba(6,2,10,0.9), rgba(2,0,6,0.8));
    border-color: rgba(130,110,200,0.28);
    color: #e4ddff;
    filter: drop-shadow(0 0 16px rgba(80,40,120,0.35));
}

.story-bubble.dialogue .bubble-particle {
    background: radial-gradient(circle, rgba(170,200,255,0.35), transparent 80%);
}

.story-bubble.dialogue-threat .bubble-particle {
    background: radial-gradient(circle, rgba(255,120,120,0.45), transparent 80%);
}

.story-bubble.dialogue-intim .bubble-particle {
    background: radial-gradient(circle, rgba(255,210,150,0.45), transparent 80%);
}

.story-bubble.dialogue-whisper-dark .bubble-particle {
    background: radial-gradient(circle, rgba(150,110,200,0.45), transparent 80%);
}

@keyframes dialogueBreath {
    0%, 100% { opacity: 0.95; }
    50% { opacity: 1; }
}

@keyframes thoughtPulse {
    0% { transform: scale(0.95); opacity: 0.4; }
    50% { transform: scale(1.05); opacity: 0.7; }
    100% { transform: scale(0.95); opacity: 0.4; }
}

.story-bubble.bubble-system {
    align-self: center;
    display: block;
    padding: 10px 22px;
    max-width: 60%;
    font-size: 12px;
    border-radius: 999px;
    background: linear-gradient(160deg, rgba(12,8,18,0.85), rgba(10,6,12,0.78));
    color: #dcd7ff;
    text-align: center;
    position: relative;
    overflow: visible;
    border: 1px dashed rgba(255,255,255,0.25);
}

.bubble-system .system-icon {
    position: absolute;
    width: 22px;
    height: 22px;
    image-rendering: pixelated;
    top: var(--icon-offset-y, -12px);
    pointer-events: none;
    filter: drop-shadow(0 0 6px rgba(0,0,0,0.35));
}

.bubble-system .system-icon[data-side="left"] {
    left: -20px;
}

.bubble-system .system-icon[data-side="right"] {
    right: -20px;
}

.bubble-cutout {
    position: absolute;
    width: var(--cut-size, 40px);
    height: var(--cut-size, 40px);
    border-radius: 50%;
    left: var(--cut-left, 10%);
    top: var(--cut-top, 10%);
    border: 1px solid rgba(255,255,255,0.05);
    background: rgba(0,0,0,0.65);
    box-shadow: 0 0 12px rgba(0,0,0,0.7);
    opacity: 0.85;
    mix-blend-mode: destination-out;
    pointer-events: none;
}

.bubble-cutout.ring {
    mix-blend-mode: screen;
    background: radial-gradient(circle, transparent 55%, rgba(255,255,255,0.16) 60%, transparent 78%);
    box-shadow: inset 0 0 18px rgba(255,255,255,0.1);
}

.story-block {
    width: 100%;
    max-width: 100%;
    align-self: stretch;
    margin: 0;
    padding: 0 2%;
    font-size: 14px;
    line-height: 1.4;
    color: #f6f0f5;
    -webkit-user-select: text;
    user-select: text;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-block.block-narration.block-bare {
    padding: 2px 0;
    background: none;
    color: #ffe6d2;
}

.story-block.block-narration.block-bare p {
    text-align: left;
    margin: 4px 0;
}

.story-block.block-reading {
    line-height: 1.65;
}

.story-block.block-key {
    text-align: center;
}

.poetic-line {
    display: block;
    letter-spacing: 0.08em;
}

.story-block p {
    margin: 0 0 6px;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-block p:last-child {
    margin-bottom: 0;
}

.narration-paragraph {
    text-align: left;
    letter-spacing: 0.02em;
}

.paragraph-ambient {
    font-style: italic;
    color: #f3d7ff;
}

.paragraph-soft {
    font-style: italic;
    color: #ffe7cf;
}

.story-block .key-sentence {
    text-align: center;
    font-size: 15px;
    color: #ffe4c7;
    text-shadow: 0 0 8px rgba(255,220,190,0.35);
    display: block;
    margin: 0 auto;
}

.thought-line {
    text-align: center;
    letter-spacing: 0.04em;
}

.sound-line {
    animation: soundGlow 2.8s ease-in-out infinite;
    color: #ffd3e1;
}

@keyframes soundGlow {
    0% { text-shadow: 0 0 6px rgba(255,150,200,0.2); }
    50% { text-shadow: 0 0 12px rgba(255,150,200,0.5); }
    100% { text-shadow: 0 0 6px rgba(255,150,200,0.2); }
}

.quote-highlight {
    color: #ffe7c9;
    background: linear-gradient(120deg, rgba(255,233,210,0.7), rgba(255,132,173,0.6));
    -webkit-background-clip: text;
    color: transparent;
    animation: quoteGlow 2.6s ease-in-out infinite;
}

@keyframes quoteGlow {
    0%, 100% { filter: drop-shadow(0 0 4px rgba(255,210,200,0.4)); }
    50% { filter: drop-shadow(0 0 8px rgba(255,160,200,0.6)); }
}

.action-verb-highlight {
    color: #ff9487;
    font-weight: 600;
}

.keyword-highlight {
    color: #ffd7b1;
    text-shadow: 0 0 8px rgba(255,200,150,0.4);
}

.heartbeat-light {
    animation: heartbeatGlow 1.8s ease-in-out infinite;
}

@keyframes heartbeatGlow {
    0%, 100% { box-shadow: 0 0 8px rgba(255,120,170,0.25); }
    50% { box-shadow: 0 0 20px rgba(255,140,190,0.35); }
}

.goldPinkGradientText {
    background: linear-gradient(120deg, #ffe7d0, #ff94c2);
    -webkit-background-clip: text;
    color: transparent;
}

.key-sentence {
    display: inline-block;
    font-size: 1.02em;
    letter-spacing: 0.05em;
    color: #ffe9c0;
}

.kw-gaze,
.kw-close,
.kw-control,
.kw-rule,
.kw-env,
.kw-soft,
.kw-violence,
.kw-dread,
.kw-tech,
.kw-sense,
.kw-promise,
.em-strong {
    display: inline;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    line-height: inherit;
}

.em-strong {
    font-weight: 720;
    color: #ffe9b9;
    text-shadow: 0 0 6px rgba(255, 200, 160, 0.35);
}

.kw-gaze {
    color: #f0caa2;
    text-shadow: 0 0 6px rgba(255, 210, 160, 0.25);
}

.kw-close {
    background: linear-gradient(90deg, rgba(255,200,190,0.9), rgba(120,160,210,0.8));
    -webkit-background-clip: text;
    color: transparent;
    text-shadow: 0 0 6px rgba(250,170,200,0.2);
}

.kw-control {
    color: #ff8a9c;
    text-shadow: 0 0 4px rgba(255,70,90,0.4);
}

.kw-control:hover {
    text-shadow: 0 0 6px rgba(255,70,90,0.6);
}

.kw-rule {
    border-bottom: 1px dashed rgba(255,215,160,0.8);
    padding-bottom: 1px;
    transition: opacity 0.2s ease;
}

.kw-rule:hover {
    opacity: 0.8;
}

.kw-env {
    color: #c3c8ff;
    position: relative;
}

.kw-env::after {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(180deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 2px);
    opacity: 0.3;
    mix-blend-mode: screen;
    pointer-events: none;
}

.kw-soft {
    color: #ffe8c9;
}

.kw-violence {
    color: #ff6b6b;
    text-shadow: 0 0 6px rgba(255,0,0,0.35);
}

.kw-dread {
    color: #d4cbff;
    text-shadow: 0 0 8px rgba(110,90,200,0.35);
}

.kw-tech {
    color: #a4beff;
    text-shadow: 0 0 10px rgba(110,140,220,0.4);
}

.kw-sense {
    color: #ffe6cd;
}

.kw-promise {
    color: #ffd3b2;
    font-weight: 600;
    text-shadow: 0 0 6px rgba(255,190,150,0.35);
}

.italic-soft {
    font-style: italic;
    color: rgba(255, 215, 230, 0.9);
    text-shadow: 0 0 6px rgba(255, 150, 190, 0.25);
}

.strike-veil {
    position: relative;
    color: rgba(255,255,255,0.6);
}

.strike-veil::after {
    content: "";
    position: absolute;
    inset: 45% -6px -45%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    opacity: 0.4;
    animation: strikeMist 2.4s ease infinite;
}

@keyframes strikeMist {
    0% { transform: translateX(-20%); }
    50% { transform: translateX(20%); }
    100% { transform: translateX(-20%); }
}

.inline-code {
    font-family: inherit;
    color: inherit;
}

.story-bubble p {
    margin: 0 0 4px;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-bubble p:last-child {
    margin-bottom: 0;
}

/* è¾“å…¥è¡Œï¼šå›ºå®šåœ¨å‰§æƒ…åŒºåº•éƒ¨ï¼Œéšå®½åº¦è‡ªé€‚åº” */
#story-input-row {
    margin-top: auto;
    width: 100%;
    display: flex;
    align-items: flex-end;
    gap: 10px;
    position: relative;
    padding-top: 10px;
    z-index: 5;
}
/* å¤šè¡Œ textareaï¼Œæ–‡å­—å‚ç›´å±…ä¸­æ„Ÿ + è‡ªåŠ¨å¢é«˜ */
#story-input {
    flex: 1;
    padding: 10px 16px;
    border-radius: 16px;
    border: 1px solid rgba(255, 200, 220, 0.25);
    background: linear-gradient(180deg,
        rgba(60, 20, 35, 0.55),
        rgba(20, 12, 18, 0.85)
    );
    color: #f5e9f3;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    outline: none;

    min-height: 40px;     /* ä¸¤è¡Œè§†è§‰é«˜åº¦ */
    max-height: 70vh;     /* æœ€å¤§å±•å¼€é«˜åº¦ */
    overflow-y: auto;     /* å†…éƒ¨æ»šåŠ¨ï¼Œä½†æ¡éšè— */
    transition: border 0.2s ease, box-shadow 0.2s ease;
}

#story-input.system-mode {
    border-color: rgba(255, 220, 120, 0.6);
    box-shadow: 0 0 8px rgba(255, 220, 120, 0.25);
}

#story-input::-webkit-scrollbar {
    width: 0;
    height: 0;
}

.story-tools {
    position: relative;
    z-index: 12;
}

.story-tools-toggle {
    width: 40px;
    height: 36px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.18);
    background: linear-gradient(180deg, rgba(90,60,90,0.4), rgba(30,15,25,0.7));
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 3px;
    cursor: pointer;
    transition: border 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.story-tools-toggle .tool-bar {
    width: 14px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255,255,255,0.75);
}

.story-tools-toggle.active {
    border-color: rgba(255,200,150,0.6);
    box-shadow: 0 0 8px rgba(255,200,150,0.25);
    transform: translateY(-1px);
}

.story-tools-menu {
    position: absolute;
    bottom: 44px;
    right: 0;
    min-width: 170px;
    padding: 8px;
    border-radius: 16px;
    background: rgba(15,10,18,0.85);
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(14px);
    display: flex;
    flex-direction: column;
    gap: 6px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(6px) scale(0.98);
    transition: opacity 0.18s ease, transform 0.18s ease;
    z-index: 12;
}

.story-tools-menu.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

.story-tools-menu button {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 6px 10px;
    color: #f5e9f3;
    font-size: 12px;
    cursor: pointer;
}

.provider-control {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 6px 8px;
    font-size: 12px;
    color: rgba(255,255,255,0.75);
}

.provider-control select {
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.15);
    color: #f6eaf3;
    border-radius: 10px;
    padding: 4px 6px;
}

.memory-limit-control {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.03);
    font-size: 12px;
    color: rgba(255,255,255,0.75);
}

.memory-limit-control input[type="range"] {
    flex: 1;
    accent-color: rgba(255,180,200,0.9);
}

.memory-limit-control .memory-value {
    min-width: 20px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.icon-restart,
.icon-system {
    flex-shrink: 0;
}

.icon-restart {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255,255,255,0.8);
    border-radius: 50%;
    position: relative;
}

.icon-restart::after {
    content: "";
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    border-top: 2px solid rgba(255,255,255,0.8);
    border-right: 2px solid rgba(255,255,255,0.8);
    transform: rotate(45deg);
}

.icon-system {
    width: 18px;
    height: 18px;
    background:
        radial-gradient(circle, rgba(255,255,255,0.8) 20%, transparent 22%),
        conic-gradient(
            transparent 0deg 20deg,
            rgba(255,255,255,0.8) 20deg 40deg,
            transparent 40deg 60deg,
            rgba(255,255,255,0.8) 60deg 80deg,
            transparent 80deg 100deg,
            rgba(255,255,255,0.8) 100deg 120deg,
            transparent 120deg 140deg,
            rgba(255,255,255,0.8) 140deg 160deg,
            transparent 160deg 180deg,
            rgba(255,255,255,0.8) 180deg 200deg,
            transparent 200deg 220deg,
            rgba(255,255,255,0.8) 220deg 240deg,
            transparent 240deg 260deg,
            rgba(255,255,255,0.8) 260deg 280deg,
            transparent 280deg 300deg,
            rgba(255,255,255,0.8) 300deg 320deg,
            transparent 320deg 360deg
        );
    border-radius: 50%;
}

.restart-sheet {
    position: absolute;
    inset: 0;
    background: rgba(5,5,8,0.55);
    display: flex;
    justify-content: center;
    align-items: flex-end;
    padding: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 10;
}

.restart-sheet.show {
    opacity: 1;
    pointer-events: auto;
}

.restart-sheet .sheet-content {
    width: 100%;
    max-width: 320px;
    padding: 16px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(20,10,16,0.9);
    backdrop-filter: blur(12px);
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.restart-sheet .sheet-content p {
    margin: 0 0 6px;
    color: rgba(255,255,255,0.8);
    font-size: 13px;
    letter-spacing: 0.1em;
}

.restart-sheet button {
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.08);
    color: #f5e9f3;
    padding: 8px 12px;
    font-size: 13px;
    cursor: pointer;
}

.restart-sheet button.ghost {
    background: transparent;
}

.story-edit-sheet {
    position: absolute;
    inset: 0;
    background: rgba(5,5,8,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 15;
    backdrop-filter: blur(6px);
}

.story-edit-sheet.show {
    display: flex;
}

.story-edit-sheet .edit-panel {
    width: min(520px, 90%);
    background: rgba(15,10,18,0.95);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 24px;
    padding: 18px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.story-edit-sheet p {
    margin: 0;
    font-size: 14px;
    color: #f7f1f6;
    letter-spacing: 0.1em;
}

.story-edit-sheet textarea {
    width: 100%;
    min-height: 120px;
    resize: vertical;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(12,8,14,0.8);
    color: #f5e9f3;
    padding: 12px;
    font-size: 13px;
    line-height: 1.65;
    outline: none;
}

.story-edit-sheet textarea:focus {
    border-color: rgba(255,200,190,0.5);
    box-shadow: 0 0 12px rgba(255,200,190,0.15);
}

.story-edit-sheet .edit-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.story-edit-sheet button {
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: #f5e9f3;
    padding: 8px 18px;
    font-size: 13px;
    cursor: pointer;
}

.story-edit-sheet button.ghost {
    background: transparent;
}

.character-sheet {
    position: absolute;
    left: 16px;
    right: 16px;
    top: calc(60px + 8px);
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(10,6,12,0.92);
    backdrop-filter: blur(10px);
    transition: max-height 0.35s ease, opacity 0.35s ease;
    pointer-events: none;
    z-index: 6;
}

.character-sheet.show {
    max-height: 60%;
    opacity: 1;
    pointer-events: auto;
}

.character-sheet .sheet-inner {
    max-height: 100%;
    overflow-y: auto;
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.character-sheet h3 {
    margin: 0;
    font-size: 15px;
    letter-spacing: 0.1em;
}

.character-sheet p {
    margin: 0;
    font-size: 13px;
    line-height: 1.6;
    color: rgba(245, 233, 243, 0.92);
}

.character-sheet button {
    align-self: flex-end;
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 999px;
    background: transparent;
    color: #f5e9f3;
    padding: 4px 12px;
    font-size: 12px;
    cursor: pointer;
}

.story-reply-divider {
    width: 100%;
    text-align: center;
    color: rgba(255,255,255,0.35);
    font-size: 11px;
    letter-spacing: 0.16em;
    margin: 4px 0;
    position: relative;
}

.story-reply-divider::before,
.story-reply-divider::after {
    content: "";
    position: absolute;
    top: 50%;
    width: 35%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15));
}

.story-reply-divider::before {
    left: 0;
}

.story-reply-divider::after {
    right: 0;
    transform: scaleX(-1);
}

.story-reply-divider span {
    padding: 0 10px;
    background: transparent;
}

.continue-btn {
    padding: 6px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.16);
    backdrop-filter: blur(8px);
    font-size: 12px;
    cursor: pointer;
    margin-left: 12px;
    margin-right: auto;
    margin-top: 6px;
    align-self: flex-start;
    animation: pulse 2.4s infinite ease-in-out;
}

.continue-btn.align-left {
    margin-left: 0;
}

@keyframes pulse {
    0% { opacity: .7; }
    50% { opacity: 1; }
    100% { opacity: .7; }
}

.bold-emphasis {
    font-weight: 780;
    background: linear-gradient(
        to bottom,
        #ffead4 0%,
        #ffb6c4 100%
    );
    -webkit-background-clip: text;
    color: transparent;
    filter: drop-shadow(0 0 6px rgba(255, 140, 170, 0.45));
    transition: all .25s ease;
    display: inline;
    animation: boldShimmer 2.2s ease-in-out infinite;
}

@keyframes boldShimmer {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.88; }
}

.action-bubble .bold-emphasis {
    filter: drop-shadow(0 0 10px rgba(255, 80, 100, .65));
}

.thought-bubble .bold-emphasis {
    filter: drop-shadow(0 0 10px rgba(255, 160, 210, .4));
}

.reading-mode .bold-emphasis {
    font-size: 1.1em;
}

#story-context-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 40;
}

#story-context-menu.show {
    pointer-events: auto;
}

#story-context-menu .context-panel {
    position: absolute;
    min-width: 140px;
    background: rgba(22,10,20,0.92);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#story-context-menu button {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.85);
    font-size: 13px;
    padding: 8px 12px;
    text-align: left;
    cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.08);
}

#story-context-menu button:last-child {
    border-bottom: none;
}

#story-context-menu button:hover {
    background: rgba(255,255,255,0.07);
}

.story-toast {
    position: absolute;
    right: 16px;
    bottom: 72px;
    padding: 8px 16px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(8px);
    color: rgba(255,255,255,0.85);
    font-size: 12px;
    animation: toastIn 0.25s ease forwards;
}

@keyframes toastIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}
#story-input {
    scrollbar-width: none;
}

/* å±•å¼€åè¾“å…¥æ¡†å˜é«˜ä½†ä¾ç„¶ä¿æŒåœ†è§’ç»ç’ƒæ„Ÿ */
#story-input.expanded {
    height: 70vh;
    padding-top: 14px;
}

/* å±•å¼€åæ˜¾ç¤ºç®­å¤´ */
#input-collapse-btn {
    position: absolute;
    top: -26px;
    left: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255, 200, 220, 0.28);
    background: rgba(40, 15, 25, 0.85);
    color: #e8cadd;
    font-size: 13px;
    cursor: pointer;
}

/* åˆå§‹éšè— */
.hidden {
    display: none;
}

#story-input::placeholder {
    color: rgba(244, 243, 247, 0.5);
}

/* å‘é€æŒ‰é’®ä¿ç•™åŸæ¥çš„æ¸å˜æ„Ÿ */
#story-send {
    border-radius: 999px;
    padding: 0 18px;
    border: 1px solid rgba(244, 182, 196, 0.8);
    background: var(--accent-soft);
    color: var(--accent);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    min-width: 64px;
}

#story-send:active {
    transform: scale(0.96);
}

.phone-pack {
    width: 380px;
    max-width: 380px;
    min-width: 320px;
    aspect-ratio: 9 / 19.5;
    height: auto;
    position: relative;
    flex-shrink: 0;
}

#phone-shell {
    width: 100%;
    border-radius: 28px;
    overflow: hidden;   /* å…³é”®ï¼šé˜²æ­¢å†…å±æº¢å‡º */
    position: relative;
    background: #000;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.08),
        0 18px 40px rgba(0,0,0,0.9),
        0 25px 60px rgba(0,0,0,0.65);
}

/* å³ä¾§æ‰‹æœºåŒºåŸŸï¼ˆPCï¼‰ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 30;
}

/* å†…å±å†…å®¹åŒºï¼šæ°¸è¿œå¡«æ»¡å¤–å£³ï¼Œä¸è‡ªå·±å†³å®šå°ºå¯¸ */
#phone {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    /* æ·±çº¢ â†’ æ·±ç´« â†’ é»‘çš„æ¸å˜å£çº¸ï¼ˆä½ çš„æœ€åˆæ¬¾ï¼‰ */
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(200, 80, 110, 0.18), transparent 60%),
        linear-gradient(160deg, #1a0e13 0%, #050509 100%);

    border-radius: inherit;
}

/* é¡¶éƒ¨çŠ¶æ€æ  */
/* å…¨å±€èƒŒæ™¯ï¼šä½é¥±å’Œæš—çº¢è‰² â†’ æ·±ç° */
:root {
    --bg-top: #1b1017;
    --bg-bottom: #050509;
    --glass: rgba(5, 6, 10, 0.82);
    --border: rgba(255, 255, 255, 0.12);
    --accent: #f4b6c4;
    --accent-soft: rgba(244, 182, 196, 0.18);
    --text-main: #f6f3f7;
    --text-sub: rgba(244, 243, 247, 0.72);
}

* {
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

body {
    margin: 0;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    color: var(--text-main);
    background: radial-gradient(circle at 0% 0%, #25121c, transparent 55%),
                radial-gradient(circle at 100% 100%, #1a101c, transparent 55%),
                linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    display: flex;
    justify-content: center;
    align-items: stretch;
    overflow: hidden;          /* ğŸ”’ é”ä½æ•´é¡µæ»šåŠ¨æ¡ */
}

/* å¤–å±‚å¸ƒå±€ï¼šPC ä¸Šå·¦å³æ’åˆ—ï¼Œæ‰‹æœºä¸Šä¸Šä¸‹æ’åˆ— */
#app {
    width: 100%;  
    height: 100%;              /* å¡«æ»¡ body */
    padding: 14px;
    display: flex;
    gap: 14px;
    align-items: stretch;
}

body.mobile-mode #app {
    flex-direction: column;
}

/* å‰§æƒ…ä¸»é¢æ¿ */
#story-panel {
    flex: 1;
    min-height: 80vh;
    border-radius: 22px;
    padding: 14px 14px 16px;
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 65%),
        radial-gradient(circle at 60% 60%, rgba(200, 80, 110, 0.18), transparent 65%),
        linear-gradient(180deg, #2a0f18 0%, #090609 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

#abyss-bg {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    overflow: hidden;
    z-index: 0;
}

#abyss-bg canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
}

#story-header {
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    margin-bottom: 10px;
}

.story-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.06em;
}

.story-subtitle {
    margin-top: 4px;
    font-size: 12px;
    color: var(--text-sub);
}

/* å‰§æƒ…å†…å®¹åŒº + è¾“å…¥åŒº */
#story-log {
    flex: 1;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    z-index: 1;
}

/* éšè—æ»šåŠ¨æ¡æ ·å¼ */
#story-log::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-log {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

/* è¾“å…¥è¡Œï¼šå›ºå®šåœ¨å‰§æƒ…åŒºåº•éƒ¨ï¼Œéšå®½åº¦è‡ªé€‚åº” */
#story-input-row {
    margin-top: auto;
    width: 100%;
    display: flex;
    align-items: flex-end;
    gap: 10px;
    position: relative;
    padding-top: 10px;
}
/* å¤šè¡Œ textareaï¼Œæ–‡å­—å‚ç›´å±…ä¸­æ„Ÿ + è‡ªåŠ¨å¢é«˜ */
#story-input {
    flex: 1;
    padding: 10px 16px;
    border-radius: 16px;
    border: 1px solid rgba(255, 200, 220, 0.25);
    background: linear-gradient(180deg,
        rgba(60, 20, 35, 0.55),
        rgba(20, 12, 18, 0.85)
    );
    color: #f5e9f3;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    outline: none;

    min-height: 40px;     /* ä¸¤è¡Œè§†è§‰é«˜åº¦ */
    max-height: 70vh;     /* æœ€å¤§å±•å¼€é«˜åº¦ */
    overflow-y: auto;     /* å†…éƒ¨æ»šåŠ¨ï¼Œä½†æ¡éšè— */
}

#story-input::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-input {
    scrollbar-width: none;
}

/* å±•å¼€åè¾“å…¥æ¡†å˜é«˜ä½†ä¾ç„¶ä¿æŒåœ†è§’ç»ç’ƒæ„Ÿ */
#story-input.expanded {
    height: 70vh;
    padding-top: 14px;
}

/* å±•å¼€åæ˜¾ç¤ºç®­å¤´ */
#input-collapse-btn {
    position: absolute;
    top: -26px;
    left: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255, 200, 220, 0.28);
    background: rgba(40, 15, 25, 0.85);
    color: #e8cadd;
    font-size: 13px;
    cursor: pointer;
}

/* åˆå§‹éšè— */
.hidden {
    display: none;
}

#story-input::placeholder {
    color: rgba(244, 243, 247, 0.5);
}

/* å‘é€æŒ‰é’®ä¿ç•™åŸæ¥çš„æ¸å˜æ„Ÿ */
#story-send {
    border-radius: 999px;
    padding: 0 18px;
    border: 1px solid rgba(244, 182, 196, 0.8);
    background: var(--accent-soft);
    color: var(--accent);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    min-width: 64px;
}

#story-send:active {
    transform: scale(0.96);
}

#phone-shell {
    width: 100%;
    height: 100%;
    border-radius: 28px;
    overflow: hidden;   /* å…³é”®ï¼šé˜²æ­¢å†…å±æº¢å‡º */
    position: relative;
    background: #000;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.06),
        0 18px 40px rgba(0,0,0,0.9);
}

/* å³ä¾§æ‰‹æœºåŒºåŸŸï¼ˆPCï¼‰ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 30;
}

/* å†…å±å†…å®¹åŒºï¼šæ°¸è¿œå¡«æ»¡å¤–å£³ï¼Œä¸è‡ªå·±å†³å®šå°ºå¯¸ */
#phone {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    /* æ·±çº¢ â†’ æ·±ç´« â†’ é»‘çš„æ¸å˜å£çº¸ï¼ˆä½ çš„æœ€åˆæ¬¾ï¼‰ */
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(200, 80, 110, 0.18), transparent 60%),
        linear-gradient(160deg, #1a0e13 0%, #050509 100%);

    border-radius: inherit;
}

/* é¡¶éƒ¨çŠ¶æ€æ  */
#status-bar {
    position: absolute;
    top: 6px;
    left: 0; right: 0;
    height: 22px;
    padding: 0 12px;

    font-size: 12px;
    color: #fff;
    opacity: 0.9;

    display: flex;
    justify-content: space-between;
    align-items: center;

    z-index: 15;
}

.sb-left, .sb-right {
    display: flex;
    gap: 6px;
    align-items: center;
}

#sb-time {
    font-weight: 600;
    letter-spacing: .5px;
}

/* ä¿¡å·å›¾æ ‡ï¼ˆçº¯ CSSï¼‰ */
.signal {
    display: flex;
    gap: 2px;
}
.signal::before,
.signal::after {
    content: "";
    width: 3px;
    background: #fff;
    border-radius: 2px;
}
.signal::before { height: 6px; opacity: .5; }
.signal::after { height: 10px; }

/* ç”µæ± å›¾æ ‡ */
.battery {
    width: 22px;
    height: 10px;
    border-radius: 3px;
    border: 1px solid #fff;
    position: relative;
}
.battery-level {
    height: 100%;
    background: #fff;
    border-radius: 2px;
    width: 50%;
    transition: width .3s;
}

/* çµåŠ¨å²›åˆå§‹ï¼ˆæŠ˜å çŠ¶æ€ï¼‰ */
#dynamic-island {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    height: 34px;
    background: rgba(15, 15, 18, 1);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    transition: all 0.25s ease;
    box-shadow:
        0 2px 8px rgba(0,0,0,0.7),
        inset 0 0 0 1px rgba(255,255,255,0.08);
    overflow: hidden;
    z-index: 20;
}

/* å±•å¼€çŠ¶æ€ */
#dynamic-island.expanded {
    width: 260px;
    height: 70px;
    border-radius: 28px;
}

/* çµåŠ¨å²›è§£é”åŠ¨ç”» */
#dynamic-island.unlocking {
    animation: islandUnlock 0.8s cubic-bezier(.34,1.56,.64,1) forwards;
    overflow: visible;
}
#dynamic-island.pop {
    animation: islandPop 0.7s ease forwards;
}
#dynamic-island.unlocking .island-content { opacity: 0; }
#dynamic-island .unlock-ring,
#dynamic-island .unlock-face,
#dynamic-island .unlock-check {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
}
#dynamic-island .unlock-ring {
    inset: 6px;
    border-radius: 999px;
    border: 2px solid #7cf3a2;
    opacity: 0;
}
#dynamic-island .unlock-face,
#dynamic-island .unlock-check {
    font-size: 20px;
    color: #7cf3a2;
    opacity: 0;
}
#dynamic-island.unlocking .unlock-ring {
    animation: ringShow 0.8s ease forwards;
}
#dynamic-island.unlocking .unlock-face {
    animation: faceShow 0.8s ease forwards;
}
#dynamic-island.unlocking .unlock-check {
    animation: checkShow 0.8s ease forwards;
}
#dynamic-island.notify {
    animation: islandNotify 0.6s ease forwards;
}
#dynamic-island .island-bubble {
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translate(-50%, 10px);
    background: rgba(12, 12, 17, 0.92);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 999px;
    padding: 4px 10px;
    color: #fff;
    font-size: 11px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease, transform 0.25s ease;
}
#dynamic-island .island-bubble.show {
    opacity: 1;
    transform: translate(-50%, -2px);
}
@keyframes islandNotify {
    0% { transform: translateX(-50%) scale(1); box-shadow: 0 6px 14px rgba(0,0,0,0.4); }
    35% { transform: translateX(-50%) scale(1.06); box-shadow: 0 10px 20px rgba(0,0,0,0.5),0 0 0 6px rgba(244,182,196,0.25); }
    100% { transform: translateX(-50%) scale(1); box-shadow: 0 6px 14px rgba(0,0,0,0.4); }
}
@keyframes islandPop {
    0% { transform: translateX(-50%) scale(1); }
    40% { transform: translateX(-50%) scale(1.06); }
    100% { transform: translateX(-50%) scale(1); }
}

@keyframes islandUnlock {
    0%   { width:110px; height:34px; border-radius:20px; }
    45%  { width:78px;  height:78px; border-radius:18px; transform: translateX(-50%) scale(1.02); }
    70%  { width:72px;  height:72px; border-radius:16px; transform: translateX(-50%) scale(0.98); }
    100% { width:74px;  height:74px; border-radius:16px; transform: translateX(-50%) scale(1); }
}
@keyframes ringShow {
    0%   { opacity: 0; transform: scale(0.8); }
    25%  { opacity: 1; transform: scale(1.05); }
    70%  { opacity: 1; transform: scale(1); }
    100% { opacity: 0.9; }
}
@keyframes faceShow {
    0%   { opacity: 0; }
    20%  { opacity: 1; }
    45%  { opacity: 0; }
    100% { opacity: 0; }
}
@keyframes checkShow {
    0%   { opacity: 0; transform: scale(0.8); }
    60%  { opacity: 0; transform: scale(0.9); }
    75%  { opacity: 1; transform: scale(1); }
    100% { opacity: 1; }
}

/* å†…éƒ¨å†…å®¹ */
#dynamic-island .island-content {
    opacity: 0.85;
    color: #f6f3f7;
    font-size: 12px;
    pointer-events: none; /* å†…å®¹ä¸é˜»æŒ¡ç‚¹å‡» */
}

#message-banner {
    position: absolute;
    top: 58px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 300px;
    border-radius: 16px;
    background: rgba(10,10,14,0.92);
    border: 1px solid rgba(255,255,255,0.12);
    padding: 10px 14px;
    color: #f6f3f7;
    font-size: 12px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.55);
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s ease, transform .25s ease;
    z-index: 150;
    cursor: pointer;
}
#message-banner.show {
    opacity: 1;
    transform: translate(-50%, 0);
    pointer-events: auto;
}
.message-banner-title {
    font-weight: 700;
    margin-bottom: 4px;
}
.message-banner-text {
    color: rgba(255,255,255,0.8);
}

/* æ‰‹æœºå†…å±å†…å®¹ */
#home-screen,
.app-page {
    margin-top: 40px;
    flex: 1;
    display: grid;
    place-items: center;
}

/* é¦–é¡µ app å›¾æ ‡æ …æ ¼ */
#home-screen {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    
    padding-top: 70px;    /* çœŸå® iOS é¡¶éƒ¨ç•™ç™½ */
    padding-left: 12px;
    padding-right: 12px;

    row-gap: 24px;
    column-gap: 10px;

    justify-items: center;
    align-content: start; /* â† å…³é”®ï¼šé¡¶éƒ¨å †å  */
    height: 100%;
}

.app-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    user-select: none;
}

.app-icon .icon {
    width: 54px;
    height: 54px;
    background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.18), transparent 60%),
                rgba(22, 22, 26, 0.96);
    border-radius: 16px;
    border: 1px solid rgba(120, 120, 130, 0.9);
    margin-bottom: 6px;
}

.app-icon p {
    font-size: 12px;
    opacity: 0.9;
}

/* app å†…é¡µ */
.app-page {
    padding: 0;
    grid-template-rows: none;
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

.app-icon.dragging {
    opacity: 0.4;
    transform: scale(1.1);
}

.page-header {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-start;
    color: #f7f7f8;
    font-size: 13px;
    padding: 10px;
}

#wechat-page .page-header .back-home { display: none; }
#wechat-page .page-header {
    padding: 8px 12px;
    border-bottom: none;
    background: transparent;
}
#call-page .page-header,
#memo-page .page-header {
    padding: 0 0 10px;
}

.page-header .back-home {
    width: 24px;
    height: 24px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.36);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    cursor: pointer;
}
.page-header span { display: none; }
.app-page .page-header span {
    display: inline;
}
.app-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}
.app-scroll::-webkit-scrollbar { width:0; height:0; }

#home-bar {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 5px;
    border-radius: 999px;

    background: linear-gradient(
        90deg,
        rgba(255,255,255,0.85)
    );

    pointer-events: auto; /* â† å¿…é¡» */
    z-index: 10;           /* ç¡®ä¿å®ƒåœ¨å±å¹•ä¹‹ä¸Š */
}

.page-body {
    margin-top: 8px;
    font-size: 12px;
    color: #ddd;
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}
.page-body::-webkit-scrollbar { width:0; height:0; }

/* --- å¾®ä¿¡è½»é‡æ ·å¼ --- */
.wechat-body {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
    min-height: 0;
    overflow: hidden;
    padding: 0;
}
.wechat-top {
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.04em;
    flex: 1;
    text-align: center;
}
.wechat-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0;
    width: 100%;
    min-height: 0;
}
.wechat-tabs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    padding: 5px 0 9px;
}
.wechat-tabs button {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.35);
    color: #f5f5f5;
    padding: 6px 8px;
    font-size: 12px;
    cursor: pointer;
    position: relative;
}
.wechat-tabs button.has-unread::after {
    content: "";
    position: absolute;
    top: 4px;
    right: 8px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #ff6a89;
    box-shadow: 0 0 6px rgba(255,106,137,0.7);
}
.wechat-tabs button.active {
    background: rgba(244,182,196,0.18);
    border-color: rgba(244,182,196,0.65);
    color: #ffe9f5;
}
.wechat-bottom-tabs {
    position: sticky;
    bottom: 4px;
    margin-top: auto;
    border-top: 1px solid rgba(255,255,255,0.12);
    padding: 7px 0 4px;
    background: linear-gradient(180deg, rgba(5,5,8,0), rgba(5,5,8,0.85));
    backdrop-filter: blur(10px);
}
.wechat-panel {
    border: none;
    border-radius: 0;
    background: transparent;
    padding: 0;
    display: grid;
    gap: 8px;
    max-height: 100%;
    overflow: hidden;
    width: 100%;
}
.wechat-moments-wrap {
    padding: 0;
    overflow-y: auto;
    height: 100%;
    display: flex;
    flex-direction: column;
}
.wechat-moments-wrap::-webkit-scrollbar { width: 0; }
.moments-hero {
    position: relative;
    height: 220px;
    background: #111;
}
.moments-cover {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.06), transparent 70%), linear-gradient(135deg, #1f1b2a, #0c0d12);
}
.moments-avatar {
    position: absolute;
    bottom: 12px;
    right: 12px;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: rgba(255,255,255,0.16);
    border: 1px solid rgba(255,255,255,0.24);
}
.moments-feed-inner {
    padding: 12px;
    display: grid;
    gap: 10px;
    flex: 1;
    min-height: 0;
}
.moment-composer {
    margin: 12px;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(0,0,0,0.35);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.moment-composer textarea {
    width: 100%;
    min-height: 56px;
    resize: none;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    padding: 8px 10px;
    background: rgba(8,8,12,0.65);
    color: #f5f5ff;
    font-size: 13px;
}
.moment-composer textarea:focus {
    outline: 1px solid rgba(255,255,255,0.22);
}
.moment-composer-actions {
    display: flex;
    justify-content: flex-end;
}
.moment-composer-actions button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    padding: 4px 18px;
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 12px;
}
.wc-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    position: relative;
}
.wc-avatar {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: grid;
    place-items: center;
    background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.2), transparent 60%), rgba(20,20,24,0.8);
    font-size: 16px;
}
.wc-main {
    flex: 1;
    min-width: 0;
}
.wc-name {
    font-weight: 700;
    font-size: 13px;
}
.wc-sub {
    font-size: 11px;
    color: rgba(255,255,255,0.72);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.wc-time {
    font-size: 11px;
    color: rgba(255,255,255,0.65);
}
.wc-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 62px;
    justify-content: flex-end;
    margin-left: auto;
}
.wc-unread {
    position: static;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(244,182,196,0.9);
    color: #1a0e13;
    font-weight: 800;
    line-height: 1;
    min-width: 16px;
    text-align: center;
}
.wc-badge {
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 999px;
    border: 1px solid rgba(244,182,196,0.6);
    color: #f7d2e0;
}
.moment-card {
    border-radius: 12px;
    padding: 10px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.06);
    display: grid;
    gap: 4px;
}
.moment-meta {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: rgba(255,255,255,0.65);
}
.moment-actions {
    display: flex;
    gap: 6px;
}
.moment-actions button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.06);
    color: #f3f3f3;
    font-size: 11px;
    padding: 4px 8px;
    cursor: pointer;
}
.moment-actions button.like {
    background: rgba(120,200,140,0.2);
    border-color: rgba(120,200,140,0.6);
}
.moment-comment-panel {
    margin-top: 6px;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 8px;
    background: rgba(0,0,0,0.32);
    display: none;
    flex-direction: column;
    gap: 6px;
}
.moment-comment-panel.show {
    display: flex;
}
.moment-comment-input {
    width: 100%;
    min-height: 48px;
    resize: none;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(0,0,0,0.45);
    color: #f6f3ff;
    font-size: 12px;
    padding: 8px 10px;
}
.moment-comment-input:focus {
    outline: 1px solid rgba(255,255,255,0.26);
}
.moment-comment-controls {
    display: flex;
    justify-content: flex-end;
}
.moment-send-btn {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(255,255,255,0.12);
    color: #fff;
    font-size: 11px;
    padding: 4px 16px;
}
.mention-menu {
    display: none;
    flex-wrap: wrap;
    gap: 6px;
}
.mention-menu.open {
    display: flex;
}
.mention-menu button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 10px;
    padding: 4px 10px;
}
.mention-empty {
    font-size: 10px;
    opacity: 0.6;
}
.moment-comments {
    margin-top: 6px;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.moment-comment {
    font-size: 11px;
    color: rgba(255,255,255,0.82);
    display: flex;
    gap: 4px;
}
.moment-comment-author {
    font-weight: 700;
    color: rgba(255,255,255,0.95);
}
.moment-comment-text {
    flex: 1;
    color: rgba(255,255,255,0.82);
}

/* ç”µè¯é¡µ */
.call-page-body,
#call-page .page-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.call-tabs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    padding: 8px 0;
    position: sticky;
    bottom: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255,255,255,0.12);
    margin-top: auto;
    width: 100%;
}
.call-tabs button {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.08);
    color: #f6f6f6;
    padding: 8px 6px;
    font-size: 12px;
    cursor: pointer;
}
.call-tabs button.active {
    background: rgba(120,200,255,0.18);
    border-color: rgba(120,200,255,0.65);
    color: #e8f6ff;
}
.call-panel {
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
    flex: 1;
    min-height: 0;
    overflow: auto;
    width: 100%;
}
.call-panel::-webkit-scrollbar { width: 0; height: 0; }
.call-item {
    padding: 10px;
    border-radius: 0;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.08);
    width: 100%;
}
.call-item + .call-item {
    border-top: none;
}
.call-item .top {
    display: flex;
    justify-content: space-between;
    font-weight: 700;
    font-size: 13px;
}
.call-item .sub {
    margin-top: 4px;
    font-size: 11px;
    color: rgba(255,255,255,0.72);
}
.dial-display {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    padding: 10px;
    text-align: center;
    background: rgba(0,0,0,0.18);
    font-size: 16px;
    color: #f6f6f6;
}
.dial-grid {
    margin-top: 10px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}
.dial-key {
    height: 56px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.1);
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    display: grid;
    place-items: center;
    cursor: pointer;
}
.dial-call {
    margin-top: 12px;
    border-radius: 999px;
    border: 1px solid rgba(120,200,140,0.8);
    background: rgba(120,200,140,0.35);
    color: #0e2a14;
    padding: 10px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
}
.wallet-balance {
    padding: 10px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(244,182,196,0.24), rgba(120,60,90,0.32));
    border: 1px solid rgba(244,182,196,0.45);
}
.wallet-balance .label { font-size: 12px; opacity: 0.8; }
.wallet-balance .value { font-size: 20px; font-weight: 700; margin: 4px 0; }
.wallet-balance .sub { font-size: 11px; opacity: 0.78; }
.wallet-actions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}
.wallet-btn {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.05);
    color: #f7f7f7;
    padding: 10px 6px;
    font-size: 12px;
    display: grid;
    place-items: center;
    cursor: pointer;
}

.wechat-chat-window {
    border: none;
    border-radius: 0;
    background: transparent;
    display: none;
    flex-direction: column;
    min-height: 0;
    flex: 1;
    width: 100%;
    align-self: stretch;
    overflow: hidden;
}
.chat-window-head {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0;
    gap: 6px;
    background: transparent;
    border-bottom: none;
    flex-shrink: 0;
}
#chat-head-controls {
    display: none;
}
.chat-window-head button {
    width: 30px;
    height: 30px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.3);
    background: rgba(0,0,0,0.65);
    color: #fff;
    cursor: pointer;
}
.chat-unread-total {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(244,182,196,0.9);
    color: #1a0e13;
    font-weight: 800;
    font-size: 11px;
}
.chat-window-log {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 12px 0;
    background: transparent;
    overflow: auto;
    scrollbar-width: none;
    touch-action: pan-y;
    overscroll-behavior: contain;
}
.chat-window-log::-webkit-scrollbar { width:0; height:0; }
.chat-row {
    display: flex;
    gap: 8px;
    padding: 0;
}
.chat-row.in { justify-content: flex-start; }
.chat-row.out { justify-content: flex-end; flex-direction: row-reverse; padding-right: 0; }
.chat-avatar {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.24);
    display: grid;
    place-items: center;
    font-size: 12px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.08);
}
.chat-bubble {
    max-width: 78%;
    padding: 10px 12px;
    border-radius: 16px;
    font-size: 13px;
    line-height: 1.6;
    position: relative;
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
}
.chat-bubble.in { align-self: flex-start; background: #fff; color: #222; border: 1px solid rgba(0,0,0,0.06); }
.chat-bubble.out { align-self: flex-end; background: #6ad35f; color: #0b2b08; border: 1px solid rgba(0,0,0,0.08); margin-left: auto; }
.chat-bubble.pay { background: rgba(120,200,140,0.25); border-color: rgba(120,200,140,0.65); }
.chat-bubble.red { background: rgba(240,120,120,0.22); border-color: rgba(240,120,120,0.6); }
.chat-bubble.red-can-open {
    cursor: pointer;
    box-shadow: 0 0 12px rgba(240,120,120,0.4);
}
.chat-window-input {
    display: flex;
    gap: 8px;
    padding: 10px 0;
    border-top: none;
    background: transparent;
    position: sticky;
    bottom: 0;
    flex-shrink: 0;
}
.chat-window-input input {
    flex: 1;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.5);
    color: #fff;
    padding: 7px 10px;
    font-size: 12px;
    outline: none;
}
.chat-window-input button {
    border-radius: 999px;
    border: 1px solid rgba(244,182,196,0.65);
    background: rgba(244,182,196,0.18);
    color: #ffe9f5;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
}
.chat-window-input #chat-actions-toggle {
    width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 18px;
    line-height: 1;
}
.chat-window-input #chat-actions-toggle.active {
    background: rgba(244,182,196,0.25);
    border-color: rgba(244,182,196,0.6);
}
.chat-actions-panel {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 0 10px;
    background: rgba(4,4,8,0.92);
    border-top: 1px solid rgba(255,255,255,0.08);
    overflow: hidden;
    max-height: 0;
    transition: max-height .2s ease, padding .2s ease;
}
.chat-actions-panel.open {
    padding: 8px 10px 12px;
    max-height: 260px;
}
.chat-actions-buttons {
    display: flex;
    gap: 8px;
    width: 100%;
}
.chat-actions-buttons button {
    flex: 1;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.22);
    background: rgba(255,255,255,0.08);
    color: #f5f5f5;
    font-size: 12px;
    padding: 8px 10px;
    cursor: pointer;
}
.chat-action-form {
    flex-basis: 100%;
    display: none;
    flex-direction: column;
    gap: 8px;
}
.chat-action-form.show {
    display: flex;
}
.chat-action-display {
    font-size: 16px;
    font-weight: 700;
    text-align: center;
}
.chat-action-keypad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
}
.chat-action-keypad button {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.05);
    color: #fff;
    font-size: 14px;
    padding: 10px 0;
    cursor: pointer;
}
.chat-action-keypad button[data-key="â†"] {
    font-weight: 700;
}
.chat-action-form-buttons {
    display: flex;
    gap: 8px;
}
.chat-action-form-buttons button {
    flex: 1;
}

/* æ‚¬æµ®æ‰‹æœºæŒ‰é’®ï¼šåƒç´ å°æ‰‹æœºå›¾æ ‡ */
#phone-toggle {
    position: fixed;
    z-index: 1201;
    bottom: 20px;
    right: 20px;
    width: 46px;
    height: 46px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background:
        radial-gradient(circle at 30% 30%, rgba(171, 42, 42, 0.2), transparent 60%),
        linear-gradient(180deg, #3a1222 0%, #31121d 100%);
    border: 1px solid rgba(255, 180, 210, 0.45);
    box-shadow:
        0 0 6px rgba(233, 123, 160, 0.35),
        0 4px 12px rgba(0, 0, 0, 0.6);
    box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.06);
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
    overflow: visible;
}

.pixel-phone {
    width: 20px;
    height: 28px;
    border-radius: 5px;
    border: 1px solid rgba(255, 255, 255, 0.7);
    background: #07060a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
}

.pixel-screen {
    width: 14px;
    height: 16px;
    border-radius: 3px;
    background:
        radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255, 130, 170, 0.4), transparent 70%),
        linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.pixel-phone::after {
    content: "";
    width: 6px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
}
#phone-toggle.notify {
    animation: phoneBounce 0.35s ease-in-out 2;
}
#phone-toggle.special-alert {
    animation: toggleSpecialPulse 0.4s ease-in-out 6;
    box-shadow:
        0 0 20px rgba(255, 92, 124, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.12);
}

#phone-toggle.special-alert .pixel-screen {
    background:
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.6), transparent 70%),
        linear-gradient(145deg, rgba(255, 138, 168, 0.6), rgba(82, 29, 54, 0.9));
}

#phone-toggle.special-alert #phone-toggle-bubble {
    background: rgba(255, 92, 124, 0.85);
    color: #1a0409;
}
#phone-toggle-bubble {
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translate(-50%, -10px);
    background: rgba(10,10,14,0.92);
    color: #fff;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.2);
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease, transform .2s ease;
    white-space: nowrap;
}
#phone-toggle-bubble.show {
    opacity: 1;
    transform: translate(-50%, -30px);
}
@keyframes phoneBounce {
    0% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0); }
}

@keyframes toggleSpecialPulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.08);
    }
    100% {
        transform: scale(1);
    }
}

#red-envelope-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease;
    z-index: 200;
}
#red-envelope-overlay.show {
    opacity: 1;
    pointer-events: auto;
}
.red-envelope-card {
    width: 70%;
    max-width: 240px;
    padding: 20px 16px;
    border-radius: 20px;
    background: linear-gradient(160deg, #7b1010, #cb3636);
    border: 1px solid rgba(255,255,255,0.25);
    box-shadow: 0 16px 40px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    text-align: center;
    color: #ffefe0;
}
.red-envelope-title {
    font-size: 14px;
    opacity: 0.85;
}
.red-envelope-amount {
    font-size: 28px;
    font-weight: 800;
}
.red-envelope-note {
    font-size: 12px;
    opacity: 0.9;
}
#red-envelope-confirm {
    width: 100%;
    border-radius: 999px;
    border: none;
    background: #ffe2a8;
    color: #7b1010;
    font-size: 14px;
    font-weight: 700;
    padding: 8px 0;
    cursor: pointer;
}

#in-call-overlay {
    position: absolute;
    inset: 0;
    background: rgba(5,5,8,0.92);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease;
    z-index: 210;
}
#in-call-overlay.show {
    opacity: 1;
    pointer-events: auto;
}
.in-call-card {
    width: 80%;
    max-width: 260px;
    border-radius: 26px;
    border: 1px solid rgba(255,255,255,0.08);
    background: linear-gradient(160deg, #150910, #07060a);
    padding: 20px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    text-align: center;
}
.in-call-name {
    font-size: 18px;
    font-weight: 800;
}
.in-call-status {
    font-size: 12px;
    color: rgba(255,255,255,0.75);
}
.in-call-timer {
    font-size: 24px;
    letter-spacing: 0.08em;
}
.in-call-transcript {
    width: 100%;
    max-height: 140px;
    overflow-y: auto;
    border-radius: 18px;
    padding: 10px;
    background: rgba(255,255,255,0.03);
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.transcript-row {
    font-size: 12px;
    text-align: left;
    padding: 6px 10px;
    border-radius: 10px;
    background: rgba(255,255,255,0.06);
}
.transcript-row.user {
    align-self: flex-end;
    background: rgba(178, 255, 205, 0.12);
}
.transcript-row.npc {
    align-self: flex-start;
    background: rgba(255, 255, 255, 0.08);
}
#in-call-end {
    width: 100%;
    border-radius: 999px;
    border: none;
    padding: 10px 0;
    font-size: 14px;
    font-weight: 700;
    background: #f45252;
    color: #fff;
    cursor: pointer;
}

.memo-body {
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
}
.memo-controls {
    display: flex;
    justify-content: flex-end;
    padding: 10px 0;
}
.memo-controls button {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.4);
    color: #fff;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
}
.memo-log {
    flex: 1;
    min-height: 0;
    overflow: auto;
    display: flex;
    flex-direction: column;
    gap: 0;
    padding-bottom: 10px;
}
.memo-log::-webkit-scrollbar { width: 0; height: 0; }
.memo-item {
    border-radius: 0;
    border: 1px solid rgba(255,255,255,0.08);
    padding: 8px 10px;
    background: rgba(255,255,255,0.04);
    font-size: 12px;
    color: rgba(255,255,255,0.85);
    display: flex;
    justify-content: space-between;
    gap: 10px;
    width: 100%;
}
.memo-item + .memo-item {
    border-top: none;
}
.memo-item span {
    font-weight: 600;
    color: rgba(255,255,255,0.9);
}

#dynamic-island.call-alert {
    width: 220px;
    height: 80px;
    border-radius: 26px;
}
#dynamic-island.call-alert .island-content {
    display: none;
}
.island-call {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 6px;
}
#dynamic-island.call-alert .island-call {
    display: flex;
}
.island-call-name {
    font-size: 13px;
    font-weight: 700;
}
.island-call-actions {
    display: flex;
    gap: 12px;
}
.pixel-btn {
    width: 32px;
    height: 32px;
    border: 2px solid rgba(255,255,255,0.6);
    border-radius: 6px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    box-shadow: inset 0 0 0 2px rgba(0,0,0,0.6);
}
.pixel-btn.accept {
    border-color: #88f598;
    color: #88f598;
}
.pixel-btn.decline {
    border-color: #ff8383;
    color: #ff8383;
}

body.pc-mode.phone-open #phone-layer {
    display: none;   /* â† PC ç‚¹å‡»æµ®çª—æŒ‰é’®åéšè—æ‰‹æœº */
}



/* æ‰‹æœºç«¯ï¼šç›´æ¥æŠŠç½‘é¡µç«¯çš„æ‰‹æœºæŒ‰æ¯”ä¾‹æ”¾å¤§å±…ä¸­æ˜¾ç¤º */
body.mobile-mode #phone-layer {
    position: fixed;
    inset: 0;  /* é¡¶éƒ¨åˆ°åº•éƒ¨å…¨è¦†ç›– */
    display: none;
    justify-content: center;
    align-items: center;
    width: auto;
    max-width: 100vw;
    height: auto;
    padding: 10px;             /* ä¸æ¡Œé¢ä¸€è‡´çš„å†…è¾¹è· */

    background: rgba(0,0,0,0.40); /* åŠé€æ˜é®ç½© */
    backdrop-filter: blur(6px);

    z-index: 1100;
    pointer-events: none;   /* é»˜è®¤ä¸èƒ½ç‚¹å‡»ï¼ˆæœªå±•å¼€æ—¶ï¼‰ */
    opacity: 0;
    transition: opacity .25s ease;
}

/* å±•ç¤ºæ‰‹æœº */
body.mobile-mode #phone-layer.show {
    display: flex;
    pointer-events: auto;
    opacity: 1;
}

/* æ‰‹æœºæœ¬ä½“å°ºå¯¸ï¼šæŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œä¸ä¼šå˜å½¢ */
body.mobile-mode #phone-shell {
    width: min(380px, 92vw); /* ç­‰æ¯”ç¼©æ”¾ï¼Œä¿æŒä¸æ¡Œé¢ä¸€è‡´ */
    transform: scale(1);
    transition: transform .25s ease;
}

/* æ‰‹æœºç«¯ç»Ÿä¸€å°è£…å°ºå¯¸ï¼ˆä½œç”¨äº phone-packï¼‰ */
body.mobile-mode .phone-pack {
    width: min(380px, 92vw);
}

/* å½“æ‰‹æœºå±‚æ‰“å¼€æ—¶ï¼Œå¯æ ¹æ®éœ€è¦éšè—è¾“å…¥ï¼ˆå…ˆä¿ç•™æ˜¾ç¤ºï¼Œè®©ä½ æ„Ÿå—ä¸€ä¸‹æ•ˆæœï¼‰
   å¦‚æœä½ å¸Œæœ›æ‰‹æœºå±‚æ‰“å¼€æ—¶æ‰‹æœºç«¯éšè—è¾“å…¥ï¼Œå¯ä»¥æ”¹æˆ display:none; */
body.mobile-mode.phone-open #story-input-row {
    /* display: none;  // å¦‚æœæƒ³å®Œå…¨éšè—ï¼Œåœ¨è¿™é‡Œè§£æ³¨é‡Š */
}

/* å“åº”å¼ï¼šæ›´çª„æ—¶æ•´ä½“å·¦å³ padding æ”¶ç´§ */
@media (max-width: 600px) {
    #app {
        padding: 10px;
    }
    #story-panel {
        min-height: 70vh;
    }
}


.click-anim {
    transition: transform .12s ease, filter .2s ease;
}
.click-anim:active {
    transform: scale(0.92);
    filter: brightness(1.3);
}


#sb-time {
    font-weight: 600;
    letter-spacing: .5px;
}

/* ä¿¡å·å›¾æ ‡ï¼ˆçº¯ CSSï¼‰ */
.signal {
    display: flex;
    gap: 2px;
}
.signal::before,
.signal::after {
    content: "";
    width: 3px;
    background: #fff;
    border-radius: 2px;
}
.signal::before { height: 6px; opacity: .5; }
.signal::after { height: 10px; }

/* ç”µæ± å›¾æ ‡ */
.battery {
    width: 22px;
    height: 10px;
    border-radius: 3px;
    border: 1px solid #fff;
    position: relative;
}
.battery-level {
    height: 100%;
    background: #fff;
    border-radius: 2px;
    width: 50%;
    transition: width .3s;
}

/* çµåŠ¨å²›åˆå§‹ï¼ˆæŠ˜å çŠ¶æ€ï¼‰ */
#dynamic-island {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    height: 34px;
    background: rgba(15, 15, 18, 1);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    transition: all 0.25s ease;
    box-shadow:
        0 2px 8px rgba(0,0,0,0.7),
        inset 0 0 0 1px rgba(255,255,255,0.08);
    overflow: hidden;
    z-index: 20;
}

/* å±•å¼€çŠ¶æ€ */
#dynamic-island.expanded {
    width: 260px;
    height: 70px;
    border-radius: 28px;
}

/* å†…éƒ¨å†…å®¹ */
#dynamic-island .island-content {
    opacity: 0.85;
    color: #f6f3f7;
    font-size: 12px;
    pointer-events: none; /* å†…å®¹ä¸é˜»æŒ¡ç‚¹å‡» */
}

/* æ‰‹æœºå†…å±å†…å®¹ */
#home-screen,
.app-page {
    margin-top: 40px;
    flex: 1;
    display: grid;
    place-items: center;
}

/* é¦–é¡µ app å›¾æ ‡æ …æ ¼ */
#home-screen {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    padding-top: 62px;   /* iOS é¡¶éƒ¨è¾ƒå¤§ç©ºéš™ */
    row-gap: 28px;
    column-gap: 14px;

    width: 100%;
    height: 100%;
    justify-items: center;
}

.app-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    user-select: none;
}

.app-icon .icon {
    width: 54px;
    height: 54px;
    background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.18), transparent 60%),
                rgba(22, 22, 26, 0.96);
    border-radius: 16px;
    border: 1px solid rgba(120, 120, 130, 0.9);
    margin-bottom: 6px;
}

.app-icon p {
    font-size: 12px;
    opacity: 0.9;
}

/* app å†…é¡µ */
.app-page {
    padding: 10px;
    grid-template-rows: auto 1fr;
}

.app-icon.dragging {
    opacity: 0.4;
    transform: scale(1.1);
}

.page-header {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #f7f7f8;
    font-size: 13px;
}

.page-header .back-home {
    width: 24px;
    height: 24px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.36);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    cursor: pointer;
}

#home-bar {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 5px;
    border-radius: 999px;

    background: linear-gradient(
        90deg,
        rgba(255,255,255,0.85)
    );

    pointer-events: auto; /* â† å¿…é¡» */
    z-index: 10;           /* ç¡®ä¿å®ƒåœ¨å±å¹•ä¹‹ä¸Š */
}

.page-body {
    margin-top: 8px;
    font-size: 12px;
    color: #ddd;
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}

/* æ‚¬æµ®æ‰‹æœºæŒ‰é’®ï¼šåƒç´ å°æ‰‹æœºå›¾æ ‡ */
#phone-toggle {
    position: fixed;
    z-index: 1201;
    bottom: 20px;
    right: 20px;
    width: 46px;
    height: 46px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background:
        radial-gradient(circle at 30% 30%, rgba(171, 42, 42, 0.2), transparent 60%),
        linear-gradient(180deg, #3a1222 0%, #31121d 100%);
    border: 1px solid rgba(255, 180, 210, 0.45);
    box-shadow:
        0 0 6px rgba(233, 123, 160, 0.35),
        0 4px 12px rgba(0, 0, 0, 0.6);
    box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.06);
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
}

.pixel-phone {
    width: 20px;
    height: 28px;
    border-radius: 5px;
    border: 1px solid rgba(255, 255, 255, 0.7);
    background: #07060a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
}

.pixel-screen {
    width: 14px;
    height: 16px;
    border-radius: 3px;
    background:
        radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255, 130, 170, 0.4), transparent 70%),
        linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.pixel-phone::after {
    content: "";
    width: 6px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
}

body.pc-mode.phone-open #phone-layer {
    display: none;   /* â† PC ç‚¹å‡»æµ®çª—æŒ‰é’®åéšè—æ‰‹æœº */
}



/* å³ä¾§æ‰‹æœºåœ¨ PC ä¸Šçš„æ­£å¸¸æ ·å¼ï¼ˆä¿æŒä½ ç°åœ¨çš„å†™æ³•ï¼‰ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* PC ä¸Šå¯é€šè¿‡ JS åŠ  hidden-phone æ¥éšè—å³ä¾§æ‰‹æœº */
#phone-layer.hidden-phone {
    display: none;
}

/* ------------ çª„å±ï¼ˆæ‰‹æœºå®½åº¦ï¼‰æ—¶çš„è¡Œä¸º ------------ */
@media (max-width: 900px) {
    /* å¸ƒå±€å˜æˆå•åˆ—ï¼šåªæ˜¾ç¤ºå‰§æƒ…é¢æ¿ï¼Œå³ä¾§æ‰‹æœºè¿™ä¸€åˆ—å…ˆéšè— */
    #app {
        flex-direction: column;
    }

}

/* å“åº”å¼ï¼šæ›´çª„æ—¶æ•´ä½“å·¦å³ padding æ”¶ç´§ */
@media (max-width: 600px) {
    #app {
        padding: 10px;
    }
    #story-panel {
        min-height: 70vh;
    }
}


.click-anim {
    transition: transform .12s ease, filter .2s ease;
}
.click-anim:active {
    transform: scale(0.92);
    filter: brightness(1.3);
}

.app-icon {
    transition: transform .12s ease, filter .2s ease;
}

.app-icon:hover {
    transform: scale(1.07);
}

.app-icon:active {
    transform: scale(0.92);
    filter: brightness(1.2);
}

@media (hover: none) {
    .app-icon:active {
        transform: scale(0.95);
    }
}

#dynamic-island {
    transition: transform .25s ease, filter .2s ease;
}

#dynamic-island:hover {
    transform: translateX(-50%) scale(1.05);
}

#dynamic-island:active {
    transform: translateX(-50%) scale(0.95);
    filter: brightness(1.15);
}

.app-icon.launching {
    animation: launch 0.18s ease forwards;
}
@keyframes launch {
    to { transform: scale(0.4); opacity: 0; }
}
.story-bubble.reading-mode p {
    margin-bottom: 8px;
}
.narration-lead {
    position: relative;
}

.narration-lead::after {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 12px;
    background: radial-gradient(circle, rgba(255,220,200,0.12), transparent 70%);
    pointer-events: none;
}

@media (max-width: 460px) {
    .story-bubble {
        max-width: 92%;
    }
    .story-block {
        padding: 0 4%;
    }
}
.story-bubble.bubble-center {
    align-self: center;
}
