@import url("../ui/tokens.css");
@import url("../ui/components/button.css");
@import url("../ui/components/input.css");
@import url("../ui/components/select.css");
@import url("../ui/components/bubble.css");
@import url("../ui/components/modal.css");
@import url("../ui/components/panel.css");
@import url("../ui/components/header.css");
@import url("../ui/components/chips.css");
@import url("../ui/surfaces/story.css");
@import url("../ui/surfaces/phone.css");
/* ÂÖ®Â±ÄËÉåÊôØÔºö‰ΩéÈ•±ÂíåÊöóÁ∫¢Ëâ≤ ‚Üí Ê∑±ÁÅ∞ */
/* UI Layer: Áªü‰∏ÄÂúÜËßí/Èó¥Ë∑ù/ËæπÊ°Ü/hover/disabledÔºåÁ¶ÅÊ≠¢Ë£∏Áî®ÂéüÁîüÊéß‰ª∂„ÄÇ */
:root {
    --bg-top: #14040c;
    --bg-bottom: #05010a;
    --glass: rgba(8, 5, 12, 0.88);
    --border: rgba(255, 196, 168, 0.22);
    --accent: #f3c071;
    --accent-soft: rgba(243, 159, 117, 0.18);
    --text-main: #f4e9f5;
    --text-sub: rgba(233, 210, 225, 0.74);
    --story-font-size: 13px;
    --obsidian: #0b050c;
    --blood: #7c1025;
    --void: #3b0d45;
    --molten-gold: #f6c36a;
    --noise: rgba(255, 255, 255, 0.04);
    --fog: rgba(12, 8, 14, 0.7);
    --tentacle-art: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='96' height='176' shape-rendering='crispEdges'><rect width='96' height='176' fill='none'/><path fill='%230a060d' d='M18 152h18v24H18z'/><path fill='%2313071a' d='M24 118h16v60H24z'/><path fill='%23230d29' d='M32 84h14v80H32z'/><path fill='%232e0f33' d='M40 58h14v90H40z'/><path fill='%23380f3a' d='M50 40h12v90H50z'/><path fill='%2355133f' d='M56 30h10v78H56z'/><path fill='%2374183f' d='M60 22h10v64H60z'/><path fill='%23a3273c' d='M64 16h8v50H64z'/><path fill='%23d8485c' d='M68 12h6v32H68z'/></svg>");
    --rune-tile: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Crect width='12' height='12' fill='none'/%3E%3Cpath d='M6 0h1v2H6zM10 4h2v1h-2zM0 9h2v1H0zM3 3h1v1H3zM8 8h1v1H8zM5 6h2v1H5z' fill='%23f6c36a' opacity='.52'/%3E%3C/svg%3E");
    --rune-border: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24'%3E%3Cpath d='M0 10h2v4H0zM22 10h2v4h-2zM10 0h4v2h-4zM10 22h4v2h-4zM4 4h2v2H4zM18 4h2v2h-2zM4 18h2v2H4zM18 18h2v2h-2z' fill='%23f6c36a' opacity='.55'/%3E%3C/svg%3E");
    --pixel-font: "Press Start 2P", "VT323", "Pixel Operator", "IBM Plex Mono", monospace;
    --viewport-height: 100vh;
}

@supports (height: 100svh) {
    :root { --viewport-height: 100svh; }
}
@supports (height: 100dvh) {
    :root { --viewport-height: 100dvh; }
}

* {
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

/* ÈªòËÆ§Á¶ÅÊ≠¢ÈÄâ‰∏≠ÊñáÊú¨ */
html, body, #app {
    -webkit-user-select: none;
    user-select: none;
}
button {
    -webkit-user-select: none;
    user-select: none;
    white-space: nowrap;
}

body.orientation-blocked {
    overflow: hidden;
}
#orientation-lock {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    padding: calc(24px + env(safe-area-inset-top, 0px)) calc(20px + env(safe-area-inset-right, 0px)) calc(24px + env(safe-area-inset-bottom, 0px)) calc(20px + env(safe-area-inset-left, 0px));
    background: rgba(8,4,12,0.9);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 3000;
    text-align: center;
    color: #f6eefa;
}
#orientation-lock.show {
    display: flex;
}
#orientation-lock .orientation-card {
    border: 1px solid rgba(246,195,106,0.45);
    border-radius: 18px;
    padding: 16px 18px;
    background:
        linear-gradient(135deg, rgba(246,195,106,0.12), rgba(0,0,0,0.5)),
        rgba(12,8,14,0.85);
    box-shadow: 0 18px 46px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.08);
    max-width: 320px;
    width: 100%;
}
#orientation-lock .orientation-title {
    margin: 0 0 6px 0;
    letter-spacing: 0.08em;
    font-weight: 700;
}
#orientation-lock .orientation-copy {
    margin: 0;
    color: rgba(244,233,245,0.78);
    line-height: 1.5;
    font-size: 14px;
}
@media (min-width: 901px) {
    #orientation-lock { display: none !important; }
}

/* Âè™ÂÖÅËÆ∏ÂØπËØùÊ∞îÊ≥°‰∏≠ÁöÑÊñáÂ≠óÂèØÈÄâ */
.story-bubble {
    -webkit-user-select: text;
    user-select: text;
}
.story-bubble.ai-placeholder {
    opacity: 0.96;
    color: rgba(249, 246, 251, 0.94);
    position: relative;
    background:
        repeating-linear-gradient(90deg, rgba(246, 195, 106, 0.08) 0 8px, rgba(216, 106, 138, 0.08) 8px 16px, transparent 16px 24px),
        linear-gradient(180deg, rgba(28, 14, 22, 0.92), rgba(8, 4, 12, 0.92));
    font-family: var(--pixel-font);
    letter-spacing: 0.08em;
    animation: placeholderPixelShell 2.25s steps(5, end) infinite;
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    image-rendering: pixelated;
}
.story-bubble.ai-placeholder[data-placeholder-variant="alert-link"] {
    animation-duration: 1.6s;
    text-shadow: 0 0 10px rgba(246, 195, 106, 0.5);
}
.story-bubble.ai-placeholder.ai-placeholder-active {
    transform-origin: center left;
}
.story-bubble.ai-placeholder:not(.ai-placeholder-active) {
    animation-play-state: paused;
}
.story-bubble.ai-placeholder:not(.ai-placeholder-active)::before,
.story-bubble.ai-placeholder:not(.ai-placeholder-active)::after,
.story-bubble.ai-placeholder:not(.ai-placeholder-active) .bubble-content,
.story-bubble.ai-placeholder:not(.ai-placeholder-active) .bubble-content::after {
    animation-play-state: paused;
}
.story-bubble.ai-placeholder::before {
    inset: 4px;
    border-radius: 14px;
    border: 1px solid rgba(246, 195, 106, 0.55);
    background:
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.09) 0 2px, transparent 2px 5px),
        linear-gradient(90deg, rgba(246, 195, 106, 0.12), transparent 40%, rgba(216, 106, 138, 0.12));
    opacity: 0.7;
    filter: grayscale(0.15);
    animation: placeholderPixelFrame 1.6s steps(4, end) infinite;
}
.story-bubble.ai-placeholder::after {
    inset: 8px;
    border-radius: 10px;
    background:
        linear-gradient(180deg, rgba(246, 195, 106, 0.14), rgba(216, 106, 138, 0.08)),
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.08) 0 2px, transparent 2px 6px);
    mix-blend-mode: screen;
    opacity: 0.78;
    animation: placeholderScan 1.3s steps(8, end) infinite;
}
.story-bubble.ai-placeholder.ai-placeholder-error {
    opacity: 0.75;
    filter: saturate(0.75);
}
.story-bubble.ai-placeholder .bubble-rune {
    filter: grayscale(0.4);
    opacity: 0.78;
}
.story-bubble.ai-placeholder .bubble-content {
    position: relative;
    animation: placeholderPixelText 1.05s steps(3, end) infinite;
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.6), 0 0 8px rgba(246, 195, 106, 0.42);
}
.story-bubble.ai-placeholder .bubble-content::after {
    content: "‚ñÆ ‚ñØ ‚ñÆ";
    display: inline-block;
    margin-left: 8px;
    font-family: var(--pixel-font);
    letter-spacing: 0.08em;
    opacity: 0.9;
    color: rgba(246, 195, 106, 0.9);
    animation: placeholderCaret 0.85s steps(3, end) infinite;
}
@keyframes placeholderPixelShell {
    0% { transform: translateY(0); box-shadow: 0 0 0 0 rgba(246, 195, 106, 0.18); filter: brightness(0.96); }
    45% { transform: translateY(-1px); box-shadow: 0 0 0 1px rgba(246, 195, 106, 0.32), 0 0 20px rgba(246, 195, 106, 0.18); filter: brightness(1); }
    100% { transform: translateY(0); box-shadow: 0 0 0 0 rgba(246, 195, 106, 0.18); filter: brightness(0.98); }
}
@keyframes placeholderPixelFrame {
    0% { background-position: 0 0, 0 0; opacity: 0.52; }
    50% { background-position: 0 -6px, 30% 0; opacity: 0.8; }
    100% { background-position: 0 -12px, 60% 0; opacity: 0.6; }
}
@keyframes placeholderScan {
    0% { background-position: 0 0, 0 0; }
    100% { background-position: 0 10px, 16px 0; }
}
@keyframes placeholderPixelText {
    0% { letter-spacing: 0.06em; transform: translateY(0); filter: drop-shadow(0 0 0 rgba(0,0,0,0.3)); }
    50% { letter-spacing: 0.1em; transform: translateY(-1px); filter: drop-shadow(1px 1px 0 rgba(0,0,0,0.4)); }
    100% { letter-spacing: 0.06em; transform: translateY(0); filter: drop-shadow(0 0 0 rgba(0,0,0,0.3)); }
}
@keyframes placeholderCaret {
    0%, 100% { opacity: 0.4; transform: translateY(1px) scaleY(0.96); }
    50% { opacity: 1; transform: translateY(-1px) scaleY(1); }
}

#story-input-row.input-locked textarea {
    caret-color: inherit;
}

#story-send.disabled,
#story-send:disabled,
.story-tools button.locked,
.story-tools button:disabled,
.continue-btn.locked,
.continue-btn:disabled {
    pointer-events: none;
    opacity: 0.62;
    filter: grayscale(0.55);
    transform: none !important;
    box-shadow: none !important;
}
#story-send.busy {
    position: relative;
    color: var(--accent);
}
#story-send.busy::after {
    content: "‚ñå‚ñç‚ñä";
    position: absolute;
    inset: 50% auto auto 50%;
    transform: translate(-50%, -50%);
    font-family: var(--pixel-font);
    font-size: 11px;
    letter-spacing: 0.08em;
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.55), 0 0 8px rgba(246, 195, 106, 0.45);
    animation: sendPixelDots 0.85s steps(3, end) infinite;
}
@keyframes sendPixelDots {
    0% { opacity: 0.4; transform: translate(-50%, -50%) scale(0.96); }
    50% { opacity: 1; transform: translate(-50%, -54%) scale(1.04); }
    100% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.96); }
}

body {
    margin: 0;
    min-height: var(--viewport-height);
    font-family: -apple-system, BlinkMacSystemFont, system-ui, "SF Pro Display", serif;
    color: var(--text-main);
    background:
        radial-gradient(120% 120% at 14% 6%, rgba(120, 16, 38, 0.32), transparent 58%),
        radial-gradient(140% 140% at 88% 92%, rgba(66, 16, 95, 0.35), transparent 62%),
        radial-gradient(110% 110% at 50% 12%, rgba(35, 12, 30, 0.32), transparent 55%),
        linear-gradient(135deg, #0d050a 0%, #08030f 32%, #0b0714 66%, #05010a 100%);
    display: flex;
    justify-content: center;
    align-items: stretch;
    overflow: hidden;          /* üîí ÈîÅ‰ΩèÊï¥È°µÊªöÂä®Êù° */
    position: relative;
}

body::before,
body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

body::before {
    background:
        radial-gradient(80% 60% at 10% 12%, rgba(255, 110, 140, 0.08), transparent 55%),
        radial-gradient(80% 60% at 88% 82%, rgba(140, 80, 255, 0.1), transparent 65%),
        repeating-linear-gradient(0deg, transparent 0, transparent 2px, rgba(255, 255, 255, 0.015) 2px, rgba(255, 255, 255, 0.015) 3px);
    mix-blend-mode: screen;
    opacity: 0.65;
}

body::after {
    background:
        radial-gradient(circle at 50% 30%, rgba(245, 192, 112, 0.12), transparent 38%),
        radial-gradient(circle at 70% 68%, rgba(120, 18, 44, 0.18), transparent 52%),
        repeating-radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.03) 0 1px, transparent 1px 3px);
    filter: blur(0.4px);
    opacity: 0.85;
}

/* Â§ñÂ±ÇÂ∏ÉÂ±ÄÔºöPC ‰∏äÂ∑¶Âè≥ÊéíÂàóÔºåÊâãÊú∫‰∏ä‰∏ä‰∏ãÊéíÂàó */
#app {
    width: 100%;  
    height: 100%;              /* Â°´Êª° body */
    padding: 14px;
    padding-top: calc(14px + env(safe-area-inset-top, 0px));
    padding-bottom: calc(14px + env(safe-area-inset-bottom, 0px));
    padding-left: calc(14px + env(safe-area-inset-left, 0px));
    padding-right: calc(14px + env(safe-area-inset-right, 0px));
    display: flex;
    gap: 14px;
    align-items: stretch;
    position: relative;
    z-index: 1;
    isolation: isolate;
}

body.mobile-mode #app {
    flex-direction: column;
}
body.shell-hosted .story-title {
    display: none;
}
body.shell-hosted #story-header {
    padding-left: 12px;
}

/* PC Ê®°Âºè‰∏ãÂÖÅËÆ∏ÈÄöËøá phone-open ÊéßÂà∂ÊòØÂê¶Â±ïÁ§∫ÊâãÊú∫ÔºàÈÖçÂêàÊµÆÁ™óÊåâÈíÆÊî∂Ëµ∑/Â±ïÂºÄÔºâ */
body.pc-mode:not(.phone-open) #phone-layer {
    display: none;
}

/* ÂâßÊÉÖ‰∏ªÈù¢Êùø */
#story-panel {
    flex: 1;
    min-height: 80vh;
    border-radius: 22px;
    padding: 14px 14px 16px;
    --story-header-height: 34px;
    position: relative;
    z-index: 1;
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 65%),
        radial-gradient(circle at 60% 60%, rgba(200, 80, 110, 0.18), transparent 65%),
        linear-gradient(180deg, #2a0f18 0%, #090609 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    display: flex;
    flex-direction: column;
}

#story-header {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    padding: 4px 0 6px;
    border-bottom: 1px solid rgba(246, 195, 106, 0.18);
    margin-bottom: 6px;
    min-height: auto;
    line-height: 1.3;
}

.story-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #fbe8d3;
    text-shadow:
        0 0 14px rgba(246, 195, 106, 0.35),
        0 1px 0 rgba(0,0,0,0.65);
    padding: 4px 0;
}

.story-subtitle {
    margin: 0;
    font-size: 12px;
    color: rgba(233, 210, 225, 0.82);
    letter-spacing: 0.14em;
    margin-left: 4em;
    position: relative;
    padding-left: 14px;
}
.story-subtitle::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%;
    width: 1px;
    height: 18px;
    background: rgba(233,210,225,0.6);
    transform: translateY(-50%);
}

.story-restore-hint {
    font-size: 11px;
    color: #f6c36a;
    letter-spacing: 0.06em;
    text-shadow: 0 0 8px rgba(246, 195, 106, 0.32);
}

/* ÂâßÊÉÖÂÜÖÂÆπÂå∫ + ËæìÂÖ•Âå∫ */
#story-log {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    position: relative;
    width: 100%;
    z-index: 5;
}

/* ÈöêËóèÊªöÂä®Êù°Ê†∑Âºè */
#story-log::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-log {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#story-scroll-bottom {
    position: absolute;
    right: 16px;
    bottom: 18px;
    width: 46px;
    height: 46px;
    border-radius: 14px;
    border: 1px solid rgba(246,195,106,0.32);
    background:
        radial-gradient(140% 140% at 18% 18%, rgba(246,195,106,0.18), transparent 58%),
        radial-gradient(120% 120% at 76% 78%, rgba(118, 64, 120, 0.26), transparent 60%),
        rgba(9, 4, 12, 0.86);
    box-shadow:
        0 12px 26px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        0 6px 20px rgba(246, 195, 106, 0.22);
    color: #fbe0a6;
    display: grid;
    place-items: center;
    cursor: pointer;
    opacity: 0;
    transform: translateY(12px) scale(0.96);
    pointer-events: none;
    transition: opacity 0.24s ease, transform 0.24s ease, box-shadow 0.24s ease;
    z-index: 14;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}
#story-scroll-bottom::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(70% 70% at 50% 46%, rgba(246,195,106,0.28), transparent 68%);
    opacity: 0.65;
    pointer-events: none;
}
#story-scroll-bottom .chevron {
    font-size: 17px;
    line-height: 1;
    text-shadow: 0 0 10px rgba(246,195,106,0.65);
    animation: scrollHint 1.4s ease-in-out infinite;
}
#story-scroll-bottom.visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}
#story-scroll-bottom:active {
    transform: translateY(2px) scale(0.97);
    box-shadow:
        0 8px 20px rgba(0, 0, 0, 0.58),
        0 0 0 1px rgba(246,195,106,0.3),
        0 4px 14px rgba(246, 195, 106, 0.24);
}

@keyframes scrollHint {
    0%, 100% { transform: translateY(-1px); }
    50% { transform: translateY(2px); }
}

.story-hide-text #story-scroll-bottom {
    display: none;
}

@media (max-width: 900px) {
    #story-scroll-bottom {
        right: 12px;
        bottom: 14px;
        width: 42px;
        height: 42px;
    }
}

.story-bubble {
    position: relative;
    margin: 0;
    padding: 14px 20px;
    border-radius: 26px;
    font-size: var(--story-font-size, 13px);
    line-height: 1.45;
    width: auto;
    max-width: 88%;
    min-width: fit-content;
    border: 1px solid rgba(246, 195, 106, 0.18);
    background:
        radial-gradient(120% 140% at 16% 18%, rgba(124, 16, 37, 0.22), transparent 60%),
        radial-gradient(120% 120% at 82% 72%, rgba(72, 32, 120, 0.18), transparent 58%),
        repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0 1px, transparent 1px 8px),
        linear-gradient(150deg, rgba(16, 8, 14, 0.96), rgba(6, 2, 10, 0.9));
    box-shadow:
        0 18px 32px rgba(0, 0, 0, 0.68),
        0 0 22px rgba(124, 16, 37, 0.25),
        inset 0 0 0 1px rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    align-self: flex-start;
    display: inline-block;
    z-index: 1;
    isolation: isolate;
    overflow: visible;
}

.story-bubble.bubble-hover {
    box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.5),
        0 0 18px rgba(246, 195, 106, 0.12),
        inset 0 0 0 1px rgba(246, 195, 106, 0.08);
}
.story-bubble.bubble-narration.bubble-hover {
    animation: narrGlow 3s ease-in-out infinite;
}
.story-bubble.bubble-action.bubble-hover {
    animation: actionShakeHover 0.45s ease-in-out;
}
.story-bubble.dialogue-intim.bubble-hover {
    box-shadow:
        0 0 20px rgba(255, 210, 210, 0.4),
        0 0 26px rgba(255, 150, 170, 0.32);
    animation: intimatePulse 2.4s ease-in-out infinite;
}
.story-bubble.dialogue-threat.bubble-hover {
    border-color: rgba(214, 64, 64, 0.45);
    box-shadow:
        0 0 16px rgba(214, 64, 64, 0.45),
        0 0 32px rgba(124, 16, 37, 0.3);
    animation: threatPulse 1.6s ease-in-out infinite;
}
.story-bubble.dialogue-command.bubble-hover {
    animation: commandRipple 1.2s ease-in-out infinite;
}

.story-bubble.bubble-press {
    transform: translateY(1px) scale(0.99);
    box-shadow:
        0 10px 22px rgba(0, 0, 0, 0.6),
        0 0 14px rgba(124, 16, 37, 0.24),
        inset 0 0 0 1px rgba(246, 195, 106, 0.1);
}

.story-bubble.bubble-clicked::after {
    animation: bubbleClickRing 0.6s ease-out;
}

.story-bubble.bubble-clicked {
    animation: bubbleClickLift 0.35s ease;
}

@keyframes bubbleClickRing {
    0% { opacity: 0.45; transform: scale(0.9); }
    70% { opacity: 0.15; transform: scale(1.12); }
    100% { opacity: 0; transform: scale(1.2); }
}

@keyframes bubbleClickLift {
    0% { transform: translateY(0); }
    40% { transform: translateY(-1px); }
    100% { transform: translateY(0); }
}

@keyframes narrGlow {
    0% { transform: translateY(0); filter: drop-shadow(0 0 10px rgba(246,195,106,0.2)); }
    50% { transform: translateY(-3px); filter: drop-shadow(0 0 16px rgba(246,195,106,0.32)); }
    100% { transform: translateY(0); filter: drop-shadow(0 0 10px rgba(246,195,106,0.2)); }
}
@keyframes actionShakeHover {
    0% { transform: translate(0,0) rotate(0deg); }
    20% { transform: translate(-2px, 1px) rotate(-0.8deg); }
    50% { transform: translate(2px, -1px) rotate(0.6deg); }
    80% { transform: translate(-1px, 2px) rotate(-0.4deg); }
    100% { transform: translate(0,0) rotate(0deg); }
}
@keyframes intimatePulse {
    0% { transform: translateY(0) scale(1); }
    40% { transform: translateY(-2px) scale(1.01); }
    70% { transform: translateY(-1px) scale(1.005); }
    100% { transform: translateY(0) scale(1); }
}
@keyframes threatPulse {
    0% { box-shadow: 0 0 10px rgba(214,64,64,0.35); }
    50% { box-shadow: 0 0 20px rgba(214,64,64,0.55), 0 0 36px rgba(124,16,37,0.4); }
    100% { box-shadow: 0 0 10px rgba(214,64,64,0.35); }
}
@keyframes commandRipple {
    0% { transform: translateY(0); }
    35% { transform: translateY(-2px); box-shadow: 0 0 14px rgba(255,192,112,0.3); }
    70% { transform: translateY(1px); box-shadow: 0 0 8px rgba(255,192,112,0.18); }
    100% { transform: translateY(0); box-shadow: none; }
}

.story-bubble.bubble-etched {
    border-image-source: var(--rune-border);
    border-image-slice: 10 fill;
    border-image-repeat: round;
    box-shadow:
        0 12px 22px rgba(0, 0, 0, 0.55),
        0 0 18px rgba(246, 195, 106, 0.18),
        inset 0 0 0 1px rgba(246, 195, 106, 0.1);
}

.story-bubble::before,
.story-bubble::after {
    content: "";
    position: absolute;
    border-radius: 24px;
    pointer-events: none;
    opacity: 0.35;
    inset: 4px;
    transition: opacity 0.3s ease;
}
.story-bubble::before {
    inset: -6px;
    border-radius: 28px;
    border: 1px solid rgba(246, 195, 106, 0.18);
    background:
        conic-gradient(from 120deg, rgba(255, 195, 122, 0.18), transparent 120deg, rgba(255, 132, 172, 0.15), transparent 240deg),
        radial-gradient(circle at 78% 22%, rgba(255, 195, 122, 0.16), transparent 52%),
        radial-gradient(circle at 20% 70%, rgba(124, 16, 37, 0.12), transparent 60%);
    filter: blur(0.2px);
    opacity: 0.28;
}
.story-bubble::after {
    inset: 8px;
    border-radius: 18px;
    background:
        repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.04) 0 1px, transparent 1px 7px),
        radial-gradient(130% 120% at 14% 18%, rgba(246, 195, 106, 0.12), transparent 55%),
        radial-gradient(120% 110% at 86% 80%, rgba(124, 16, 37, 0.12), transparent 60%);
    mix-blend-mode: screen;
    filter: blur(0.2px);
}

.story-bubble .bubble-rune {
    position: absolute;
    width: 18px;
    height: 18px;
    top: -10px;
    right: -6px;
    background: var(--rune-tile);
    image-rendering: pixelated;
    opacity: 0.76;
    filter: drop-shadow(0 0 8px rgba(246, 195, 106, 0.4));
    animation: runeBlink 3.6s ease-in-out infinite alternate;
    cursor: pointer;
}

.story-bubble .bubble-rune:hover {
    opacity: 1;
    filter: drop-shadow(0 0 12px rgba(246, 195, 106, 0.7));
}

.story-bubble .bubble-rune::after {
    content: "";
    position: absolute;
    inset: -10px;
    background:
        radial-gradient(circle, rgba(246, 195, 106, 0.4), transparent 50%),
        radial-gradient(circle at 70% 30%, rgba(124, 16, 37, 0.26), transparent 60%);
    opacity: 0;
    pointer-events: none;
    border-radius: 50%;
    filter: blur(8px);
}

.story-bubble .bubble-rune.burst::after {
    animation: runeBurst 0.8s ease-out forwards;
}

@keyframes runeBlink {
    0% { transform: translateY(0) scale(1); opacity: 0.65; }
    50% { transform: translateY(-2px) scale(1.08); opacity: 0.9; }
    100% { transform: translateY(1px) scale(1.02); opacity: 0.7; }
}

@keyframes runeBurst {
    0% { opacity: 0.8; transform: scale(0.6); }
    50% { opacity: 0.45; transform: scale(1.2); }
    100% { opacity: 0; transform: scale(1.5); }
}

.story-bubble.bubble-center {
    align-self: center;
    text-align: center;
}

.story-bubble .bubble-content {
    position: relative;
    z-index: 2;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    letter-spacing: 0.01em;
    text-shadow:
        0 0 8px rgba(246, 195, 106, 0.12),
        0 0 16px rgba(60, 14, 38, 0.35);
}

.story-bubble .bubble-fold {
    width: min(90%, 520px);
    margin: 4px auto 12px;
    background:
        linear-gradient(135deg, rgba(246, 195, 106, 0.12), rgba(60, 16, 34, 0.35)),
        rgba(16, 8, 16, 0.72);
    border: 1px solid rgba(246, 195, 106, 0.26);
    border-radius: 14px;
    overflow: hidden;
    box-shadow:
        0 10px 26px rgba(0, 0, 0, 0.5),
        0 0 18px rgba(246, 195, 106, 0.12);
    position: relative;
}
.story-bubble .bubble-fold::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(120% 120% at 30% 0%, rgba(255, 255, 255, 0.08), transparent 55%);
    pointer-events: none;
}
.story-bubble .bubble-fold .fold-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 10px 12px;
    color: #fbe7cf;
    font-weight: 700;
    letter-spacing: 0.06em;
}
.story-bubble .bubble-fold .fold-title {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    position: relative;
}
.story-bubble .bubble-fold .fold-title::before {
    content: "‚úâ";
    font-size: 12px;
    opacity: 0.8;
}
.story-bubble .bubble-fold .fold-toggle {
    border: 1px solid rgba(246, 195, 106, 0.5);
    background: rgba(246, 195, 106, 0.12);
    color: #f6c36a;
    border-radius: 10px;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.2s ease;
}
.story-bubble .bubble-fold .fold-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35);
}
.story-bubble .bubble-fold .fold-body {
    max-height: 0;
    overflow: hidden;
    padding: 0 12px;
    transition: max-height 0.25s ease, padding 0.2s ease;
    border-top: 1px dashed rgba(246, 195, 106, 0.28);
    background: rgba(8, 4, 10, 0.55);
}
.story-bubble .bubble-fold.open .fold-body {
    padding: 12px 14px 14px;
}
.story-bubble .bubble-fold .fold-body p {
    margin: 6px 0;
    color: #f5ecff;
    text-align: left;
}

.story-bubble.bubble-user {
    align-self: flex-end;
    background:
        radial-gradient(110% 110% at 80% 22%, rgba(246, 195, 106, 0.12), transparent 60%),
        radial-gradient(120% 120% at 18% 64%, rgba(124, 16, 37, 0.25), transparent 62%),
        linear-gradient(145deg, rgba(76, 12, 26, 0.96), rgba(32, 8, 18, 0.92));
    color: #fff4f8;
    text-align: right;
    border-color: rgba(246, 195, 106, 0.22);
    box-shadow:
        0 14px 30px rgba(124, 16, 37, 0.35),
        inset 0 0 18px rgba(246, 195, 106, 0.08);
}

.story-bubble.bubble-assistant {
    align-self: flex-start;
    color: #f9f6fb;
    text-align: left;
}

.story-bubble.dialog-short {
    padding: 12px 16px;
    box-shadow: 0 0 22px rgba(255,170,205,0.12);
}

.story-bubble.dialog-long {
    background:
        radial-gradient(120% 120% at 82% 20%, rgba(246, 195, 106, 0.08), transparent 70%),
        linear-gradient(150deg, rgba(12, 6, 12, 0.92), rgba(6, 2, 10, 0.82));
    box-shadow: 0 0 22px rgba(124, 16, 37, 0.22);
}

.story-bubble.bubble-thought {
    max-width: 74%;
    color: #f4e4ff;
    background:
        radial-gradient(circle at 24% 30%, rgba(246, 195, 106, 0.1), transparent 48%),
        radial-gradient(circle at 78% 24%, rgba(120, 80, 200, 0.12), transparent 48%),
        linear-gradient(145deg, rgba(38, 14, 58, 0.9), rgba(12, 6, 20, 0.78));
    box-shadow: 0 20px 40px rgba(74, 20, 90, 0.38), inset 0 0 18px rgba(246, 195, 106, 0.06);
    position: relative;
}

.story-bubble.bubble-thought::after {
    content: "";
    position: absolute;
    inset: 10% 16%;
    border-radius: 40%;
    border: 1px solid rgba(255,190,255,0.2);
    filter: blur(8px);
    opacity: 0.6;
    animation: thoughtPulse 4s ease-in-out infinite;
}

.story-bubble.bubble-thought + .story-bubble.bubble-thought {
    margin-top: 14px;
}

.story-bubble.bubble-narration {
    max-width: 82%;
    color: #ffe5d6;
    background:
        radial-gradient(circle at 18% 22%, rgba(246, 195, 106, 0.08), transparent 58%),
        radial-gradient(circle at 80% 80%, rgba(124, 16, 37, 0.12), transparent 60%),
        linear-gradient(150deg, rgba(18, 8, 18, 0.9), rgba(8, 3, 10, 0.78));
    border: 1px solid rgba(246, 195, 106, 0.16);
    text-align: left;
}

.story-bubble.bubble-narration::after {
    bottom: -24px;
    left: 10px;
    width: 90px;
    height: 90px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    opacity: 0.3;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.04);
}

.story-bubble.bubble-narration + .story-bubble.bubble-narration {
    margin-top: 6px;
}

.story-bubble.bubble-system-input {
    border: 1px dashed rgba(255, 200, 210, 0.25);
    box-shadow: 0 0 24px rgba(255, 150, 190, 0.18);
}
.story-bubble.bubble-prompt {
    align-self: flex-end;
    text-align: right;
    border-color: rgba(246, 195, 106, 0.36);
    background:
        radial-gradient(110% 110% at 82% 22%, rgba(246, 195, 106, 0.16), transparent 60%),
        linear-gradient(150deg, rgba(54, 18, 28, 0.85), rgba(18, 10, 16, 0.86));
}
.story-bubble.bubble-prompt .bubble-system-chip {
    left: auto;
    right: 14px;
}

.bubble-system-chip {
    position: absolute;
    top: -11px;
    left: 18px;
    font-size: 10px;
    letter-spacing: 0.18em;
    color: rgba(255, 220, 240, 0.8);
    text-transform: uppercase;
    z-index: 5;
}

.story-bubble.bubble-user .bubble-system-chip {
    left: auto;
    right: 18px;
}

.story-bubble.bubble-action {
    color: #ffe1e1;
    background:
        radial-gradient(120% 120% at 70% 30%, rgba(246, 195, 106, 0.1), transparent 65%),
        linear-gradient(145deg, rgba(52, 10, 22, 0.95), rgba(16, 6, 14, 0.85));
    box-shadow:
        0 12px 32px rgba(120, 30, 50, 0.34),
        inset 0 0 30px rgba(246, 195, 106, 0.08);
}

.story-bubble.dialogue {
    max-width: 75%;
    border-radius: 26px;
    padding: 12px 20px;
    line-height: 1.55;
    color: #f8ecff;
    background:
        radial-gradient(120% 120% at 18% 24%, rgba(246, 195, 106, 0.1), transparent 60%),
        radial-gradient(120% 120% at 86% 78%, rgba(70, 24, 120, 0.16), transparent 62%),
        linear-gradient(150deg, rgba(16, 10, 18, 0.82), rgba(8, 6, 12, 0.74));
    border: 1px solid rgba(246, 195, 106, 0.16);
    box-shadow:
        0 0 18px rgba(124, 16, 37, 0.16),
        inset 0 0 6px rgba(255, 255, 255, 0.05);
    text-align: left;
}

.story-bubble.dialogue .bubble-content {
    animation: dialogueBreath 3.2s ease-in-out infinite;
}

.story-bubble.dialogue-tight {
    letter-spacing: 0.04em;
    font-size: 13.2px;
}

.story-bubble.dialogue-normal {
    background:
        radial-gradient(circle at 30% 20%, rgba(246, 195, 106, 0.12), transparent 60%),
        radial-gradient(circle at 82% 74%, rgba(80, 26, 120, 0.14), transparent 62%),
        linear-gradient(140deg, rgba(18, 10, 24, 0.85), rgba(6, 4, 12, 0.7));
}

.story-bubble.dialogue-whisper-dark {
    padding-top: 18px;
    padding-bottom: 18px;
    box-shadow:
        0 14px 32px rgba(8, 10, 18, 0.8),
        inset 0 0 18px rgba(152, 196, 255, 0.15);
}

.story-bubble.dialogue-intim {
    padding-top: 16px;
    padding-bottom: 16px;
    background:
        linear-gradient(145deg, rgba(16, 8, 18, 0.92), rgba(46, 12, 16, 0.85)),
        radial-gradient(circle at 70% 40%, rgba(246, 195, 106, 0.18), transparent 60%);
}

.story-bubble.dialogue-threat {
    border-color: rgba(255, 100, 120, 0.6);
    background: linear-gradient(150deg, rgba(18, 6, 10, 0.95), rgba(40, 6, 12, 0.9));
    box-shadow:
        0 16px 38px rgba(255, 70, 90, 0.25),
        inset 0 0 18px rgba(255, 80, 120, 0.18);
}

.story-bubble.dialogue-command {
    border-color: rgba(255, 200, 180, 0.25);
    background: linear-gradient(150deg, rgba(16, 6, 12, 0.9), rgba(45, 12, 10, 0.85));
    box-shadow: 0 12px 28px rgba(255, 180, 110, 0.18);
}

.story-bubble.dialogue-low {
    background: rgba(8, 8, 12, 0.8);
    opacity: 0.95;
}

.story-bubble.dialogue-low {
    background:
        radial-gradient(circle at 80% 50%, rgba(255,190,220,0.1), transparent 70%),
        linear-gradient(150deg, rgba(15,10,18,0.76), rgba(4,2,8,0.6));
    border-color: rgba(255,255,255,0.04);
    color: rgba(247,244,255,0.85);
    box-shadow: 0 0 14px rgba(255,190,220,0.16);
}

.story-bubble.dialogue-low .bubble-content {
    animation-duration: 3.8s;
}

.story-bubble.dialogue-command {
    background:
        radial-gradient(circle at 15% 40%, rgba(255,110,150,0.2), transparent 65%),
        linear-gradient(145deg, rgba(26,8,12,0.9), rgba(6,4,6,0.78));
    border-color: rgba(255,120,150,0.28);
    box-shadow:
        0 0 18px rgba(255,70,110,0.25),
        inset 0 0 6px rgba(255,160,160,0.08);
}

.story-bubble.dialogue-threat {
    background:
        radial-gradient(circle at 40% 50%, rgba(180,20,40,0.18), transparent 70%),
        linear-gradient(150deg, rgba(8,0,0,0.88), rgba(6,0,0,0.72));
    border-color: rgba(255,80,100,0.35);
    color: #ffd9d9;
    box-shadow:
        0 0 20px rgba(255,30,60,0.22),
        inset 0 0 10px rgba(255,120,120,0.08);
}

.story-bubble.dialogue-intim {
    background:
        radial-gradient(circle at 65% 70%, rgba(255,200,150,0.15), transparent 75%),
        linear-gradient(140deg, rgba(40,6,22,0.9), rgba(18,4,16,0.78));
    border-color: rgba(255,200,160,0.28);
    box-shadow:
        0 0 18px rgba(255,180,150,0.2),
        inset 0 0 12px rgba(255,255,255,0.08);
}

.story-bubble.dialogue-whisper-dark {
    background:
        radial-gradient(circle at 60% 30%, rgba(60,20,80,0.25), transparent 80%),
        linear-gradient(160deg, rgba(6,2,10,0.9), rgba(2,0,6,0.8));
    border-color: rgba(130,110,200,0.28);
    color: #e4ddff;
    filter: drop-shadow(0 0 16px rgba(80,40,120,0.35));
}

.story-bubble.dialogue .bubble-particle {
    background: radial-gradient(circle, rgba(170,200,255,0.35), transparent 80%);
}

.story-bubble.dialogue-threat .bubble-particle {
    background: radial-gradient(circle, rgba(255,120,120,0.45), transparent 80%);
}

.story-bubble.dialogue-intim .bubble-particle {
    background: radial-gradient(circle, rgba(255,210,150,0.45), transparent 80%);
}

.story-bubble.dialogue-whisper-dark .bubble-particle {
    background: radial-gradient(circle, rgba(150,110,200,0.45), transparent 80%);
}

@keyframes dialogueBreath {
    0%, 100% { opacity: 0.95; }
    50% { opacity: 1; }
}

@keyframes thoughtPulse {
    0% { transform: scale(0.95); opacity: 0.4; }
    50% { transform: scale(1.05); opacity: 0.7; }
    100% { transform: scale(0.95); opacity: 0.4; }
}

.story-bubble.bubble-system {
    align-self: center;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 18px;
    max-width: 90%;
    font-size: 12px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: linear-gradient(180deg, rgba(10, 10, 12, 0.95), rgba(2, 2, 4, 0.85));
    color: #f9f7ff;
    position: relative;
    overflow: visible;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
}

.story-bubble.bubble-system::before,
.story-bubble.bubble-system::after {
    display: none;
}

.bubble-system .system-icon {
    position: absolute;
    width: 22px;
    height: 22px;
    image-rendering: pixelated;
    top: var(--icon-offset-y, -12px);
    pointer-events: none;
    filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.35));
}

.bubble-system .system-icon[data-side="left"] {
    left: -18px;
}

.bubble-system .system-icon[data-side="right"] {
    right: -18px;
}

/* Shrink initializer bubbles padding on mobile */
.story-bubble.bubble-init {
    padding: 4px 6px !important;
    border-radius: 14px;
}
.story-bubble.bubble-init .bubble-content {
    padding: 0 !important;
}

.initializer-bubbles {
    display: grid;
    gap: 4px;
    margin: 6px;
    max-width: min(520px, calc(100vw - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 4px));
    align-items: flex-start;
    margin-top: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}
.initializer-bubbles .bubble-init {
    width: min(520px, 100%);
    max-width: 100%;
    border: 1px solid rgba(246,195,106,0.5);
    background: linear-gradient(145deg, rgba(29,16,28,0.9), rgba(6,4,8,0.75));
    box-shadow: 0 16px 40px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.05);
    padding: 8px 10px;
    border-radius: 14px;
}
.initializer-bubbles .bubble-init.status .bubble-main-text { display: grid; gap: 6px; }
.initializer-bubbles .bubble-init.actions .bubble-content { padding: 10px 12px; }
.initializer-bubbles .bubble-init .bubble-content {
    padding: 6px 8px;
}
.initializer-bubbles .bubble-init .init-actions {
    display: flex;
    gap: 8px;
    padding: 2px 0;
    flex-wrap: wrap;
}
.initializer-bubbles .bubble-init .init-chip {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.45));
    border: 1px solid rgba(246,195,106,0.55);
    color: var(--accent, #f6c36a);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 10px 18px rgba(0,0,0,0.4);
    padding: 10px 14px;
    border-radius: 18px;
    cursor: pointer;
    font: inherit;
    text-shadow: 0 1px 2px rgba(0,0,0,0.35);
    min-width: 96px;
    white-space: nowrap;
}
.initializer-bubbles .bubble-init .init-chip.ghost {
    border-color: rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.35);
    color: #f6eefa;
    box-shadow: 0 10px 18px rgba(0,0,0,0.35);
}
.initializer-bubbles .bubble-init .init-message[data-tone="error"] { color: #ffbebe; }
.initializer-bubbles .bubble-init .init-message[data-tone="success"] { color: #c6ffa1; }
.initializer-bubbles .bubble-init .init-message[data-tone="info"] { color: rgba(244,233,245,0.9); }

@media (max-width: 520px) {
    .initializer-bubbles {
        margin: 10px 6px;
        max-width: 100%;
    }
    .initializer-bubbles .bubble-init .init-actions {
        flex-direction: column;
    }
    .initializer-bubbles .bubble-init .init-chip {
        width: 100%;
    }
}

.story-block {
    width: 100%;
    max-width: 100%;
    align-self: stretch;
    margin: 0;
    padding: 0 2%;
    font-size: var(--story-font-size, 13px);
    line-height: 1.4;
    color: #f6f0f5;
    -webkit-user-select: text;
    user-select: text;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-block.block-narration.block-bare {
    padding: 2px 0;
    background: none;
    color: #ffe6d2;
}

.story-block.block-narration.block-bare p {
    text-align: left;
    margin: 4px 0;
}

.story-block.block-reading {
    line-height: 1.65;
}

.story-block.block-key {
    text-align: center;
}

.poetic-line {
    display: block;
    letter-spacing: 0.08em;
}

.story-block p {
    margin: 0 0 6px;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-block p:last-child {
    margin-bottom: 0;
}

.narration-paragraph {
    text-align: left;
    letter-spacing: 0.02em;
}

.paragraph-ambient {
    font-style: italic;
    color: #f3d7ff;
}

.paragraph-soft {
    font-style: italic;
    color: #ffe7cf;
}

.story-block .key-sentence {
    text-align: center;
    font-size: 15px;
    color: #ffe4c7;
    text-shadow: 0 0 8px rgba(255,220,190,0.35);
    display: block;
    margin: 0 auto;
}

.thought-line {
    text-align: center;
    letter-spacing: 0.04em;
}

.sound-line {
    animation: soundGlow 2.8s ease-in-out infinite;
    color: #ffd3e1;
}

@keyframes soundGlow {
    0% { text-shadow: 0 0 6px rgba(255,150,200,0.2); }
    50% { text-shadow: 0 0 12px rgba(255,150,200,0.5); }
    100% { text-shadow: 0 0 6px rgba(255,150,200,0.2); }
}

.quote-highlight {
    color: #ffe7c9;
    background: linear-gradient(120deg, rgba(255,233,210,0.7), rgba(255,132,173,0.6));
    -webkit-background-clip: text;
    color: transparent;
    animation: quoteGlow 2.6s ease-in-out infinite;
}

@keyframes quoteGlow {
    0%, 100% { filter: drop-shadow(0 0 4px rgba(255,210,200,0.4)); }
    50% { filter: drop-shadow(0 0 8px rgba(255,160,200,0.6)); }
}

.action-verb-highlight {
    color: #ff9487;
    font-weight: 600;
}

.keyword-highlight {
    color: #ffd7b1;
    text-shadow: 0 0 8px rgba(255,200,150,0.4);
}

.heartbeat-light {
    animation: heartbeatGlow 1.8s ease-in-out infinite;
}

@keyframes heartbeatGlow {
    0%, 100% { box-shadow: 0 0 8px rgba(255,120,170,0.25); }
    50% { box-shadow: 0 0 20px rgba(255,140,190,0.35); }
}

.goldPinkGradientText {
    background: linear-gradient(120deg, #ffe7d0, #ff94c2);
    -webkit-background-clip: text;
    color: transparent;
}

.latin-ink {
    font-family: "Didot", "Times New Roman", "Baskerville", "STZhongsong", serif;
    font-variant-ligatures: discretionary-ligatures;
    letter-spacing: 0.08em;
    background: linear-gradient(120deg, #f6c36a, #d45f82, #5c2a82);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow:
        0 0 8px rgba(246, 195, 106, 0.4),
        0 0 16px rgba(60, 10, 28, 0.45);
}

.latin-ink.latin-upper {
    letter-spacing: 0.14em;
    text-transform: uppercase;
}

.latin-ink.latin-cursive {
    font-family: "Snell Roundhand", "Apple Chancery", "Didot", cursive;
    font-style: italic;
}

.key-sentence {
    display: inline-block;
    font-size: 1.02em;
    letter-spacing: 0.05em;
    color: #ffe9c0;
}

.kw-gaze,
.kw-close,
.kw-control,
.kw-rule,
.kw-env,
.kw-soft,
.kw-violence,
.kw-dread,
.kw-tech,
.kw-sense,
.kw-promise,
.em-strong {
    display: inline;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    line-height: inherit;
}

.em-strong {
    font-weight: 720;
    color: #ffe9b9;
    text-shadow: 0 0 6px rgba(255, 200, 160, 0.35);
}

.kw-gaze {
    color: #f0caa2;
    text-shadow: 0 0 6px rgba(255, 210, 160, 0.25);
}

.kw-close {
    background: linear-gradient(90deg, rgba(255,200,190,0.9), rgba(120,160,210,0.8));
    -webkit-background-clip: text;
    color: transparent;
    text-shadow: 0 0 6px rgba(250,170,200,0.2);
}

.kw-control {
    color: #ff8a9c;
    text-shadow: 0 0 4px rgba(255,70,90,0.4);
}

.kw-control:hover {
    text-shadow: 0 0 6px rgba(255,70,90,0.6);
}

.kw-rule {
    border-bottom: 1px dashed rgba(255,215,160,0.8);
    padding-bottom: 1px;
    transition: opacity 0.2s ease;
}

.kw-rule:hover {
    opacity: 0.8;
}

.kw-env {
    color: #c3c8ff;
    position: relative;
}

.kw-env::after {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(180deg, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 1px, transparent 1px, transparent 2px);
    opacity: 0.3;
    mix-blend-mode: screen;
    pointer-events: none;
}

.kw-soft {
    color: #ffe8c9;
}

.kw-violence {
    color: #ff6b6b;
    text-shadow: 0 0 6px rgba(255,0,0,0.35);
}

.kw-dread {
    color: #d4cbff;
    text-shadow: 0 0 8px rgba(110,90,200,0.35);
}

.kw-tech {
    color: #a4beff;
    text-shadow: 0 0 10px rgba(110,140,220,0.4);
}

.kw-sense {
    color: #ffe6cd;
}

.kw-promise {
    color: #ffd3b2;
    font-weight: 600;
    text-shadow: 0 0 6px rgba(255,190,150,0.35);
}

.italic-soft {
    font-style: italic;
    color: rgba(255, 215, 230, 0.9);
    text-shadow: 0 0 6px rgba(255, 150, 190, 0.25);
}

.strike-veil {
    position: relative;
    color: rgba(255,255,255,0.6);
}

.strike-veil::after {
    content: "";
    position: absolute;
    inset: 45% -6px -45%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    opacity: 0.4;
    animation: strikeMist 2.4s ease infinite;
}

@keyframes strikeMist {
    0% { transform: translateX(-20%); }
    50% { transform: translateX(20%); }
    100% { transform: translateX(-20%); }
}

.inline-code {
    font-family: inherit;
    color: inherit;
}

.story-bubble p {
    margin: 0 0 4px;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
}

.story-bubble p:last-child {
    margin-bottom: 0;
}

/* ËæìÂÖ•Ë°åÔºöÂõ∫ÂÆöÂú®ÂâßÊÉÖÂå∫Â∫ïÈÉ®ÔºåÈöèÂÆΩÂ∫¶Ëá™ÈÄÇÂ∫î */
#story-input-row {
    margin-top: auto;
    width: 100%;
    display: flex;
    align-items: flex-end;
    gap: 10px;
    position: relative;
    padding-top: 6px;
    z-index: 5;
}

/* Â§öË°å textareaÔºåÊñáÂ≠óÂûÇÁõ¥Â±Ö‰∏≠ÊÑü + Ëá™Âä®Â¢ûÈ´ò */
#story-input {
    flex: 1;
    padding: 12px 16px;
    border-radius: 18px;
    border: 1px solid rgba(246, 195, 106, 0.35);
    background: linear-gradient(180deg,
        rgba(40, 16, 28, 0.6),
        rgba(12, 8, 14, 0.9)
    );
    color: #f5e9f3;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    outline: none;

    min-height: 40px;     /* ‰∏§Ë°åËßÜËßâÈ´òÂ∫¶ */
    max-height: 70vh;     /* ÊúÄÂ§ßÂ±ïÂºÄÈ´òÂ∫¶ */
    overflow-y: auto;     /* ÂÜÖÈÉ®ÊªöÂä®Ôºå‰ΩÜÊù°ÈöêËóè */
    transition: border 0.2s ease, box-shadow 0.2s ease;
}

@supports (-webkit-touch-callout: none) {
    #story-input-row {
        padding-bottom: calc(6px + env(safe-area-inset-bottom, 0px));
    }
    #story-input,
    .character-sheet textarea,
    .character-sheet input[type="text"] {
        font-size: 16px;
    }
}

#story-input.system-mode {
    border-color: rgba(255, 220, 120, 0.6);
    box-shadow: 0 0 8px rgba(255, 220, 120, 0.25);
}

#story-input::-webkit-scrollbar {
    width: 0;
    height: 0;
}

.story-tools {
    position: relative;
    z-index: 12;
}

.story-tools-toggle {
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.12);
    background: linear-gradient(180deg, rgba(60,32,70,0.45), rgba(16,10,18,0.8));
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.08),
        0 0 14px rgba(255,200,160,0.26);
    color: #f6c36a;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 3px;
    cursor: pointer;
    transition: border 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.story-tools-toggle .tool-bar {
    width: 14px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255,255,255,0.75);
}

.story-tools-toggle.active {
    border-color: rgba(255,200,150,0.6);
    box-shadow:
        0 0 0 1px rgba(255,200,150,0.32),
        0 0 12px rgba(255,200,150,0.3);
    transform: translateY(-1px);
}

.story-tools-menu {
    position: absolute;
    bottom: 44px;
    right: 0;
    min-width: 260px;
    padding: 12px;
    border-radius: 16px;
    background: rgba(12, 8, 12, 0.92);
    border: 1px solid rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(14px);
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(8px) scale(0.95);
    transition: opacity 0.18s ease, transform 0.18s ease;
    z-index: 12;
}

.story-tools-menu.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

.story-tools-menu .menu-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 8px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.02);
}
.story-tools-menu .menu-group .menu-head {
    font-size: 12px;
    letter-spacing: 0.12em;
    color: rgba(255,255,255,0.72);
}
.story-tools-menu .menu-group .menu-subhead {
    font-size: 11px;
    color: rgba(255,255,255,0.55);
}

.menu-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.12);
    border-radius: 999px;
    width: 100%;
}

.menu-head {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: rgba(255, 255, 255, 0.6);
}

.menu-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-start;
}

.menu-row button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.05);
    color: #f5e9f3;
    font-size: 12px;
    cursor: pointer;
    transition: border 0.2s ease, background 0.2s ease;
}
.menu-row button[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
}

.menu-row button:hover {
    border-color: rgba(255, 220, 160, 0.8);
    background: rgba(255, 220, 160, 0.1);
}

.menu-row.restart-row button {
    flex: 1;
    min-width: 80px;
}

.menu-hint {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.5);
    letter-spacing: 0.08em;
}

.text-size-control {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
}

.text-size-control .text-size-label {
    font-size: 11px;
    letter-spacing: 0.05em;
    color: rgba(255, 255, 255, 0.65);
}

.text-size-control input[type="range"],
.memory-limit-control input[type="range"] {
    flex: 1;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(80,80,90,0.8), rgba(40,36,48,0.9));
    outline: none;
}

.text-size-control input[type="range"]::-webkit-slider-thumb,
.memory-limit-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 6px;
    background: linear-gradient(135deg, rgba(246,195,106,0.9), rgba(255,255,255,0.9));
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.28),
        0 4px 10px rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.4);
}
.text-size-control input[type="range"]::-moz-range-thumb,
.memory-limit-control input[type="range"]::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 6px;
    background: linear-gradient(135deg, rgba(246,195,106,0.9), rgba(255,255,255,0.9));
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.28),
        0 4px 10px rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.4);
}
.text-size-control input[type="range"]::-webkit-slider-runnable-track,
.memory-limit-control input[type="range"]::-webkit-slider-runnable-track {
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(80,80,90,0.8), rgba(30,28,36,0.95));
}
.text-size-control input[type="range"]::-moz-range-track,
.memory-limit-control input[type="range"]::-moz-range-track {
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(80,80,90,0.8), rgba(30,28,36,0.95));
}

.character-sheet input[type="range"] {
    width: 100%;
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(60,60,70,0.9), rgba(30,28,36,0.95));
    outline: none;
}
.character-sheet input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, #fff7d9, #f6c36a);
    box-shadow: 0 0 10px rgba(246,195,106,0.7);
    border: 1px solid rgba(255,255,255,0.3);
}
.character-sheet input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, #fff7d9, #f6c36a);
    box-shadow: 0 0 10px rgba(246,195,106,0.7);
    border: 1px solid rgba(255,255,255,0.3);
}
.character-sheet input[type="range"]::-webkit-slider-runnable-track {
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(50,50,60,0.9), rgba(26,22,32,0.95));
}
.character-sheet input[type="range"]::-moz-range-track {
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(50,50,60,0.9), rgba(26,22,32,0.95));
}

.text-size-control #story-font-value {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.75);
}

.provider-control {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    padding: 6px 8px;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.75);
}

.provider-control select {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: #f6eaf3;
    border-radius: 10px;
    padding: 4px 6px;
}

.memory-limit-control {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
    padding: 6px 8px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.03);
    font-size: 12px;
    color: rgba(255, 255, 255, 0.75);
    width: 100%;
}

.text-size-control input[type="range"]::-webkit-slider-thumb,
.memory-limit-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 40%, #fff, #f6c36a);
    box-shadow: 0 0 8px rgba(246,195,106,0.6);
    border: 1px solid rgba(255,255,255,0.35);
}
.text-size-control input[type="range"]::-moz-range-thumb,
.memory-limit-control input[type="range"]::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 40%, #fff, #f6c36a);
    box-shadow: 0 0 8px rgba(246,195,106,0.6);
    border: 1px solid rgba(255,255,255,0.35);
}

.menu-hint {
    font-size: 11px;
    color: rgba(255,255,255,0.6);
}

.memory-limit-control .memory-value {
    min-width: 20px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}

.icon-restart,
.icon-system {
    flex-shrink: 0;
}

.icon-window {
    width: 18px;
    height: 18px;
    border-radius: 6px;
    border: 2px solid rgba(255,255,255,0.8);
    position: relative;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
}
.icon-window::after {
    content: "";
    position: absolute;
    top: 4px;
    left: 50%;
    width: 1px;
    height: 8px;
    background: rgba(255,255,255,0.8);
    transform: translateX(-50%);
    box-shadow: -6px 0 0 rgba(255,255,255,0.8), 6px 0 0 rgba(255,255,255,0.8);
}

.icon-restart {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255,255,255,0.8);
    border-radius: 50%;
    position: relative;
}

.icon-restart::after {
    content: "";
    position: absolute;
    top: -2px;
    right: -2px;
    width: 8px;
    height: 8px;
    border-top: 2px solid rgba(255,255,255,0.8);
    border-right: 2px solid rgba(255,255,255,0.8);
    transform: rotate(45deg);
}

.icon-system {
    width: 18px;
    height: 18px;
    background:
        radial-gradient(circle, rgba(255,255,255,0.8) 20%, transparent 22%),
        conic-gradient(
            transparent 0deg 20deg,
            rgba(255,255,255,0.8) 20deg 40deg,
            transparent 40deg 60deg,
            rgba(255,255,255,0.8) 60deg 80deg,
            transparent 80deg 100deg,
            rgba(255,255,255,0.8) 100deg 120deg,
            transparent 120deg 140deg,
            rgba(255,255,255,0.8) 140deg 160deg,
            transparent 160deg 180deg,
            rgba(255,255,255,0.8) 180deg 200deg,
            transparent 200deg 220deg,
            rgba(255,255,255,0.8) 220deg 240deg,
            transparent 240deg 260deg,
            rgba(255,255,255,0.8) 260deg 280deg,
            transparent 280deg 300deg,
            rgba(255,255,255,0.8) 300deg 320deg,
            transparent 320deg 360deg
        );
    border-radius: 50%;
}

.restart-sheet {
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    padding: 16px;
    background: var(--ui-backdrop);
    backdrop-filter: blur(var(--ui-backdrop-blur));
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: var(--ui-z-modal);
}

.restart-sheet.show {
    opacity: 1;
    pointer-events: auto;
}

.story-edit-sheet {
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    padding: 18px;
    background: var(--ui-backdrop);
    backdrop-filter: blur(var(--ui-backdrop-blur));
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: var(--ui-z-modal);
}

.story-edit-sheet.show {
    opacity: 1;
    pointer-events: auto;
}


.character-sheet {
    position: fixed;
    top: var(--sheet-top, 40px);
    right: 12px;
    width: min(520px, 86vw);
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.12);
    background: radial-gradient(140% 140% at 10% 10%, rgba(255,192,112,0.08), transparent 60%), rgba(10,6,12,0.9);
    box-shadow:
        0 20px 40px rgba(0,0,0,0.7),
        0 0 0 1px rgba(255,255,255,0.06);
    backdrop-filter: blur(10px);
    transition: max-height 0.35s ease, opacity 0.35s ease, transform 0.35s ease;
    pointer-events: none;
    z-index: 12;
}
.character-sheet[data-pos="bottom"] {
    top: auto;
    bottom: var(--sheet-bottom, 14px);
    left: 50%;
    right: auto;
    width: calc(100% - 20px);
    max-width: calc(100% - 20px);
    transform: translateX(-50%);
    transform-origin: center bottom;
}
.character-sheet[data-pos="top"] {
    top: var(--sheet-top, 16px);
    left: 50%;
    right: auto;
    bottom: auto;
    width: calc(100% - 20px);
    max-width: calc(100% - 20px);
    transform: translateX(-50%);
    transform-origin: center top;
}
.character-sheet[data-pos="fullscreen"] {
    left: 10px;
    right: 10px;
    top: var(--sheet-top, 10px);
    bottom: var(--sheet-bottom, 12px);
    width: auto;
    max-height: none;
    height: auto;
    transform: none;
    transform-origin: center top;
}
.character-sheet[data-pos="fullscreen"] .sheet-inner {
    max-height: none;
    height: calc(var(--viewport-height) - var(--sheet-top, 10px) - var(--sheet-bottom, 12px));
}
.character-sheet.show,
.character-sheet.open {
    max-height: 70vh;
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}
.character-sheet.open[data-pos="fullscreen"] {
    max-height: none;
}
.character-sheet .sheet-inner {
    max-height: 70vh;
    overflow-y: auto;
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}
.character-sheet[data-pos="fullscreen"] .sheet-inner {
    max-height: none;
    height: calc(var(--viewport-height) - var(--sheet-top, 10px) - var(--sheet-bottom, 12px));
}
.character-sheet .sheet-inner::-webkit-scrollbar {
    width: 0;
    height: 0;
}
.character-sheet .sheet-tagline {
    margin: 2px 0 0 0;
    color: rgba(244,233,245,0.72);
    letter-spacing: 0.05em;
    font-size: 12px;
}
.character-sheet .sheet-tabs {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
}
.character-sheet .setting-list {
    display: grid;
    gap: 6px;
    margin-top: 6px;
}
.character-sheet .setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    color: #f4e9f5;
    font-size: 12px;
}
.character-sheet .setting-note {
    color: rgba(244,233,245,0.65);
    font-size: 11px;
}
.character-sheet .tab-btn {
    border-radius: 12px;
    padding: 6px 12px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    color: #f4e9f5;
    cursor: pointer;
    font-size: 12px;
}
.character-sheet .tab-btn.active {
    border-color: #f6c36a;
    background: rgba(246,195,106,0.16);
    color: #f6c36a;
}
.character-sheet .sheet-head {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    align-items: flex-start;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: linear-gradient(120deg, rgba(246,195,106,0.12), rgba(34,26,35,0.85));
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
}
.character-sheet .sheet-head.combined {
    background: linear-gradient(135deg, rgba(246,195,106,0.18), rgba(12,10,15,0.92));
}
.character-sheet .sheet-head-right {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: flex-start;
}
.character-sheet #character-sheet-close {
    border-radius: 12px;
    width: 32px;
    height: 32px;
    display: grid;
    place-items: center;
    font-size: 16px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.35);
    cursor: pointer;
    color: #f4e9f5;
}
.character-sheet .sheet-head-left h3 {
    margin: 4px 0 2px 0;
    font-size: 18px;
    letter-spacing: 0.08em;
    color: #ffe6d8;
}
.character-sheet .sheet-head-left .sheet-kicker {
    margin: 0;
    color: rgba(255, 255, 255, 0.54);
    letter-spacing: 0.14em;
    font-size: 11px;
    text-transform: uppercase;
}
.character-sheet .sheet-head-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.character-sheet .pos-btn {
    border-radius: 14px;
    padding: 6px 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.04);
    color: #f5e9f3;
    cursor: pointer;
}
.character-sheet .pos-btn.active {
    border-color: #f6c36a;
    background: rgba(246,195,106,0.16);
    color: #f6c36a;
}
.character-sheet .sheet-body {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}
.character-sheet .sheet-body[data-active-tab="about"] {
    gap: 16px;
}
.character-sheet .sheet-body[data-active-tab="edit"] .sheet-grid {
    margin-top: 2px;
}
.character-sheet .sheet-hero {
    display: grid;
    grid-template-columns: minmax(280px, 1.05fr) minmax(240px, 0.95fr);
    gap: 12px;
    align-items: stretch;
}
.character-sheet .sheet-hero.about-hero {
    background: radial-gradient(120% 140% at 0% 0%, rgba(246,195,106,0.05), transparent 45%);
    padding: 4px;
    border-radius: 14px;
}
.character-sheet .sheet-hero.about-hero .hero-primary,
.character-sheet .sheet-hero.about-hero .hero-secondary {
    background: rgba(255,255,255,0.02);
}
.character-sheet .hero-primary,
.character-sheet .hero-secondary,
.character-sheet .info-card {
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    padding: 12px;
    display: grid;
    gap: 8px;
    position: relative;
}
.character-sheet .hero-secondary .slot-summary {
    gap: 10px;
}
.character-sheet .info-card.soft {
    background: rgba(255,255,255,0.02);
}
.character-sheet .sheet-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 12px;
}
.character-sheet .sheet-grid.edit-grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}
.required { color: #f6c36a; font-size: 12px; margin-left: 4px; }
.save-hint { color: #f66; font-size: 12px; display: inline-flex; align-items: center; margin-right: 8px; }
.role-required-hint { color: #f66; font-size: 12px; display: inline-flex; align-items: center; margin-right: 8px; }
.character-sheet .global-rule-box {
    border: 1px dashed rgba(255,255,255,0.14);
    border-radius: 12px;
    padding: 10px;
    background: rgba(255,255,255,0.02);
    display: grid;
    gap: 6px;
}
.character-sheet .global-rule-text {
    margin: 0;
    color: rgba(244,233,245,0.7);
    max-height: 140px;
    overflow-y: auto;
    line-height: 1.5;
}
.character-sheet .sheet-grid.settings-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}
.character-sheet .card-head {
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #f6c36a;
    font-size: 12px;
    text-transform: uppercase;
}
.character-sheet .card-head.small {
    font-size: 13px;
    letter-spacing: 0.08em;
    text-transform: none;
}
.character-sheet .card-note {
    margin: 0;
    color: rgba(244,233,245,0.7);
    font-size: 12px;
}
.character-sheet .pill-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    align-items: center;
}
.character-sheet .pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 9px;
    border-radius: 999px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.12);
    color: #f4e9f5;
    font-size: 11px;
    letter-spacing: 0.04em;
}
.character-sheet .pill.accent {
    border-color: #f6c36a;
    color: #f6c36a;
    background: rgba(246,195,106,0.12);
    box-shadow: 0 0 12px rgba(246,195,106,0.18);
}
.character-sheet .pill.ghost {
    border-style: dashed;
    color: rgba(244,233,245,0.7);
}
.character-sheet .pill.thin {
    padding: 4px 8px;
    font-size: 10px;
    opacity: 0.92;
}
.character-sheet .hero-name {
    font-size: 18px;
    margin: 0;
    letter-spacing: 0.08em;
    color: #ffe6d8;
}
.character-sheet .hero-lead {
    margin: 0;
    color: rgba(244,233,245,0.86);
    line-height: 1.45;
    font-size: 13px;
}
.character-sheet .hero-sub {
    margin: 0;
    color: rgba(244,233,245,0.7);
    line-height: 1.4;
    font-size: 12px;
}
.character-sheet .opener-block {
    border-radius: 12px;
    border: 1px solid rgba(246,195,106,0.3);
    background: rgba(246,195,106,0.08);
    padding: 10px 12px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
}
.character-sheet .opener-label {
    margin: 0 0 4px 0;
    font-size: 11px;
    letter-spacing: 0.08em;
    color: #f6c36a;
    text-transform: uppercase;
}
.character-sheet .opener-text {
    margin: 0;
    color: rgba(244,233,245,0.9);
    line-height: 1.55;
}
.character-sheet .meta-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
}
.character-sheet .meta-card {
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 8px 10px;
    background: rgba(255,255,255,0.02);
}
.character-sheet .meta-head {
    font-size: 11px;
    letter-spacing: 0.08em;
    color: rgba(246,195,106,0.9);
    text-transform: uppercase;
    margin-bottom: 4px;
}
.character-sheet .card-list.tight {
    gap: 6px;
}
.character-sheet .slot-panel.compact {
    margin-top: 6px;
    padding: 10px;
}
.character-sheet .pos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(96px, 1fr));
    gap: 8px;
}
.character-sheet .hint-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 6px;
    color: rgba(244,233,245,0.78);
    font-size: 12px;
    line-height: 1.4;
}
.character-sheet .sheet-body[data-active-tab="settings"] {
    padding-top: 6px;
}
.character-sheet .sheet-body[data-active-tab="card"] {
    gap: 10px;
}
.character-sheet .sheet-body[data-active-tab="rules"] .card-form,
.character-sheet .sheet-body[data-active-tab="slots"] .slot-panel {
    margin-top: 4px;
}
.character-sheet .card-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.character-sheet .card-chip {
    border-radius: 12px;
    padding: 6px 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.04);
    color: #f4e9f5;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
}
.character-sheet .card-chip.active {
    border-color: #f6c36a;
    background: rgba(246,195,106,0.16);
    color: #f6c36a;
}
.character-sheet .card-chip.ghost {
    border-style: dashed;
    color: rgba(244,233,245,0.7);
}
.character-sheet .card-chip .card-meta {
    display: none;
}
.character-sheet .card-form {
    display: grid;
    gap: 10px;
}
.character-sheet .card-form.grid-two {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}
.character-sheet .card-form.inline .card-actions {
    justify-content: flex-start;
}
.character-sheet .card-form.slim {
    grid-template-columns: 1fr;
}
.character-sheet .quick-dynamic {
    display: flex;
    gap: 8px;
    align-items: center;
}
.character-sheet .quick-dynamic input[type="text"] {
    flex: 1;
}
.character-sheet .slot-panel {
    margin-top: 4px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.03);
    display: grid;
    gap: 10px;
}
.character-sheet .slot-panel.edit-panel {
    border-color: rgba(246,195,106,0.25);
    background: linear-gradient(140deg, rgba(246,195,106,0.06), rgba(0,0,0,0.25));
}
.character-sheet .slot-head {
    font-size: 12px;
    color: rgba(244,233,245,0.76);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 6px;
}
.character-sheet .slot-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
}
.character-sheet .slot-card {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    display: grid;
    gap: 6px;
    transition: all 0.2s ease;
}
.character-sheet .slot-card.empty {
    border-style: dashed;
    color: rgba(244,233,245,0.6);
    background: rgba(255,255,255,0.04);
}
.character-sheet .slot-card.temp {
    border-style: dashed;
    background: rgba(255,255,255,0.05);
}
.character-sheet .slot-card:hover {
    border-color: rgba(246,195,106,0.45);
    box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    transform: translateY(-1px);
}
.character-sheet .slot-title {
    font-weight: 600;
    letter-spacing: 0.08em;
    font-size: 12px;
    color: #f6c36a;
}
.character-sheet .slot-meta {
    font-size: 12px;
    color: rgba(244,233,245,0.7);
}
.character-sheet .slot-meta.subtle {
    color: rgba(244,233,245,0.55);
    font-size: 11px;
}
.character-sheet .slot-hint {
    font-size: 11px;
    color: rgba(244,233,245,0.6);
}
.character-sheet .slot-actions {
    display: flex;
    gap: 6px;
}
.character-sheet .slot-actions button[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
}
.character-sheet .slot-actions button[data-confirm="true"],
.character-sheet .card-actions button[data-confirm="true"] {
    border-style: dashed;
}
.character-sheet .slot-mini-list {
    display: grid;
    gap: 6px;
}
.character-sheet .slot-mini {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.02);
    font-size: 12px;
}
.character-sheet .slot-mini .slot-meta {
    font-size: 11px;
    color: rgba(244,233,245,0.7);
}
.character-sheet .slot-mini.empty {
    border-style: dashed;
    color: rgba(244,233,245,0.6);
}
.character-sheet .slot-mini.empty .slot-meta {
    color: rgba(244,233,245,0.55);
}
.character-sheet .card-form label {
    display: grid;
    gap: 6px;
    color: rgba(244,233,245,0.8);
    font-size: 12px;
}
.character-sheet textarea {
    width: 100%;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.18);
    color: #f4e9f5;
    padding: 10px;
    resize: vertical;
    min-height: 60px;
}
.character-sheet .rule-hint {
    font-size: 12px;
    color: rgba(244,233,245,0.7);
    background: rgba(255,255,255,0.04);
    border: 1px dashed rgba(255,255,255,0.12);
    border-radius: 10px;
    padding: 8px;
}
.character-sheet input[type="text"] {
    width: 100%;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(0,0,0,0.24);
    color: #f4e9f5;
    padding: 10px;
}
.character-sheet .card-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}
.character-sheet .card-actions .primary {
    background: linear-gradient(135deg, #f6c36a, #d86a8a);
    color: #0b050c;
    border: 1px solid rgba(246,195,106,0.8);
    padding: 8px 16px;
    border-radius: 12px;
    cursor: pointer;
}
.character-sheet .card-actions .ghost {
    border: 1px dashed rgba(255,255,255,0.18);
    background: transparent;
    color: #f4e9f5;
    padding: 8px 12px;
    border-radius: 12px;
    cursor: pointer;
}
.character-sheet button {
    border: 1px solid rgba(255,255,255,0.18);
    background: transparent;
    color: #f5e9f3;
}
.character-sheet .card-actions .confirming,
.character-sheet .slot-actions button[data-confirm-state="on"] {
    background: rgba(246,195,106,0.16);
    border-color: rgba(246,195,106,0.6);
    color: #f6c36a;
}
.character-sheet .card-confirm-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
}
.character-sheet .card-confirm-modal {
    min-width: 240px;
    max-width: 360px;
    padding: 14px;
    border-radius: 14px;
    background: rgba(10,6,12,0.96);
    border: 1px solid rgba(246,195,106,0.4);
    box-shadow: 0 16px 32px rgba(0,0,0,0.6), 0 0 18px rgba(246,195,106,0.25);
    color: #f6c36a;
    display: grid;
    gap: 10px;
}
.character-sheet .card-confirm-modal p {
    margin: 0;
    font-size: 13px;
    line-height: 1.5;
}
.character-sheet .card-confirm-modal .confirm-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}
.character-sheet .card-confirm-modal .confirm-actions button {
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid rgba(246,195,106,0.7);
    background: linear-gradient(135deg, #f6c36a, #d86a8a);
    color: #0b050c;
    cursor: pointer;
}
.character-sheet .card-confirm-modal .confirm-actions button[data-confirm-cancel] {
    background: transparent;
    color: #f4e9f5;
    border-color: rgba(255,255,255,0.3);
}
.character-sheet .card-confirm {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px dashed rgba(246,195,106,0.6);
    background: rgba(246,195,106,0.08);
    color: #f6c36a;
    font-size: 12px;
    gap: 8px;
}
.character-sheet .card-confirm .confirm-actions {
    display: flex;
    gap: 6px;
}
.character-sheet .card-confirm button {
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid rgba(246,195,106,0.7);
    color: #0b050c;
    background: linear-gradient(135deg, #f6c36a, #d86a8a);
    cursor: pointer;
}
.character-sheet .card-confirm button[data-confirm-cancel] {
    background: transparent;
    color: #f4e9f5;
    border-color: rgba(255,255,255,0.3);
}

@media (max-width: 900px) {
    .character-sheet {
        width: min(640px, 94vw);
    }
    .character-sheet .sheet-hero {
        grid-template-columns: 1fr;
    }
    .character-sheet .sheet-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 620px) {
    .character-sheet {
        left: 8px;
        right: 8px;
        width: auto;
    }
    .character-sheet .sheet-head {
        flex-direction: column;
        gap: 6px;
    }
}

.story-reply-divider {
    width: 100%;
    text-align: center;
    color: rgba(255,255,255,0.35);
    font-size: 11px;
    letter-spacing: 0.16em;
    margin: 4px 0;
    position: relative;
}

.story-reply-divider::before,
.story-reply-divider::after {
    content: "";
    position: absolute;
    top: 50%;
    width: 35%;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15));
}

.story-reply-divider::before {
    left: 0;
}

.story-reply-divider::after {
    right: 0;
    transform: scaleX(-1);
}

.story-reply-divider span {
    padding: 0 10px;
    background: transparent;
}

.continue-btn {
    padding: 6px 14px;
    border-radius: 999px;
    background: #0b050c;
    border: 1px solid rgba(246,195,106,0.85);
    color: #f6c36a;
    text-shadow: 0 0 6px rgba(246,195,106,0.8);
    box-shadow:
        0 0 12px rgba(246,195,106,0.28),
        0 0 0 1px rgba(246,195,106,0.25);
    font-size: 12px;
    cursor: pointer;
    margin-left: 12px;
    margin-right: auto;
    margin-top: 6px;
    align-self: flex-start;
    animation: pulse 2.4s infinite ease-in-out;
}

.continue-btn.align-left {
    margin-left: 0;
}

@keyframes pulse {
    0% { opacity: .7; }
    50% { opacity: 1; }
    100% { opacity: .7; }
}

.bold-emphasis {
    font-weight: 780;
    background: linear-gradient(
        to bottom,
        #ffead4 0%,
        #ffb6c4 100%
    );
    -webkit-background-clip: text;
    color: transparent;
    filter: drop-shadow(0 0 6px rgba(255, 140, 170, 0.45));
    transition: all .25s ease;
    display: inline;
    animation: boldShimmer 2.2s ease-in-out infinite;
}

@keyframes boldShimmer {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.88; }
}

.action-bubble .bold-emphasis {
    filter: drop-shadow(0 0 10px rgba(255, 80, 100, .65));
}

.thought-bubble .bold-emphasis {
    filter: drop-shadow(0 0 10px rgba(255, 160, 210, .4));
}

.reading-mode .bold-emphasis {
    font-size: 1.1em;
}

#story-context-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: var(--viewport-height);
    pointer-events: none;
    z-index: 40;
}

#story-context-menu.show {
    pointer-events: auto;
}

#story-context-menu .context-panel {
    position: absolute;
    min-width: 140px;
    background: rgba(22,10,20,0.92);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#story-context-menu button {
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.85);
    font-size: 13px;
    padding: 8px 12px;
    text-align: left;
    cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.08);
}

#story-context-menu button:last-child {
    border-bottom: none;
}

#story-context-menu button:hover {
    background: rgba(255,255,255,0.07);
}

.story-toast {
    position: absolute;
    right: 16px;
    bottom: 72px;
    padding: 8px 16px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(8px);
    color: rgba(255,255,255,0.85);
    font-size: 12px;
    animation: toastIn 0.25s ease forwards;
}

.save-toast {
    position: fixed;
    left: 50%;
    bottom: 28px;
    transform: translate(-50%, 20px);
    padding: 8px 14px;
    border-radius: 12px;
    background: rgba(8, 6, 10, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.18);
    color: #f6e9f5;
    font-size: 12px;
    letter-spacing: 0.04em;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
    opacity: 0;
    transition: transform 0.2s ease, opacity 0.2s ease;
    z-index: 1200;
}
.save-toast.ok {
    border-color: rgba(246, 195, 106, 0.65);
    color: #f6c36a;
}
.save-toast.fail {
    border-color: rgba(255, 120, 150, 0.65);
    color: #ff9cbc;
}
.save-toast.show {
    opacity: 1;
    transform: translate(-50%, 0);
}
.save-toast.hide {
    opacity: 0;
    transform: translate(-50%, 20px);
}

@keyframes toastIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}
#story-input {
    scrollbar-width: none;
}

/* Â±ïÂºÄÂêéËæìÂÖ•Ê°ÜÂèòÈ´ò‰ΩÜ‰æùÁÑ∂‰øùÊåÅÂúÜËßíÁéªÁíÉÊÑü */
#story-input.expanded {
    height: 70vh;
    padding-top: 14px;
}

/* Â±ïÂºÄÂêéÊòæÁ§∫ÁÆ≠Â§¥ */
#input-collapse-btn {
    position: absolute;
    top: -26px;
    left: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255, 200, 220, 0.28);
    background: rgba(40, 15, 25, 0.85);
    color: #e8cadd;
    font-size: 13px;
    cursor: pointer;
}

/* ÂàùÂßãÈöêËóè */
.hidden {
    display: none;
}

#story-input::placeholder {
    color: rgba(244, 243, 247, 0.5);
}

/* ÂèëÈÄÅÊåâÈíÆÔºöÂÉèÁ¥†Âæ™ÁéØÂä®Áîª */
#story-send {
    position: relative;
    border-radius: 12px;
    padding: 0 20px;
    border: 2px solid rgba(246, 195, 106, 0.82);
    background:
        linear-gradient(180deg, rgba(30, 12, 20, 0.9), rgba(10, 4, 12, 0.92)),
        repeating-linear-gradient(45deg, rgba(246, 195, 106, 0.18) 0 8px, rgba(124, 16, 37, 0.12) 8px 14px, transparent 14px 20px);
    color: var(--accent);
    font-family: var(--pixel-font);
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.08em;
    cursor: pointer;
    min-width: 72px;
    box-shadow:
        0 0 0 2px rgba(8, 4, 12, 0.9),
        0 10px 22px rgba(0, 0, 0, 0.35),
        0 0 16px rgba(246, 195, 106, 0.25);
    overflow: hidden;
    isolation: isolate;
    transition: transform 0.12s ease, box-shadow 0.2s ease;
    animation: sendPixelStripe 2.4s linear infinite;
}
#story-send::before {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: 8px;
    border: 1px solid rgba(246, 195, 106, 0.65);
    background: repeating-linear-gradient(90deg, rgba(246, 195, 106, 0.1) 0 4px, rgba(216, 106, 138, 0.08) 4px 8px, transparent 8px 12px);
    opacity: 0.7;
    mix-blend-mode: screen;
    animation: sendPixelFrame 1.9s steps(6, end) infinite;
    pointer-events: none;
}
#story-send::after {
    content: "‚ñ∂";
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    font-family: var(--pixel-font);
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.55), 0 0 10px rgba(246, 195, 106, 0.5);
    animation: sendArrowBounce 1.1s steps(2, end) infinite;
}

#story-send:active {
    transform: translateY(1px) scale(0.98);
    box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.35),
        0 0 12px rgba(246, 195, 106, 0.2);
}
@keyframes sendPixelStripe {
    0% { background-position: 0 0, 0 0; }
    100% { background-position: 0 0, 28px 28px; }
}
@keyframes sendPixelFrame {
    0% { background-position: 0 0; opacity: 0.6; }
    50% { background-position: 8px 0; opacity: 0.85; }
    100% { background-position: 16px 0; opacity: 0.6; }
}
@keyframes sendArrowBounce {
    0%, 100% { transform: translateY(-50%) scale(0.96); opacity: 0.75; }
    50% { transform: translateY(-58%) scale(1); opacity: 1; }
}

.story-tools-toggle,
#story-send {
    height: 40px;
    line-height: 40px;
}

.story-tools-menu .menu-group {
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}

.phone-pack {
    width: 380px;
    max-width: 380px;
    min-width: 320px;
    aspect-ratio: 9 / 19.5;
    height: auto;
    position: relative;
    flex-shrink: 0;
}

#phone-shell {
    width: 100%;
    border-radius: 28px;
    overflow: hidden;   /* ÂÖ≥ÈîÆÔºöÈò≤Ê≠¢ÂÜÖÂ±èÊ∫¢Âá∫ */
    position: relative;
    background: #000;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.08),
        0 18px 40px rgba(0,0,0,0.9),
        0 25px 60px rgba(0,0,0,0.65);
}

/* Âè≥‰æßÊâãÊú∫Âå∫ÂüüÔºàPCÔºâ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 30;
}
body:not(.mobile-mode) #phone-layer {
    margin-right: 14px;
}

.phone-pack {
    position: relative;
}
/* ÂÜÖÂ±èÂÜÖÂÆπÂå∫ÔºöÊ∞∏ËøúÂ°´Êª°Â§ñÂ£≥Ôºå‰∏çËá™Â∑±ÂÜ≥ÂÆöÂ∞∫ÂØ∏ */
#phone {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    /* Ê∑±Á∫¢ ‚Üí Ê∑±Á¥´ ‚Üí ÈªëÁöÑÊ∏êÂèòÂ£ÅÁ∫∏Ôºà‰Ω†ÁöÑÊúÄÂàùÊ¨æÔºâ */
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(200, 80, 110, 0.18), transparent 60%),
        linear-gradient(160deg, #1a0e13 0%, #050509 100%);

    border-radius: inherit;
}

/* È°∂ÈÉ®Áä∂ÊÄÅÊ†è */
/* ÂÖ®Â±ÄËÉåÊôØÔºö‰ΩéÈ•±ÂíåÊöóÁ∫¢Ëâ≤ ‚Üí Ê∑±ÁÅ∞ */
:root {
    --bg-top: #14040c;
    --bg-bottom: #05010a;
    --glass: rgba(8, 5, 12, 0.88);
    --border: rgba(255, 196, 168, 0.22);
    --accent: #f3c071;
    --accent-soft: rgba(243, 159, 117, 0.18);
    --text-main: #f4e9f5;
    --text-sub: rgba(233, 210, 225, 0.74);
    --obsidian: #0b050c;
    --blood: #7c1025;
    --void: #3b0d45;
    --molten-gold: #f6c36a;
    --noise: rgba(255, 255, 255, 0.04);
    --fog: rgba(12, 8, 14, 0.7);
    --tentacle-art: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='96' height='176' shape-rendering='crispEdges'><rect width='96' height='176' fill='none'/><path fill='%230a060d' d='M18 152h18v24H18z'/><path fill='%2313071a' d='M24 118h16v60H24z'/><path fill='%23230d29' d='M32 84h14v80H32z'/><path fill='%232e0f33' d='M40 58h14v90H40z'/><path fill='%23380f3a' d='M50 40h12v90H50z'/><path fill='%2355133f' d='M56 30h10v78H56z'/><path fill='%2374183f' d='M60 22h10v64H60z'/><path fill='%23a3273c' d='M64 16h8v50H64z'/><path fill='%23d8485c' d='M68 12h6v32H68z'/></svg>");
}

* {
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

body {
    margin: 0;
    min-height: var(--viewport-height);
    font-family: -apple-system, BlinkMacSystemFont, system-ui, "SF Pro Display", serif;
    color: var(--text-main);
    background:
        radial-gradient(120% 120% at 14% 6%, rgba(120, 16, 38, 0.32), transparent 58%),
        radial-gradient(140% 140% at 88% 92%, rgba(66, 16, 95, 0.35), transparent 62%),
        radial-gradient(110% 110% at 50% 12%, rgba(35, 12, 30, 0.32), transparent 55%),
        linear-gradient(135deg, #0d050a 0%, #08030f 32%, #0b0714 66%, #05010a 100%);
    display: flex;
    justify-content: center;
    align-items: stretch;
    overflow: hidden;          /* üîí ÈîÅ‰ΩèÊï¥È°µÊªöÂä®Êù° */
    position: relative;
}

body::before,
body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
}

body::before {
    background:
        radial-gradient(80% 60% at 10% 12%, rgba(255, 110, 140, 0.08), transparent 55%),
        radial-gradient(80% 60% at 88% 82%, rgba(140, 80, 255, 0.1), transparent 65%),
        repeating-linear-gradient(0deg, transparent 0, transparent 2px, rgba(255, 255, 255, 0.015) 2px, rgba(255, 255, 255, 0.015) 3px);
    mix-blend-mode: screen;
    opacity: 0.65;
}

body::after {
    background:
        radial-gradient(circle at 50% 30%, rgba(245, 192, 112, 0.12), transparent 38%),
        radial-gradient(circle at 70% 68%, rgba(120, 18, 44, 0.18), transparent 52%),
        repeating-radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 0.03) 0 1px, transparent 1px 3px);
    filter: blur(0.4px);
    opacity: 0.85;
}

/* Â§ñÂ±ÇÂ∏ÉÂ±ÄÔºöPC ‰∏äÂ∑¶Âè≥ÊéíÂàóÔºåÊâãÊú∫‰∏ä‰∏ä‰∏ãÊéíÂàó */
#app {
    width: 100%;  
    height: 100%;              /* Â°´Êª° body */
    padding: 14px;
    padding-top: calc(14px + env(safe-area-inset-top, 0px));
    padding-bottom: calc(14px + env(safe-area-inset-bottom, 0px));
    padding-left: calc(14px + env(safe-area-inset-left, 0px));
    padding-right: calc(14px + env(safe-area-inset-right, 0px));
    display: flex;
    gap: 14px;
    align-items: stretch;
}

body.mobile-mode #app {
    flex-direction: column;
}

/* ÂâßÊÉÖ‰∏ªÈù¢Êùø */
#story-panel {
    flex: 1;
    min-height: 80vh;
    border-radius: 22px;
    padding: 14px 14px 16px;
    background:
        radial-gradient(140% 120% at 18% 16%, rgba(120, 18, 42, 0.35), transparent 62%),
        radial-gradient(120% 120% at 82% 70%, rgba(56, 18, 92, 0.32), transparent 62%),
        radial-gradient(140% 140% at 50% 110%, rgba(15, 6, 14, 0.55), transparent 50%),
        linear-gradient(180deg, #150710 0%, #09030d 52%, #050208 100%);
    border: 1px solid rgba(246, 195, 106, 0.22);
    box-shadow:
        0 22px 60px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 196, 168, 0.06),
        inset 0 0 0 1px rgba(255, 255, 255, 0.04);
    backdrop-filter: blur(6px);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}
.story-fx-layer {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    overflow: visible;
}
#story-fx-base {
    z-index: 1;
}
#story-fx-upper {
    z-index: 4;
    mask-image: none;
    -webkit-mask-image: none;
}
.story-bubbles-layer {
    position: relative;
    z-index: 3;
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}
.story-hide-text .story-bubbles-layer {
    opacity: 0;
    pointer-events: auto;
    transition: opacity 0.2s ease;
}
.story-hide-text .story-bubble {
    visibility: hidden !important;
}
.story-hide-text {
    overflow: hidden;
}
.panel-fog-layer {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    overflow: hidden;
}
.panel-fog {
    --fog-power: 1;
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 38px;
    background: none;
    filter: none;
    opacity: 1;
}
.panel-fog.ambient-fog {
    inset: -14%;
    background:
        radial-gradient(120% 120% at 20% 30%, rgba(255, 170, 200, 0.16), transparent 62%),
        radial-gradient(140% 120% at 76% 70%, rgba(118, 86, 160, 0.14), transparent 66%),
        radial-gradient(120% 140% at 52% 90%, rgba(90, 42, 98, 0.12), transparent 68%);
    opacity: 0.15;
    animation: ambientFogFloat 38s ease-in-out infinite;
    filter: blur(20px) saturate(1.04);
}
.panel-fog.ambient-fog.ghost {
    animation-duration: 44s;
    animation-delay: -6s;
    opacity: 0.12;
    filter: blur(24px) saturate(1.08);
    mix-blend-mode: lighten;
}
.panel-fog.sweep {
    width: 108%;
    height: 70%;
    border-radius: 40px;
    opacity: 1;
    filter: none;
    background: none;
    mask-image: none;
    -webkit-mask-image: none;
}
.panel-fog.fog-low {
    left: -14%;
    bottom: -2%;
    width: 118%;
    height: 72%;
    background: none;
    box-shadow: none;
    animation: fogSweepBase 7.2s linear forwards;
}
.panel-fog.fog-high {
    right: -24%;
    top: 6%;
    height: 78%;
    background: none;
    box-shadow: none;
    mask-image: none;
    -webkit-mask-image: none;
    animation: fogSweepUpper 7.2s linear forwards;
}
.fog-sprite-pack {
    position: absolute;
    inset: -8% -4% -6%;
    filter: none;
    mask-image: none;
    -webkit-mask-image: none;
    pointer-events: none;
    animation: fogPackDrift var(--pack-dur, 6s) ease-in-out forwards;
}
.fog-cloud {
    position: absolute;
    border-radius: 999px;
    opacity: 1;
    filter: brightness(1) drop-shadow(0 2px 12px rgba(0, 0, 0, 0.12)) drop-shadow(0 0 10px rgba(255, 255, 255, 0.1));
    animation: none;
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
    image-rendering: auto;
}
.fog-cloud.light {
    --cloud-fill: #ffe7c8;
    --cloud-stroke: #ffd6a2;
    --cloud-glow: rgba(255, 216, 172, 0.6);
}
.fog-cloud.dark {
    --cloud-fill: #5667a3;
    --cloud-stroke: #92a3e0;
    --cloud-glow: rgba(130, 158, 240, 0.55);
}
.fog-cloud .cloud-lump {
    position: absolute;
    border-radius: 50%;
    background: var(--cloud-fill, #fff);
    border: none;
    box-shadow:
        0 0 6px var(--cloud-glow, rgba(255,255,255,0.6)),
        0 2px 6px rgba(0,0,0,0.08);
}
.fog-cloud.variant-a {
    border-radius: 60% 50% 48% 58%;
}
.fog-cloud.variant-b {
    border-radius: 70% 60% 62% 54%;
}
.fog-cloud.variant-c {
    border-radius: 58% 68% 60% 64%;
}

#cloud-demo-layer {
    display: none;
}

@keyframes fogPackDrift {
    0% { transform: translate3d(0, 0, 0); opacity: 0; filter: brightness(1.08); }
    12% { opacity: 0.9; filter: brightness(1.04); }
    28% { transform: translate3d(calc(var(--pack-dx, 16px) * 0.5), calc(var(--pack-dy, -10px) * 0.5), 0); opacity: 1; filter: brightness(1.02); }
    78% { transform: translate3d(calc(var(--pack-dx, 16px) * 0.88), calc(var(--pack-dy, -10px) * 0.88), 0); opacity: 0.94; filter: brightness(0.98); }
    100% { transform: translate3d(var(--pack-dx, 16px), var(--pack-dy, -10px), 0); opacity: 0; filter: brightness(0.96); }
}

@keyframes ambientFogFloat {
    0% { transform: translate3d(-6px, 6px, 0) scale(1.02); }
    45% { transform: translate3d(10px, -8px, 0) scale(1.06); }
    90% { transform: translate3d(-4px, 4px, 0) scale(1.02); }
    100% { transform: translate3d(-6px, 6px, 0) scale(1.02); }
}

@keyframes fogSweepBase {
    0%   { opacity: 1; transform: translate3d(-12%, 6px, 0) scale(var(--fog-power, 1)); }
    50%  { opacity: 1; transform: translate3d(0%, 0px, 0) scale(var(--fog-power, 1)); }
    100% { opacity: 1; transform: translate3d(12%, -6px, 0) scale(var(--fog-power, 1)); }
}

@keyframes fogSweepUpper {
    0%   { opacity: 1; transform: translate3d(12%, 6px, 0) scale(var(--fog-power, 1)); }
    50%  { opacity: 1; transform: translate3d(0%, -2px, 0) scale(var(--fog-power, 1)); }
    100% { opacity: 1; transform: translate3d(-12%, -6px, 0) scale(var(--fog-power, 1)); }
}

#abyss-bg {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    overflow: visible;
    z-index: 0;
}

#abyss-bg canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
}

#abyss-bg .abyss-tentacles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: visible;
    z-index: 9;
}
.abyss-tentacles.upper {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: visible;
    mask-image: linear-gradient(180deg, #fff 0%, #fff 82%, transparent 100%);
    -webkit-mask-image: linear-gradient(180deg, #fff 0%, #fff 82%, transparent 100%);
    z-index: 6;
}
.high-tentacle-ball {
    position: absolute;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: radial-gradient(circle at 40% 40%, rgba(190, 220, 255, 0.95), rgba(90, 130, 255, 0.75));
    box-shadow:
        0 0 20px rgba(120, 160, 255, 0.8),
        0 0 36px rgba(90, 130, 255, 0.5);
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.9);
    animation: highTentacleBall 4s ease-in-out forwards;
    pointer-events: none;
    z-index: 14;
}

@keyframes highTentacleBall {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.6); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
    70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -40%) scale(0.8); }
}

#abyss-bg .abyss-fog {
    position: absolute;
    inset: -12%;
    border-radius: 32px;
    background:
        radial-gradient(140% 140% at 28% 30%, rgba(255, 105, 180, 0.82), transparent 62%),
        radial-gradient(160% 140% at 64% 68%, rgba(255, 60, 150, 0.68), transparent 68%),
        radial-gradient(180% 160% at 12% 88%, rgba(120, 20, 80, 0.7), transparent 70%);
    filter: blur(18px) saturate(1.05);
    opacity: 0;
    transform: scale(1.08);
    transition: opacity 0.8s ease, transform 2s ease;
    pointer-events: none;
    mask-image:
        radial-gradient(140% 150% at 30% 28%, rgba(255,255,255,0.55), transparent 62%),
        radial-gradient(150% 140% at 76% 72%, rgba(255,255,255,0.5), transparent 64%),
        linear-gradient(118deg, transparent 6%, rgba(255,255,255,0.6) 32%, transparent 58%);
}

#abyss-bg .abyss-fog.fog-back {
    z-index: 2;
    mix-blend-mode: normal;
    transform-origin: 10% 90%;
}

#abyss-bg .abyss-fog.fog-front {
    z-index: 8;
    background:
        radial-gradient(120% 120% at 76% 18%, rgba(255, 200, 230, 0.58), transparent 60%),
        radial-gradient(110% 110% at 88% 70%, rgba(255, 120, 190, 0.5), transparent 60%),
        radial-gradient(120% 120% at 60% 26%, rgba(160, 50, 120, 0.4), transparent 70%);
    mix-blend-mode: normal;
    transform-origin: 90% 10%;
    pointer-events: none;
}

#abyss-bg.fog-soft .abyss-fog {
    opacity: 1;
    transform: scale(1.2);
    animation: abyssFogSweepLeft 18s ease-in-out infinite;
}

#abyss-bg.fog-surged .abyss-fog {
    opacity: 1;
    transform: scale(1.28);
    animation: abyssFogPulse 14s ease-in-out infinite;
}

#abyss-bg.fog-surged .fog-front {
    opacity: 1;
}

#abyss-bg.fog-shift .abyss-fog {
    opacity: 1;
    transform: scale(1.3) translate3d(-6px, -12px, 0);
    animation: abyssFogShift 10s ease-in-out infinite;
}

@keyframes abyssFogDrift {
    0% { transform: translate3d(0, 0, 0) scale(1.1); }
    40% { transform: translate3d(-14px, 10px, 0) scale(1.14); }
    70% { transform: translate3d(12px, -8px, 0) scale(1.08); }
    100% { transform: translate3d(0, 0, 0) scale(1.1); }
}

@keyframes abyssFogSweepLeft {
    0% { transform: translate3d(-18px, 22px, 0) scale(1.1); }
    40% { transform: translate3d(6px, -10px, 0) scale(1.18); }
    70% { transform: translate3d(-8px, 6px, 0) scale(1.14); }
    100% { transform: translate3d(4px, -4px, 0) scale(1.12); }
}

@keyframes abyssFogPulse {
    0% { opacity: 0.4; transform: translate3d(0, 0, 0) scale(1.08); }
    45% { opacity: 0.62; transform: translate3d(-6px, -4px, 0) scale(1.16); }
    100% { opacity: 0.38; transform: translate3d(0, 0, 0) scale(1.08); }
}

@keyframes abyssFogShift {
    0% { transform: translate3d(-4px, 8px, 0) scale(1.2); }
    35% { transform: translate3d(8px, -6px, 0) scale(1.26); }
    70% { transform: translate3d(-10px, 2px, 0) scale(1.18); }
    100% { transform: translate3d(-4px, 8px, 0) scale(1.2); }
}

#abyss-bg .abyss-tentacle {
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 0;
    --tentacle-length: 190px;              /* Ë∞ÉÊï¥ÈïøÂ∫¶Âü∫ÂáÜ */
    --tentacle-length-scale: 2.1;          /* Ë∞ÉÊï¥ÈïøÂ∫¶Áº©Êîæ */
    --tentacle-width: 100px;               /* Ë∞ÉÊï¥ÂÆΩÂ∫¶Âü∫ÂáÜ */
    --tentacle-width-scale: 1.95;          /* Ë∞ÉÊï¥ÂÆΩÂ∫¶Áº©Êîæ */
    --tentacle-base-size: 32px;
    --tentacle-head-size: 15px;
    --tentacle-body-offset-x: -50%;
    --tentacle-body-offset-y: 0px;         /* Ë∞ÉÊï¥Ë∫´‰Ωì‰∏äÁßªÔºåË¥üÂÄºÂêë‰∏ä */
    --tentacle-head-offset: -6px;          /* Ë∞ÉÊï¥Â§¥ÈÉ®‰∏äÁßªÔºåË¥üÂÄºÂêë‰∏ä */
    --tentacle-scale: 1;
    --tentacle-thickness: 1;
    --tentacle-wiggle: 1;
    --tentacle-delay: 0s;
    --tentacle-enter-dur: 1s;
    --tentacle-idle-dur: 2.6s;
    --tentacle-retreat-dur: 1s;
    --tentacle-length-abs: calc(var(--tentacle-length) * var(--tentacle-length-scale) * var(--tentacle-scale));
    --tentacle-width-abs: calc(var(--tentacle-width) * var(--tentacle-width-scale) * var(--tentacle-scale) * var(--tentacle-thickness));
    --tentacle-base-abs: calc(var(--tentacle-base-size) * var(--tentacle-thickness));
    --tentacle-head-abs: calc(var(--tentacle-head-size) * var(--tentacle-thickness));
    --tentacle-total-dur: calc(var(--tentacle-enter-dur) + var(--tentacle-idle-dur) + var(--tentacle-retreat-dur));
    transform-origin: 0 0;
    filter:
        drop-shadow(0 0 12px rgba(0, 0, 0, 0.55))
        drop-shadow(0 0 16px rgba(124, 16, 37, 0.35));
    opacity: 0;
    transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px));
    will-change: transform, opacity;
    transition: none;
    z-index: 2;
    animation:
        tentacleEnter var(--tentacle-enter-dur) ease-out var(--tentacle-delay, 0s) 1 normal forwards,
        tentacleIdle var(--tentacle-idle-dur) linear calc(var(--tentacle-delay, 0s) + var(--tentacle-enter-dur)) 1 normal forwards,
        tentacleRetreat var(--tentacle-retreat-dur) ease-in calc(var(--tentacle-delay, 0s) + var(--tentacle-enter-dur) + var(--tentacle-idle-dur)) 1 normal forwards;
    overflow: visible;
}

.abyss-tentacle .tentacle-core {
    position: absolute;
    left: 0;
    top: 0;
    transform-origin: 50% 100%;
    transform: rotate(var(--tentacle-angle, 0deg));
}
.abyss-tentacle .tentacle-core.anim-sway {
    animation: tentacleSwayLite 4.2s ease-in-out infinite; /* Ë∞ÉÊï¥ÊëáÊëÜÂπÖÂ∫¶/Êó∂Èó¥ÔºöËßÅ keyframes */
}
.abyss-tentacle .tentacle-core.anim-sway-wide {
    animation: tentacleSwayWide 5s ease-in-out infinite;
}
.abyss-tentacle .tentacle-core.anim-curl-soft {
    animation: tentacleCurlSoft 3.6s ease-in-out infinite; /* Ë∞ÉÊï¥ËΩØÂºØÂπÖÂ∫¶/Êó∂Èó¥ÔºöËßÅ keyframes */
}
.abyss-tentacle .tentacle-core.anim-curl-medium {
    animation: tentacleCurlMedium 3.8s ease-in-out infinite;
}
.abyss-tentacle .tentacle-core.anim-curl-deep {
    animation: tentacleCurlDeep 3.4s ease-in-out infinite; /* Ë∞ÉÊï¥Ê∑±ÂºØÂπÖÂ∫¶/Êó∂Èó¥ÔºöËßÅ keyframes */
}
.abyss-tentacle .tentacle-core.anim-curl-tight {
    animation: tentacleCurlTight 3.2s ease-in-out infinite;
}
.abyss-tentacle .tentacle-core.anim-touch {
    animation: tentacleTouch 3s ease-in-out infinite; /* Ë∞ÉÊï¥Ëß¶Á¢∞ÂπÖÂ∫¶/Êó∂Èó¥ÔºöËßÅ keyframes */
}
.abyss-tentacle .tentacle-core.anim-wobble {
    animation: tentacleWobble 2.8s ease-in-out infinite;
}

.abyss-tentacle.overlay {
    opacity: 0.6;
    filter:
        drop-shadow(0 0 18px rgba(100, 140, 255, 0.45))
        drop-shadow(0 0 22px rgba(120, 160, 255, 0.5));
    mix-blend-mode: screen;
    z-index: 12;
}
.abyss-tentacles.upper .abyss-tentacle.overlay {
    opacity: 0.82;
    filter:
        drop-shadow(0 0 18px rgba(100, 140, 255, 0.45))
        drop-shadow(0 0 26px rgba(140, 170, 255, 0.48));
}
.abyss-tentacle.overlay .tentacle-body {
    filter: hue-rotate(210deg) saturate(1.15) brightness(0.95);
}

.abyss-tentacle.retreat {
    opacity: 0;
    transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)) translateY(20px);
}

.abyss-tentacle .tentacle-base {
    position: absolute;
    left: 50%;
    top: 0;
    width: var(--tentacle-base-abs);
    height: var(--tentacle-base-abs);
    border-radius: 50%;
    background:
        radial-gradient(120% 120% at 40% 40%, rgba(255, 190, 210, 0.95), transparent 70%),
        linear-gradient(180deg, rgba(255, 140, 170, 0.95), rgba(230, 90, 130, 0.78));
    filter: drop-shadow(0 6px 12px rgba(0,0,0,0.35));
    transform: translate(-50%, 0);
    opacity: 1;
}
.abyss-tentacle .tentacle-body {
    position: absolute;
    left: 50%;
    bottom: 0;
    width: var(--tentacle-width-abs);
    height: var(--tentacle-length-abs);
    transform: translate(var(--tentacle-body-offset-x), var(--tentacle-body-offset-y));
    background-image: var(--tentacle-art);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center bottom;
    image-rendering: pixelated;
}
.abyss-tentacle .tentacle-head {
    position: absolute;
    left: 50%;
    bottom: calc(var(--tentacle-length-abs) + var(--tentacle-head-offset));
    width: var(--tentacle-head-abs);
    height: var(--tentacle-head-abs);
    border-radius: 50%;
    transform: translate(-50%, 0);
    opacity: 1;
    background:
        radial-gradient(120% 120% at 40% 40%, rgba(255, 255, 255, 0.95), transparent 70%),
        linear-gradient(180deg, rgba(240, 240, 255, 0.95), rgba(210, 210, 230, 0.8));
    box-shadow:
        0 0 10px rgba(255, 255, 255, 0.7),
        0 0 16px rgba(200, 200, 240, 0.4);
    pointer-events: none;
}

.abyss-tentacle.debug {
    outline: 1px dashed rgba(255, 255, 255, 0.25);
}
.abyss-tentacle.debug .tentacle-core {
    outline: 1px solid rgba(0, 255, 255, 0.4);
}
.abyss-tentacle.debug .tentacle-body {
    outline: 1px solid rgba(0, 200, 255, 0.6);
    background-color: rgba(0, 200, 255, 0.1);
}
.abyss-tentacle.debug .tentacle-base {
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);
}
.abyss-tentacle.debug .tentacle-head {
    box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.8),
        0 0 10px rgba(255, 255, 255, 0.7);
}

.tentacle-guide {
    position: absolute;
    right: 12px;
    bottom: 12px;
    width: 140px;
    height: 240px;
    pointer-events: none;
    z-index: 30;
    display: flex;
    align-items: center;
    justify-content: center;
}
.tentacle-guide.hidden {
    display: none;
}
.tentacle-guide .guide-inner {
    position: relative;
    width: 120px;
    height: 220px;
    border: 1px dashed rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.2);
    --tentacle-length: 190px;
    --tentacle-length-scale: 2.1;
    --tentacle-length-abs: calc(var(--tentacle-length) * var(--tentacle-length-scale));
    --tentacle-width: 100px;
    --tentacle-width-scale: 1.95;
    --tentacle-width-abs: calc(var(--tentacle-width) * var(--tentacle-width-scale));
    --tentacle-base-size: 32px;
    --tentacle-head-size: 15px;
}
.tentacle-guide .guide-sprite {
    position: absolute;
    left: 50%;
    bottom: 0;
    width: var(--tentacle-width-abs);
    height: var(--tentacle-length-abs);
    transform: translate(-50%, 0);
    background-image: var(--tentacle-art);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center bottom;
    image-rendering: pixelated;
    opacity: 0.85;
}
.tentacle-guide .guide-base {
    position: absolute;
    left: 50%;
    bottom: 0;
    width: var(--tentacle-base-size);
    height: var(--tentacle-base-size);
    border-radius: 50%;
    transform: translate(-50%, 50%);
    background:
        radial-gradient(120% 120% at 40% 40%, rgba(255, 190, 210, 0.95), transparent 70%),
        linear-gradient(180deg, rgba(255, 140, 170, 0.95), rgba(230, 90, 130, 0.78));
    box-shadow: 0 0 6px rgba(0, 0, 0, 0.35);
}
.tentacle-guide .guide-head {
    position: absolute;
    left: 50%;
    bottom: var(--tentacle-length-abs);
    width: var(--tentacle-head-size);
    height: var(--tentacle-head-size);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    background:
        radial-gradient(120% 120% at 40% 40%, rgba(255, 255, 255, 0.95), transparent 70%),
        linear-gradient(180deg, rgba(240, 240, 255, 0.95), rgba(210, 210, 230, 0.8));
    box-shadow:
        0 0 10px rgba(255, 255, 255, 0.7),
        0 0 16px rgba(200, 200, 240, 0.4);
}
.tentacle-guide .guide-skeleton {
    position: absolute;
    left: 50%;
    bottom: 0;
    width: 2px;
    height: 180px;
    transform: translate(-50%, 0);
    background: rgba(0, 255, 255, 0.35);
}
.tentacle-guide .guide-joint {
    position: absolute;
    left: 50%;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 255, 255, 0.8);
    box-shadow: 0 0 6px rgba(0, 255, 255, 0.5);
}
.tentacle-guide .guide-joint.top {
    top: 0;
}
.tentacle-guide .guide-joint.bottom {
    bottom: 0;
}

@keyframes tentacleRise {
    0% { transform: translate(-6px, 30px) scale(1.02); opacity: 0; }
    35% { transform: translate(0, -6px) scale(1.08); opacity: 0.92; }
    60% { transform: translate(4px, -10px) scale(1.05) rotate(-1deg); opacity: 0.8; }
    100% { transform: translate(-6px, 6px) scale(1.02); opacity: 0; }
}

@keyframes tentacleEnter {
    0% { opacity: 0; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)) translateY(16px); }
    100% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
}

@keyframes tentacleIdle {
    0% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
    100% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
}

@keyframes tentacleRetreat {
    0% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)) translateY(0); }
    100% { opacity: 0; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)) translateY(26px); }
}

@keyframes tentacleSimple {
    0% { opacity: 0; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
    20% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
    80% { opacity: 1; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
    100% { opacity: 0; transform: translate(var(--tentacle-x, 0px), var(--tentacle-y, 0px)); }
}

@keyframes tentacleSwayLite {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (2deg * var(--tentacle-wiggle)))) translateY(0); }
    45% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (4deg * var(--tentacle-wiggle)))) translateY(calc(-5px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (1deg * var(--tentacle-wiggle)))) translateY(0); }
}

@keyframes tentacleSwayWide {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (6deg * var(--tentacle-wiggle)))) translateY(0); }
    35% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (12deg * var(--tentacle-wiggle)))) translateY(calc(-12px * var(--tentacle-wiggle))); }
    70% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (6deg * var(--tentacle-wiggle)))) translateY(calc(-6px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (3deg * var(--tentacle-wiggle)))) translateY(0); }
}

@keyframes tentacleCurlSoft {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (4deg * var(--tentacle-wiggle)))) scaleY(1); }
    32% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (10deg * var(--tentacle-wiggle)))) scaleY(0.9) translateY(calc(-10px * var(--tentacle-wiggle))); }
    64% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (7deg * var(--tentacle-wiggle)))) scaleY(0.92) translateY(calc(-7px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (2deg * var(--tentacle-wiggle)))) scaleY(1); }
}

@keyframes tentacleCurlMedium {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (6deg * var(--tentacle-wiggle)))) scaleY(1); }
    30% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (16deg * var(--tentacle-wiggle)))) scaleY(0.82) translateY(calc(-16px * var(--tentacle-wiggle))); }
    65% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (10deg * var(--tentacle-wiggle)))) scaleY(0.85) translateY(calc(-10px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (3deg * var(--tentacle-wiggle)))) scaleY(1); }
}

@keyframes tentacleCurlDeep {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (8deg * var(--tentacle-wiggle)))) scaleY(1); }
    28% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (22deg * var(--tentacle-wiggle)))) scaleY(0.76) translateY(calc(-20px * var(--tentacle-wiggle))); }
    58% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (14deg * var(--tentacle-wiggle)))) scaleY(0.8) translateY(calc(-14px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (4deg * var(--tentacle-wiggle)))) scaleY(1); }
}

@keyframes tentacleCurlTight {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (10deg * var(--tentacle-wiggle)))) scaleY(1); }
    25% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (30deg * var(--tentacle-wiggle)))) scaleY(0.68) translateY(calc(-24px * var(--tentacle-wiggle))); }
    52% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (18deg * var(--tentacle-wiggle)))) scaleY(0.74) translateY(calc(-18px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (6deg * var(--tentacle-wiggle)))) scaleY(1); }
}

@keyframes tentacleTouch {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg))) translateY(0) scaleY(1); }
    18% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (10deg * var(--tentacle-wiggle)))) translateY(calc(-12px * var(--tentacle-wiggle))) scaleY(0.86); }
    46% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (4deg * var(--tentacle-wiggle)))) translateY(calc(6px * var(--tentacle-wiggle))) scaleY(1.06); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg))) translateY(0) scaleY(1); }
}

@keyframes tentacleWobble {
    0% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (5deg * var(--tentacle-wiggle)))) translateY(0); }
    22% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (14deg * var(--tentacle-wiggle)))) translateY(calc(-10px * var(--tentacle-wiggle))); }
    48% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (6deg * var(--tentacle-wiggle)))) translateY(calc(6px * var(--tentacle-wiggle))); }
    72% { transform: rotate(calc(var(--tentacle-angle, 0deg) + (10deg * var(--tentacle-wiggle)))) translateY(calc(-8px * var(--tentacle-wiggle))); }
    100% { transform: rotate(calc(var(--tentacle-angle, 0deg) - (2deg * var(--tentacle-wiggle)))) translateY(0); }
}

#abyss-bg .abyss-pressure-wave {
    position: absolute;
    inset: -24%;
    border-radius: 50%;
    pointer-events: none;
    background:
        radial-gradient(circle, rgba(246, 195, 106, 0.24) 0%, rgba(246, 195, 106, 0) 40%, transparent 60%),
        radial-gradient(80% 80% at 65% 42%, rgba(58, 16, 58, 0.26), transparent 55%),
        repeating-radial-gradient(circle at 50% 50%, rgba(246, 195, 106, 0.14) 0 1px, transparent 1px 9px);
    opacity: 0;
    transform: scale(calc(var(--wave-scale, 1) * 0.7));
    filter: drop-shadow(0 0 18px rgba(246, 195, 106, 0.25)) blur(10px);
    z-index: 4;
    overflow: hidden;
}

#abyss-bg.wave-pulse .abyss-pressure-wave {
    animation: abyssWavePulse 3s ease-out;
}

#abyss-bg.wave-strike .abyss-pressure-wave {
    animation: abyssWaveStrike 2.1s ease-out;
}

@keyframes abyssWavePulse {
    0% { opacity: 0.42; transform: scale(calc(var(--wave-scale, 1) * 0.7)); }
    40% { opacity: 0.28; transform: scale(calc(var(--wave-scale, 1) * 1.05)); }
    75% { opacity: 0.12; transform: scale(calc(var(--wave-scale, 1) * 1.24)); }
    100% { opacity: 0; transform: scale(calc(var(--wave-scale, 1) * 1.32)); }
}

@keyframes abyssWaveStrike {
    0% { opacity: 0.62; transform: scale(calc(var(--wave-scale, 1) * 0.6)); filter: blur(4px); }
    30% { opacity: 0.45; transform: scale(calc(var(--wave-scale, 1) * 1)); filter: blur(10px); }
    60% { opacity: 0.3; transform: scale(calc(var(--wave-scale, 1) * 1.26)); filter: blur(14px); }
    100% { opacity: 0; transform: scale(calc(var(--wave-scale, 1) * 1.5)); filter: blur(20px); }
}

#abyss-bg .abyss-gaze {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 72%;
    aspect-ratio: 1 / 1;
    transform: translate(-50%, -50%) scale(0.8);
    border-radius: 50%;
    border: 1px solid var(--gaze-ring, rgba(246, 195, 106, 0.24));
    box-shadow:
        0 0 18px var(--gaze-glow, rgba(246, 195, 106, 0.2)),
        inset 0 0 24px var(--gaze-core, rgba(124, 16, 37, 0.25));
    mix-blend-mode: screen;
    opacity: 0;
    z-index: 5;
    pointer-events: none;
}
#abyss-bg .abyss-gaze::after {
    content: "";
    position: absolute;
    inset: 30%;
    border-radius: 4px;
    background:
        repeating-linear-gradient(90deg, var(--gaze-pixel, #f6c36a) 0 6px, transparent 6px 8px),
        repeating-linear-gradient(0deg, var(--gaze-pixel, #f6c36a) 0 6px, transparent 6px 8px);
    box-shadow: 0 0 12px var(--gaze-glow, rgba(246,195,106,0.5));
    opacity: 0.9;
}

#abyss-bg.gaze-on .abyss-gaze {
    animation: predatorGaze 4.6s ease-out;
}

@keyframes predatorGaze {
    0% { opacity: 0.55; transform: scale(0.7) rotate(-6deg); }
    35% { opacity: 0.9; transform: scale(1) rotate(0deg); }
    60% { opacity: 0.5; transform: scale(1.1) rotate(2deg); }
    100% { opacity: 0; transform: scale(1.25) rotate(5deg); }
}

#abyss-bg .abyss-dim {
    position: absolute;
    inset: -6%;
    border-radius: 28px;
    background: radial-gradient(circle at 50% 50%, transparent 0%, rgba(0,0,0,1) 80%);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 6;
    pointer-events: none;
}

#abyss-bg .abyss-dim.dim-on {
    opacity: var(--dim-level, 0.3);
}

#abyss-bg .abyss-glitch {
    position: absolute;
    inset: -4%;
    background:
        repeating-linear-gradient(180deg, rgba(255,255,255,0.18) 0 2px, transparent 2px 6px),
        repeating-linear-gradient(90deg, rgba(120,160,255,0.2) 0 2px, transparent 2px 8px);
    opacity: 0;
    mix-blend-mode: screen;
    z-index: 7;
    pointer-events: none;
    transform: scale(0.92);
}

#abyss-bg .abyss-glitch.glitch-on {
    animation: glitchFlash 0.8s ease-out;
}

@keyframes glitchFlash {
    0% { opacity: 0; transform: scale(0.9); filter: hue-rotate(0deg); }
    25% { opacity: 0.8; transform: scale(1); filter: hue-rotate(10deg) saturate(1.2); }
    55% { opacity: 0.65; transform: scale(1.1); filter: hue-rotate(-8deg) saturate(1.1); }
    100% { opacity: 0; transform: scale(1.18); filter: hue-rotate(0deg); }
}

#abyss-bg .abyss-warp {
    position: absolute;
    inset: -12%;
    border-radius: 50%;
    background: none;
    opacity: 0;
    filter: none;
    z-index: 8;
    pointer-events: none;
}

#abyss-bg .abyss-warp.warp-on {
    animation: warpPulse 1.4s ease-out forwards;
}

@keyframes warpPulse {
    0% { opacity: 0.55; transform: scale(0.8) rotate(-4deg); box-shadow: 0 0 0 2px rgba(255, 208, 160, 0.35), 0 0 0 14px rgba(80, 50, 140, 0.18); }
    45% { opacity: 0.3; transform: scale(1.05) rotate(2deg); box-shadow: 0 0 0 6px rgba(255, 220, 180, 0.3), 0 0 0 22px rgba(90, 60, 150, 0.16); }
    100% { opacity: 0; transform: scale(1.26) rotate(6deg); box-shadow: 0 0 0 10px rgba(255, 230, 200, 0.1), 0 0 0 30px rgba(100, 70, 160, 0.08); }
}

#abyss-bg .abyss-jump {
    position: absolute;
    left: 50%;
    top: 50%;
    width: min(68%, 60vmin);
    aspect-ratio: 1 / 1;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    opacity: 0;
    filter: none;
    pointer-events: none;
    z-index: 9;
    background: none;
}
#abyss-bg .abyss-jump .jump-pack {
    position: absolute;
    inset: 0;
}
#abyss-bg .abyss-jump .jump-shard {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 6px;
    height: 10px;
    background: linear-gradient(180deg, #ffd694 0%, #ff8a5a 100%);
    border-radius: 2px;
    transform-origin: center;
    animation: jumpShard 0.9s ease-out forwards;
}
#abyss-bg .abyss-jump .jump-core {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 12px;
    height: 12px;
    margin-left: -6px;
    margin-top: -6px;
    border-radius: 2px;
    background:
        linear-gradient(90deg, #ffb84d 0%, #ff6a4d 100%),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.6) 0 2px, transparent 2px 4px);
    box-shadow: 0 0 12px rgba(255,140,90,0.8);
    animation: jumpCore 0.9s ease-out forwards;
}
.abyss-egg {
    position: absolute;
    inset: -8%;
    pointer-events: none;
    overflow: visible;
    mask-image: none;
    -webkit-mask-image: none;
    z-index: 120;
}
.abyss-egg .egg-pack {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    pointer-events: auto;
    animation:
        eggDrop 0.55s cubic-bezier(0.22, 1, 0.36, 1),
        eggFloat 2.4s ease-in-out 0.55s infinite alternate;
    background: none;
    object-fit: contain;
}
.abyss-egg .egg-dot {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 2px;
    background: linear-gradient(180deg, #ffd6a0 0%, #ff9ac0 100%);
    box-shadow: 0 0 8px rgba(255, 180, 180, 0.6);
    animation: eggDot 0.8s ease-out forwards;
}
.abyss-egg .egg-badge {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 26px;
    height: 26px;
    margin-left: -13px;
    margin-top: -13px;
    border-radius: 8px;
    background: linear-gradient(135deg, #ffe5b8, #ffb0d0);
    color: #4a1e1e;
    font-weight: 700;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 12px rgba(255, 200, 180, 0.9);
    animation: eggBadge 0.9s ease-out forwards;
}
.abyss-egg .egg-pack.egg-pop {
    animation: eggPop 0.6s ease-out forwards;
}

@keyframes eggDrop {
    0% { opacity: 0; transform: translate(-50%, -70%) scale(0.7) rotate(-6deg); }
    60% { opacity: 1; transform: translate(-50%, -48%) scale(1.06) rotate(2deg); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
}
@keyframes eggFloat {
    0% { transform: translate(-50%, -50%) scale(1) rotate(0deg); filter: drop-shadow(0 6px 14px rgba(0,0,0,0.25)); }
    100% { transform: translate(-50%, -52%) scale(1.02) rotate(-1.5deg); filter: drop-shadow(0 10px 18px rgba(0,0,0,0.22)); }
}
@keyframes eggPop {
    0% { transform: translate(-50%, -50%) scale(1); }
    60% { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
}

@keyframes jumpShard {
    0% { opacity: 0.9; transform: translate(-50%, -50%) rotate(var(--angle,0deg)) translateY(0) scale(1); }
    60% { opacity: 0.7; transform: translate(-50%, -50%) rotate(var(--angle,0deg)) translateY(calc(var(--dist,20px) * 0.8)) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle,0deg)) translateY(var(--dist,20px)) scale(1); }
}
@keyframes jumpCore {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.1); }
    100% { opacity: 0; transform: scale(1.2); }
}
@keyframes eggDot {
    0% { opacity: 0.9; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.1); }
}
@keyframes eggBadge {
    0% { opacity: 0.95; transform: scale(0.9); }
    50% { opacity: 0.9; transform: scale(1.05); }
    100% { opacity: 0; transform: scale(1.2); }
}
#abyss-bg .abyss-jump::before,
#abyss-bg .abyss-jump::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 50%;
    box-shadow: 0 0 0 3px rgba(255, 210, 170, 0.6);
    opacity: 0;
}
#abyss-bg .abyss-jump::after {
    inset: 12%;
    box-shadow: 0 0 0 2px rgba(120, 160, 255, 0.65);
}
#abyss-bg .abyss-jump.jump-on::before {
    animation: jumpPulseOuter 1s ease-out forwards;
}
#abyss-bg .abyss-jump.jump-on::after {
    animation: jumpPulseInner 1s ease-out forwards;
}
#abyss-bg .abyss-jump.jump-on {
    opacity: 1;
}

@keyframes jumpPulseOuter {
    0% { opacity: 0.9; transform: rotate(var(--jump-rot, 0deg)) scale(0.8); }
    40% { opacity: 0.8; transform: rotate(var(--jump-rot, 0deg)) scale(1.05); }
    100% { opacity: 0; transform: rotate(var(--jump-rot, 0deg)) scale(1.25); }
}
@keyframes jumpPulseInner {
    0% { opacity: 0.9; transform: rotate(var(--jump-rot, 0deg)) scale(0.9); }
    40% { opacity: 0.8; transform: rotate(var(--jump-rot, 0deg)) scale(1.08); }
    100% { opacity: 0; transform: rotate(var(--jump-rot, 0deg)) scale(1.22); }
}

#abyss-bg .abyss-permission {
    position: absolute;
    inset: 16%;
    border-radius: 50%;
    background:
        radial-gradient(circle, rgba(246, 195, 106, 0.35) 0%, transparent 55%),
        radial-gradient(circle at 60% 30%, rgba(90, 16, 40, 0.25), transparent 60%);
    opacity: 0;
    z-index: 9;
    filter: blur(8px);
    transform: scale(0.8);
    pointer-events: none;
}

#abyss-bg .abyss-permission.permit-on {
    animation: permitGlow 1.8s ease-out forwards;
}

@keyframes permitGlow {
    0% { opacity: 0.65; transform: scale(0.8); }
    45% { opacity: 0.4; transform: scale(1.05); }
    100% { opacity: 0; transform: scale(1.2); }
}

#abyss-bg .abyss-sigil {
    position: fixed;
    right: 12%;
    top: 18%;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid rgba(246, 195, 106, 0.7);
    background: radial-gradient(circle, rgba(255, 200, 230, 0.8), rgba(124, 16, 37, 0.4));
    color: #1a0a14;
    font-size: 18px;
    font-weight: 700;
    box-shadow: 0 0 18px rgba(246,195,106,0.6), 0 0 30px rgba(124,16,37,0.4);
    display: none;
    pointer-events: auto;
    cursor: pointer;
    z-index: 500;
    animation: sigilPulse 1.2s ease-in-out infinite;
}

#abyss-bg .abyss-sigil.show {
    display: block;
}

@keyframes sigilPulse {
    0% { transform: scale(0.9); opacity: 0.8; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.85; }
}

#abyss-bg::after {
    content: "";
    position: absolute;
    inset: 0;
    background:
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.02) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.015) 0 2px, transparent 2px 5px);
    mix-blend-mode: screen;
    opacity: 0.14;
    pointer-events: none;
    z-index: 6;
}

#story-header {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    padding: 4px 0 6px;
    border-bottom: 1px solid rgba(246, 195, 106, 0.18);
    margin-bottom: 6px;
    min-height: auto;
    line-height: 1.3;
}

.story-title {
    font-size: 17px;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #1a0a0d;
    background: linear-gradient(135deg, #f6c36a, #d86a8a);
    border: 1px solid rgba(246, 195, 106, 0.75);
    border-radius: 12px;
    padding: 6px 12px;
    box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        0 0 12px rgba(246, 195, 106, 0.35);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.35);
    transition: transform 0.18s ease, box-shadow 0.18s ease, opacity 0.18s ease;
}
.story-title:hover {
    box-shadow:
        0 8px 18px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.12),
        0 0 16px rgba(246, 195, 106, 0.42);
}
.story-title:active {
    transform: translateY(1px);
    opacity: 0.9;
}
.story-title:focus-visible {
    outline: 2px solid rgba(246, 195, 106, 0.6);
    outline-offset: 2px;
}

.story-subtitle {
    margin: 0;
    font-size: 12px;
    color: rgba(233, 210, 225, 0.82);
    letter-spacing: 0.14em;
}

.story-restore-hint {
    font-size: 11px;
    color: #f6c36a;
    letter-spacing: 0.06em;
    text-shadow: 0 0 8px rgba(246, 195, 106, 0.32);
}

/* ÂâßÊÉÖÂÜÖÂÆπÂå∫ + ËæìÂÖ•Âå∫ */
#story-log {
    flex: 1;
    overflow-y: auto;
    padding-right: 4px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    z-index: 3;
}

/* ÈöêËóèÊªöÂä®Êù°Ê†∑Âºè */
#story-log::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-log {
    scrollbar-width: none;
    -ms-overflow-style: none;
}

/* ËæìÂÖ•Ë°åÔºöÂõ∫ÂÆöÂú®ÂâßÊÉÖÂå∫Â∫ïÈÉ®ÔºåÈöèÂÆΩÂ∫¶Ëá™ÈÄÇÂ∫î */
#story-input-row {
    margin-top: auto;
    width: 100%;
    display: flex;
    align-items: flex-end;
    gap: 10px;
    position: relative;
    padding-top: 10px;
    z-index: 12;
}
/* Â§öË°å textareaÔºåÊñáÂ≠óÂûÇÁõ¥Â±Ö‰∏≠ÊÑü + Ëá™Âä®Â¢ûÈ´ò */
#story-input {
    flex: 1;
    padding: 10px 16px;
    border-radius: 16px;
    border: 1px solid rgba(255, 200, 220, 0.25);
    background: linear-gradient(180deg,
        rgba(60, 20, 35, 0.55),
        rgba(20, 12, 18, 0.85)
    );
    color: #f5e9f3;
    font-size: 13px;
    line-height: 1.6;
    resize: none;
    outline: none;

    min-height: 40px;     /* ‰∏§Ë°åËßÜËßâÈ´òÂ∫¶ */
    max-height: 70vh;     /* ÊúÄÂ§ßÂ±ïÂºÄÈ´òÂ∫¶ */
    overflow-y: auto;     /* ÂÜÖÈÉ®ÊªöÂä®Ôºå‰ΩÜÊù°ÈöêËóè */
}

#story-input::-webkit-scrollbar {
    width: 0;
    height: 0;
}
#story-input {
    scrollbar-width: none;
}

/* Â±ïÂºÄÂêéËæìÂÖ•Ê°ÜÂèòÈ´ò‰ΩÜ‰æùÁÑ∂‰øùÊåÅÂúÜËßíÁéªÁíÉÊÑü */
#story-input.expanded {
    height: 70vh;
    padding-top: 14px;
}

/* Â±ïÂºÄÂêéÊòæÁ§∫ÁÆ≠Â§¥ */
#input-collapse-btn {
    position: absolute;
    top: -26px;
    left: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255, 200, 220, 0.28);
    background: rgba(40, 15, 25, 0.85);
    color: #e8cadd;
    font-size: 13px;
    cursor: pointer;
}

/* ÂàùÂßãÈöêËóè */
.hidden {
    display: none;
}

#story-input::placeholder {
    color: rgba(244, 243, 247, 0.5);
}

/* ÂèëÈÄÅÊåâÈíÆÔºöÂÉèÁ¥†Âæ™ÁéØÂä®Áîª */
#story-send {
    position: relative;
    border-radius: 12px;
    padding: 0 20px;
    border: 2px solid rgba(246, 195, 106, 0.82);
    background:
        linear-gradient(180deg, rgba(30, 12, 20, 0.9), rgba(10, 4, 12, 0.92)),
        repeating-linear-gradient(45deg, rgba(246, 195, 106, 0.18) 0 8px, rgba(124, 16, 37, 0.12) 8px 14px, transparent 14px 20px);
    color: var(--accent);
    font-family: var(--pixel-font);
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.08em;
    cursor: pointer;
    min-width: 72px;
    box-shadow:
        0 0 0 2px rgba(8, 4, 12, 0.9),
        0 10px 22px rgba(0, 0, 0, 0.35),
        0 0 16px rgba(246, 195, 106, 0.25);
    overflow: hidden;
    isolation: isolate;
    transition: transform 0.12s ease, box-shadow 0.2s ease;
    animation: sendPixelStripe 2.4s linear infinite;
}
#story-send::before {
    content: "";
    position: absolute;
    inset: 3px;
    border-radius: 8px;
    border: 1px solid rgba(246, 195, 106, 0.65);
    background: repeating-linear-gradient(90deg, rgba(246, 195, 106, 0.1) 0 4px, rgba(216, 106, 138, 0.08) 4px 8px, transparent 8px 12px);
    opacity: 0.7;
    mix-blend-mode: screen;
    animation: sendPixelFrame 1.9s steps(6, end) infinite;
    pointer-events: none;
}
#story-send::after {
    content: "‚ñ∂";
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    font-family: var(--pixel-font);
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.55), 0 0 10px rgba(246, 195, 106, 0.5);
    animation: sendArrowBounce 1.1s steps(2, end) infinite;
}

#story-send:active {
    transform: translateY(1px) scale(0.98);
    box-shadow:
        0 6px 16px rgba(0, 0, 0, 0.35),
        0 0 12px rgba(246, 195, 106, 0.2);
}

#phone-shell {
    width: 100%;
    height: 100%;
    border-radius: 28px;
    overflow: hidden;   /* ÂÖ≥ÈîÆÔºöÈò≤Ê≠¢ÂÜÖÂ±èÊ∫¢Âá∫ */
    position: relative;
    background: #000;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.06),
        0 18px 40px rgba(0,0,0,0.9);
}

/* Âè≥‰æßÊâãÊú∫Âå∫ÂüüÔºàPCÔºâ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 130;
}

/* ÂÜÖÂ±èÂÜÖÂÆπÂå∫ÔºöÊ∞∏ËøúÂ°´Êª°Â§ñÂ£≥Ôºå‰∏çËá™Â∑±ÂÜ≥ÂÆöÂ∞∫ÂØ∏ */
#phone {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    /* Ê∑±Á∫¢ ‚Üí Ê∑±Á¥´ ‚Üí ÈªëÁöÑÊ∏êÂèòÂ£ÅÁ∫∏Ôºà‰Ω†ÁöÑÊúÄÂàùÊ¨æÔºâ */
    background:
        radial-gradient(circle at 10% 20%, rgba(120, 40, 65, 0.25), transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(200, 80, 110, 0.18), transparent 60%),
        linear-gradient(160deg, #1a0e13 0%, #050509 100%);

    border-radius: inherit;
}

/* È°∂ÈÉ®Áä∂ÊÄÅÊ†è */
#status-bar {
    position: absolute;
    top: 6px;
    left: 0; right: 0;
    height: 22px;
    padding: 0 12px;

    font-size: 12px;
    color: #fff;
    opacity: 0.9;

    display: flex;
    justify-content: space-between;
    align-items: center;

    z-index: 15;
}

.sb-left, .sb-right {
    display: flex;
    gap: 6px;
    align-items: center;
}

#sb-time {
    font-weight: 600;
    letter-spacing: .5px;
}

/* ‰ø°Âè∑ÂõæÊ†áÔºàÁ∫Ø CSSÔºâ */
.signal {
    display: flex;
    gap: 2px;
}
.signal::before,
.signal::after {
    content: "";
    width: 3px;
    background: #fff;
    border-radius: 2px;
}
.signal::before { height: 6px; opacity: .5; }
.signal::after { height: 10px; }

/* ÁîµÊ±†ÂõæÊ†á */
.battery {
    width: 22px;
    height: 10px;
    border-radius: 3px;
    border: 1px solid #fff;
    position: relative;
}
.battery-level {
    height: 100%;
    background: #fff;
    border-radius: 2px;
    width: 50%;
    transition: width .3s;
}

/* ÁÅµÂä®Â≤õÂàùÂßãÔºàÊäòÂè†Áä∂ÊÄÅÔºâ */
#dynamic-island {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    height: 34px;
    background: rgba(15, 15, 18, 1);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    transition: all 0.25s ease;
    box-shadow:
        0 2px 8px rgba(0,0,0,0.7),
        inset 0 0 0 1px rgba(255,255,255,0.08);
    overflow: hidden;
    z-index: 20;
}

/* Â±ïÂºÄÁä∂ÊÄÅ */
#dynamic-island.expanded {
    width: 260px;
    height: 70px;
    border-radius: 28px;
}

/* ÁÅµÂä®Â≤õËß£ÈîÅÂä®Áîª */
#dynamic-island.unlocking {
    animation: islandUnlock 0.8s cubic-bezier(.34,1.56,.64,1) forwards;
    overflow: visible;
}
#dynamic-island.pop {
    animation: islandPop 0.7s ease forwards;
}
#dynamic-island.unlocking .island-content { opacity: 0; }
#dynamic-island .unlock-ring,
#dynamic-island .unlock-face,
#dynamic-island .unlock-check {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
}
#dynamic-island .unlock-ring {
    inset: 6px;
    border-radius: 999px;
    border: 2px solid #7cf3a2;
    opacity: 0;
}
#dynamic-island .unlock-face,
#dynamic-island .unlock-check {
    font-size: 20px;
    color: #7cf3a2;
    opacity: 0;
}
#dynamic-island.unlocking .unlock-ring {
    animation: ringShow 0.8s ease forwards;
}
#dynamic-island.unlocking .unlock-face {
    animation: faceShow 0.8s ease forwards;
}
#dynamic-island.unlocking .unlock-check {
    animation: checkShow 0.8s ease forwards;
}
#dynamic-island.notify {
    animation: islandNotify 0.6s ease forwards;
}
#dynamic-island .island-bubble {
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translate(-50%, 10px);
    background: rgba(12, 12, 17, 0.92);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 999px;
    padding: 4px 10px;
    color: #fff;
    font-size: 11px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease, transform 0.25s ease;
}
#dynamic-island .island-bubble.show {
    opacity: 1;
    transform: translate(-50%, -2px);
}
@keyframes islandNotify {
    0% { transform: translateX(-50%) scale(1); box-shadow: 0 6px 14px rgba(0,0,0,0.4); }
    35% { transform: translateX(-50%) scale(1.06); box-shadow: 0 10px 20px rgba(0,0,0,0.5),0 0 0 6px rgba(244,182,196,0.25); }
    100% { transform: translateX(-50%) scale(1); box-shadow: 0 6px 14px rgba(0,0,0,0.4); }
}
@keyframes islandPop {
    0% { transform: translateX(-50%) scale(1); }
    40% { transform: translateX(-50%) scale(1.06); }
    100% { transform: translateX(-50%) scale(1); }
}

@keyframes islandUnlock {
    0%   { width:110px; height:34px; border-radius:20px; }
    45%  { width:78px;  height:78px; border-radius:18px; transform: translateX(-50%) scale(1.02); }
    70%  { width:72px;  height:72px; border-radius:16px; transform: translateX(-50%) scale(0.98); }
    100% { width:74px;  height:74px; border-radius:16px; transform: translateX(-50%) scale(1); }
}
@keyframes ringShow {
    0%   { opacity: 0; transform: scale(0.8); }
    25%  { opacity: 1; transform: scale(1.05); }
    70%  { opacity: 1; transform: scale(1); }
    100% { opacity: 0.9; }
}
@keyframes faceShow {
    0%   { opacity: 0; }
    20%  { opacity: 1; }
    45%  { opacity: 0; }
    100% { opacity: 0; }
}
@keyframes checkShow {
    0%   { opacity: 0; transform: scale(0.8); }
    60%  { opacity: 0; transform: scale(0.9); }
    75%  { opacity: 1; transform: scale(1); }
    100% { opacity: 1; }
}

/* ÂÜÖÈÉ®ÂÜÖÂÆπ */
#dynamic-island .island-content {
    opacity: 0.85;
    color: #f6f3f7;
    font-size: 12px;
    pointer-events: none; /* ÂÜÖÂÆπ‰∏çÈòªÊå°ÁÇπÂáª */
}

#message-banner {
    position: absolute;
    top: 58px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 300px;
    border-radius: 16px;
    background: rgba(10,10,14,0.92);
    border: 1px solid rgba(255,255,255,0.12);
    padding: 10px 14px;
    color: #f6f3f7;
    font-size: 12px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.55);
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s ease, transform .25s ease;
    z-index: 150;
    cursor: pointer;
}
#message-banner.show {
    opacity: 1;
    transform: translate(-50%, 0);
    pointer-events: auto;
}
.message-banner-title {
    font-weight: 700;
    margin-bottom: 4px;
}
.message-banner-text {
    color: rgba(255,255,255,0.8);
}

/* ÊâãÊú∫ÂÜÖÂ±èÂÜÖÂÆπ */
#home-screen,
.app-page {
    margin-top: 40px;
    flex: 1;
    display: grid;
    place-items: center;
}

/* È¶ñÈ°µ app ÂõæÊ†áÊ†ÖÊ†º */
#home-screen {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    
    padding-top: 70px;    /* ÁúüÂÆû iOS È°∂ÈÉ®ÁïôÁôΩ */
    padding-left: 12px;
    padding-right: 12px;

    row-gap: 24px;
    column-gap: 10px;

    justify-items: center;
    align-content: start; /* ‚Üê ÂÖ≥ÈîÆÔºöÈ°∂ÈÉ®Â†ÜÂè† */
    height: 100%;
}

.app-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    user-select: none;
}

.app-icon .icon {
    width: 54px;
    height: 54px;
    background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.18), transparent 60%),
                rgba(22, 22, 26, 0.96);
    border-radius: 16px;
    border: 1px solid rgba(120, 120, 130, 0.9);
    margin-bottom: 6px;
}

.app-icon p {
    font-size: 12px;
    opacity: 0.9;
}

/* app ÂÜÖÈ°µ */
.app-page {
    padding: 0;
    grid-template-rows: none;
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
}

.app-icon.dragging {
    opacity: 0.4;
    transform: scale(1.1);
}

.page-header {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-start;
    color: #f7f7f8;
    font-size: 13px;
    padding: 10px;
}

#wechat-page .page-header .back-home { display: none; }
#wechat-page .page-header {
    position: relative;
    padding: 10px 16px;
    border-bottom: none;
    background: transparent;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
}
#wechat-page .page-header #wechat-top {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 0.02em;
    line-height: 1.05;
    white-space: nowrap;
    padding-bottom: 4px;
}
#wechat-page.mode-list #wechat-top { display: inline-flex; }
#wechat-page.mode-chat #wechat-top,
#wechat-page.mode-chat #contacts-add-btn,
#wechat-page.mode-moments #contacts-add-btn,
#wechat-page.mode-wallet #contacts-add-btn,
#wechat-page:not(.mode-list) #contacts-add-btn {
    display: none !important;
}
#wechat-page.mode-chat .page-header {
    padding: 6px 12px 4px;
}
#wechat-page.mode-chat .chat-window-head {
    display: grid;
    grid-template-columns: 48px 1fr 48px;
    align-items: center;
    width: 100%;
    gap: 8px;
}
#wechat-page.mode-chat .chat-head-info {
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 6px;
    min-height: 0;
}
#wechat-page.mode-chat .chat-title {
    font-size: 16px;
}
#wechat-page.mode-chat .chat-head-actions {
    justify-content: flex-end;
}
#wechat-page.mode-chat #chat-back {
    justify-self: start;
}
#wechat-page.mode-chat #chat-menu-btn {
    justify-self: end;
}
#wechat-page .page-header .contact-add-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    margin-left: 0;
    justify-self: end;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    background: transparent;
    border: none;
    color: #fff9f0;
    font-weight: 800;
    font-size: 18px;
    line-height: 1;
    display: grid;
    place-items: center;
    padding: 0;
    box-shadow: none;
}
#call-page .page-header,
#memo-page .page-header {
    padding: 0 0 10px;
}

.page-header .back-home {
    width: 24px;
    height: 24px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.36);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    cursor: pointer;
}
.page-header span { display: none; }
.app-page .page-header span {
    display: inline;
}
.app-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}
.app-scroll::-webkit-scrollbar { width:0; height:0; }

#home-bar {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    min-width: 110px;
    height: 6px;
    padding: 0;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(230,240,255,0.9));
    box-shadow:
        0 6px 14px rgba(0,0,0,0.3);
    pointer-events: auto;
    z-index: 30000;
    touch-action: manipulation;
}
#home-bar::before {
    content: "";
    position: absolute;
    inset: -22px -48px;
    background: transparent;
    pointer-events: auto;
}

.page-body {
    margin-top: 8px;
    font-size: 12px;
    color: #ddd;
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}
.page-body::-webkit-scrollbar { width:0; height:0; }

/* --- ÂæÆ‰ø°ËΩªÈáèÊ†∑Âºè --- */
.wechat-body {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
    min-height: 0;
    overflow: hidden;
    padding: 0;
}
.wechat-top {
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.04em;
    flex: 1;
    text-align: center;
}
.wechat-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0;
    width: 100%;
    min-height: 0;
}
.wechat-tabs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    padding: 5px 0 9px;
}
.wechat-tabs button {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.35);
    color: #f5f5f5;
    padding: 6px 8px;
    font-size: 12px;
    cursor: pointer;
    position: relative;
}
.wechat-tabs button.has-unread::after {
    content: "";
    position: absolute;
    top: 4px;
    right: 8px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #ff6a89;
    box-shadow: 0 0 6px rgba(255,106,137,0.7);
}
.wechat-tabs button.active {
    background: rgba(244,182,196,0.18);
    border-color: rgba(244,182,196,0.65);
    color: #ffe9f5;
}
.wechat-bottom-tabs {
    position: sticky;
    bottom: 4px;
    margin-top: auto;
    border-top: 1px solid rgba(255,255,255,0.12);
    padding: 7px 0 4px;
    background: linear-gradient(180deg, rgba(5,5,8,0), rgba(5,5,8,0.85));
    backdrop-filter: blur(10px);
}
.wechat-panel {
    border: none;
    border-radius: 0;
    background: transparent;
    padding: 0;
    display: grid;
    gap: 8px;
    max-height: 100%;
    overflow: hidden;
    width: 100%;
}
.wechat-moments-wrap {
    position: relative;
    padding: 0;
    overflow-y: auto;
    height: 100%;
    display: flex;
    flex-direction: column;
}
.wechat-moments-wrap::-webkit-scrollbar { width: 0; }
.moments-hero {
    position: relative;
    height: 220px;
    background: #111;
}
.moments-notice-slot {
    position: absolute;
    bottom: 12px;
    right: 72px; /* stick left of avatar */
    width: 120px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 6;
    pointer-events: none;
}
.moments-cover {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.06), transparent 70%), linear-gradient(135deg, #1f1b2a, #0c0d12);
}
.moments-avatar {
    position: absolute;
    bottom: 12px;
    right: 12px;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: rgba(255,255,255,0.16);
    border: 1px solid rgba(255,255,255,0.24);
}
.moments-feed-inner {
    padding: 12px;
    display: grid;
    gap: 10px;
    flex: 1;
    min-height: 0;
}
.moment-composer {
    margin: 12px;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(0,0,0,0.35);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.moment-composer textarea {
    width: 100%;
    min-height: 56px;
    resize: none;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    padding: 8px 10px;
    background: rgba(8,8,12,0.65);
    color: #f5f5ff;
    font-size: 13px;
}
.moment-composer textarea:focus {
    outline: 1px solid rgba(255,255,255,0.22);
}
.moment-composer-actions {
    display: flex;
    justify-content: flex-end;
}
.moment-composer-actions button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    padding: 4px 18px;
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 12px;
}
.wc-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    position: relative;
}
.wc-item.pinned {
    border-color: rgba(255, 210, 140, 0.5);
    background: rgba(255, 255, 255, 0.04);
    box-shadow: 0 0 12px rgba(255, 200, 150, 0.2);
}
.wc-item-blocked {
    opacity: 0.6;
    filter: grayscale(0.3);
}
.wc-avatar {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: grid;
    place-items: center;
    background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.2), transparent 60%), rgba(20,20,24,0.8);
    font-size: 16px;
}
.wc-main {
    flex: 1;
    min-width: 0;
}
.wc-name {
    font-weight: 700;
    font-size: 13px;
}
.wc-sub {
    font-size: 11px;
    color: rgba(255,255,255,0.72);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.wc-time {
    font-size: 11px;
    color: rgba(255,255,255,0.65);
}
.wc-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 62px;
    justify-content: flex-end;
    margin-left: auto;
}
.wc-pin,
.wc-blocked {
    font-size: 10px;
    border-radius: 6px;
    padding: 1px 6px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.3);
    color: #f3f3f3;
}
.wc-pin {
    border-color: rgba(255,200,150,0.6);
    background: rgba(255, 220, 180, 0.12);
    color: #fdf2d8;
}
.wc-blocked {
    border-color: rgba(255,80,80,0.6);
    background: rgba(255,80,80,0.18);
    color: #ffcfcf;
}
.wc-unread {
    position: static;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(244,182,196,0.9);
    color: #1a0e13;
    font-weight: 800;
    line-height: 1;
    min-width: 16px;
    text-align: center;
}
.wc-badge {
    font-size: 10px;
    padding: 1px 6px;
    border-radius: 999px;
    border: 1px solid rgba(244,182,196,0.6);
    color: #f7d2e0;
}
.moment-card {
    border-radius: 12px;
    padding: 10px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.06);
    display: grid;
    gap: 4px;
}
.moment-meta {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: rgba(255,255,255,0.65);
}
.moment-actions {
    display: flex;
    gap: 6px;
}
.moment-actions button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.06);
    color: #f3f3f3;
    font-size: 11px;
    padding: 4px 8px;
    cursor: pointer;
}
.moment-actions button.like {
    background: rgba(120,200,140,0.2);
    border-color: rgba(120,200,140,0.6);
}
.moment-actions button.delete {
    background: rgba(255,80,80,0.14);
    border-color: rgba(255,80,80,0.5);
    color: #ffcccc;
}
.moment-comment-panel {
    margin-top: 6px;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 8px;
    background: rgba(0,0,0,0.32);
    display: none;
    flex-direction: column;
    gap: 6px;
}
.moment-comment-panel.show {
    display: flex;
}
.moment-comment-input {
    width: 100%;
    min-height: 48px;
    resize: none;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(0,0,0,0.45);
    color: #f6f3ff;
    font-size: 12px;
    padding: 8px 10px;
}
.moment-comment-input:focus {
    outline: 1px solid rgba(255,255,255,0.26);
}
.moment-comment-controls {
    display: flex;
    justify-content: flex-end;
}
.moment-send-btn {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(255,255,255,0.12);
    color: #fff;
    font-size: 11px;
    padding: 4px 16px;
}
.mention-menu {
    display: none;
    flex-wrap: wrap;
    gap: 6px;
    left: 20;
}
.mention-menu.open {
    display: flex;
    align-items: center;
}
.mention-menu button {
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 10px;
    padding: 4px 10px;
}
.mention-empty {
    font-size: 10px;
    opacity: 0.6;
}
.moment-comments {
    margin-top: 6px;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.moment-comment {
    font-size: 11px;
    color: rgba(255,255,255,0.82);
    display: flex;
    gap: 4px;
}
.moment-comment-author {
    font-weight: 700;
    color: rgba(255,255,255,0.95);
}
.moment-comment-text {
    flex: 1;
    color: rgba(255,255,255,0.82);
}

/* ÁîµËØùÈ°µ */
.call-page-body,
#call-page .page-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.call-tabs {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    padding: 8px 0;
    position: sticky;
    bottom: 0;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255,255,255,0.12);
    margin-top: auto;
    width: 100%;
}
.call-tabs button {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.08);
    color: #f6f6f6;
    padding: 8px 6px;
    font-size: 12px;
    cursor: pointer;
}
.call-tabs button.active {
    background: rgba(120,200,255,0.18);
    border-color: rgba(120,200,255,0.65);
    color: #e8f6ff;
}
.call-panel {
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
    flex: 1;
    min-height: 0;
    overflow: auto;
    width: 100%;
}
.call-panel::-webkit-scrollbar { width: 0; height: 0; }
.call-item {
    padding: 10px;
    border-radius: 0;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.08);
    width: 100%;
}
.call-item + .call-item {
    border-top: none;
}
.call-item .top {
    display: flex;
    justify-content: space-between;
    font-weight: 700;
    font-size: 13px;
}
.call-item .sub {
    margin-top: 4px;
    font-size: 11px;
    color: rgba(255,255,255,0.72);
}
.dial-display {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    padding: 10px;
    text-align: center;
    background: rgba(0,0,0,0.18);
    font-size: 16px;
    color: #f6f6f6;
}
.dial-grid {
    margin-top: 10px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}
.dial-key {
    height: 56px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.1);
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    display: grid;
    place-items: center;
    cursor: pointer;
}
.dial-call {
    margin-top: 12px;
    border-radius: 999px;
    border: 1px solid rgba(120,200,140,0.8);
    background: rgba(120,200,140,0.35);
    color: #0e2a14;
    padding: 10px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
}
.wallet-balance {
    padding: 10px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(244,182,196,0.24), rgba(120,60,90,0.32));
    border: 1px solid rgba(244,182,196,0.45);
    cursor: pointer;
}
.wallet-balance .label { font-size: 12px; opacity: 0.8; }
.wallet-balance .value { font-size: 20px; font-weight: 700; margin: 4px 0; }
.wallet-balance .sub { font-size: 11px; opacity: 0.78; }
.wallet-actions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}
.wallet-btn {
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.05);
    color: #f7f7f7;
    padding: 10px 6px;
    font-size: 12px;
    display: grid;
    place-items: center;
    cursor: pointer;
}
.wallet-inline-detail {
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
    display: none;
    max-height: 260px;
    overflow: hidden;
}
.wallet-inline-detail.show { display: block; }
.wallet-inline-detail h4 {
    margin: 0 0 6px 0;
    font-size: 13px;
    letter-spacing: 0.06em;
    color: #fbe7cf;
}
.wallet-inline-actions {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
    margin-top: 8px;
}
.wallet-inline-balance {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 6px;
}
.wallet-inline-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 4px;
}
.wallet-inline-list li {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #f4e9f5;
}
.wallet-inline-list li em {
    font-style: normal;
    color: #f6c36a;
}
.wallet-inline-list li.empty {
    color: rgba(244,233,245,0.7);
    justify-content: center;
}

/* Phone glass overrides */
#phone-layer .ui-btn {
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.08);
    color: #f6f6f7;
    box-shadow: 0 8px 18px rgba(0,0,0,0.35);
    backdrop-filter: blur(8px);
}
#phone-layer .ui-btn.ui-primary {
    border-color: rgba(255,255,255,0.22);
    background: rgba(255,255,255,0.12);
    color: #fdfdfd;
}
#phone-layer .ui-btn.ui-ghost {
    border-color: rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: #f6f6f7;
}
#phone-layer .wallet-btn {
    border-color: rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color: #f7f7f7;
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}

/* Martial MMO (phone) */
:root {
    --wuxia-ink: #0c0f0d;
    --wuxia-obsidian: #0a0d0c;
    --wuxia-gold: #f2cf87;
    --wuxia-amber: #c7a05f;
    --wuxia-glass: rgba(20, 24, 22, 0.82);
}
.mmo-shell {
    position: relative;
    min-height: 100%;
    display: grid;
    place-items: stretch;
    background:
        radial-gradient(140% 120% at 12% 10%, rgba(110, 156, 120, 0.22), transparent 52%),
        radial-gradient(120% 110% at 80% 0%, rgba(98, 128, 164, 0.2), transparent 58%),
        linear-gradient(145deg, rgba(10,14,12,0.92), rgba(10,12,14,0.88));
    overflow: hidden;
    border-radius: 18px;
    padding: 5px;
    border: 1px solid color-mix(in srgb, var(--wuxia-gold) 22%, rgba(255,255,255,0.12));
    box-shadow: 0 22px 54px rgba(0,0,0,0.45), inset 0 0 0 1px rgba(255,255,255,0.04);
    width: 100%;
}
.mmo-shell .mmo-login,
.mmo-shell .mmo-main {
    position: relative;
    z-index: 3;
}
.mmo-particles-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
    image-rendering: pixelated;
    opacity: 0.95;
    mix-blend-mode: lighten;
    filter: drop-shadow(0 0 24px rgba(130, 220, 150, 0.35));
    z-index: 2;
}
.mmo-shell[data-state="login"] {
    place-items: center;
    padding: 12px;
}
.mmo-shell[data-state="login"] .mmo-main { display: none; }
.mmo-shell[data-state="game"] .mmo-login { display: none; }
.mmo-login {
    display: grid;
    gap: 12px;
    padding: 32px;
    width: min(520px, calc(100% - 24px));
    margin: 0 auto;
    border-radius: 18px;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(8px);
    text-align: center;
    box-sizing: border-box;
}
.mmo-title { margin: 0; letter-spacing: 0.12em; width: 140px;}
.mmo-sub { margin: 0; color: rgba(255,255,255,0.75); }
.mmo-main {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    max-width: 100%;
    padding: 0 18px;
    margin: 0 auto;
    box-sizing: border-box;
    min-width: 0;
}
.mmo-content,
.mmo-view {
    width: 100%;
    min-width: 0;
    overflow-x: hidden;
}
.mmo-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
}
.mmo-bg-gradient {
    position: absolute;
    inset: 0;
    background:
        linear-gradient(160deg, rgba(14,44,28,0.9), rgba(12,28,40,0.92)),
        radial-gradient(120% 120% at 10% 10%, rgba(120,200,160,0.22), transparent 60%),
        radial-gradient(100% 100% at 80% 0%, rgba(120,180,220,0.18), transparent 55%);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
}
#mmo-particles {
    position: absolute;
    inset: 0;
    display: none;
}
.mmo-topbar {
    width: 100%;
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 12px 18px;
    background: color-mix(in srgb, var(--wuxia-glass) 88%, transparent);
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--wuxia-gold) 30%, rgba(255,255,255,0.12));
    box-shadow: 0 18px 38px rgba(0,0,0,0.35);
}
.mmo-avatar {
    width: 40px;
    height: 40px;
    border-radius: 14px;
    background:
        linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        rgba(255,255,255,0.06);
    border: 1px solid color-mix(in srgb, var(--wuxia-gold) 26%, rgba(255,255,255,0.22));
    display: grid;
    place-items: center;
    font-weight: 800;
    color: #f6eeda;
    cursor: pointer;
    flex-shrink: 0;
    margin-right: auto;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06), 0 10px 24px rgba(0,0,0,0.35);
}
.mmo-avatar.has-phoenix {
    border-color: color-mix(in srgb, var(--wuxia-gold) 60%, rgba(255,255,255,0.2));
    box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 10px 30px rgba(0,0,0,0.4), 0 0 18px rgba(255,215,120,0.35);
    background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04)),
        radial-gradient(circle at 30% 20%, rgba(255,215,120,0.26), transparent 60%),
        rgba(255,255,255,0.08);
    color: #ffecc0;
}
.mmo-avatar.has-phoenix {
    background: linear-gradient(135deg, rgba(246,195,106,0.36), rgba(255,255,255,0.1));
    border-color: rgba(246,195,106,0.6);
    box-shadow: 0 0 18px rgba(246,195,106,0.4);
}
.mmo-top-info { display: none; }
.mmo-menu-btn { min-width: 42px; margin-left: auto; }
.mmo-close-btn { min-width: 42px; }
.mmo-menu {
    position: absolute;
    top: 64px;
    right: 12px;
    transform: translateX(0);
    display: grid;
    gap: 8px;
    padding: 12px;
    border-radius: 16px;
    background: rgba(0,0,0,0.86);
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: 0 16px 36px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.04);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    z-index: 9;
    pointer-events: auto;
}
.mmo-menu[aria-hidden="true"],
.mmo-menu[hidden] { display: none; }
.mmo-menu button {
    border: 1px solid color-mix(in srgb, var(--wuxia-gold) 26%, rgba(255,255,255,0.16));
    background:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        rgba(255,255,255,0.06);
    color: #f7f5ef;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
    transition: transform 0.12s ease, box-shadow 0.2s ease;
}
.mmo-menu button:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 18px rgba(0,0,0,0.3), inset 0 0 0 1px rgba(255,255,255,0.08);
}
.mmo-content {
    position: relative;
    z-index: 1;
    padding: 8px 0 18px;
    min-height: 0;
    width: 100%;
    max-width: 100%;
    flex: 1;
    overflow: hidden;
}
.mmo-content::-webkit-scrollbar { width:0; height:0; }
.mmo-view {
    position: absolute;
    inset: 0;
    min-height: 100%;
    height: 100%;
    width: 100%;
    max-width: 100%;
    display: none;
    flex-direction: column;
    align-self: stretch;
    overflow-y: auto;
    padding-bottom: 12px;
}
.mmo-recharge { overflow-y: auto; }
.mmo-recharge {
    flex: 1;
    min-height: 100%;
    position: relative;
}
.mmo-view.active {
    display: flex;
}
.mmo-hero {
    position: relative;
    top: 0;
    right: 0;
    display: grid;
    gap: 10px;
    padding: 14px;
    border-radius: 16px;
    background: rgba(0,0,0,0.62);
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(12px);
    z-index: 3;

}
.mmo-hero h3 { margin: 0 0 6px 0; }
.mmo-hero p { margin: 0 0 10px 0; color: rgba(255,255,255,0.78); }
.mmo-cta-row { display: flex; gap: 8px; flex-wrap: wrap; }
.mmo-feature-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
}
.mmo-feature-card {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    padding: 10px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}
.mmo-feature-card .feature-title {
    font-weight: 800;
    color: #f6c36a;
    margin-bottom: 4px;
    letter-spacing: 0.06em;
}
.mmo-feature-card .feature-copy {
    color: rgba(255,255,255,0.78);
    font-size: 13px;
}
.mmo-subhead {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 10px;
    color: rgba(255,255,255,0.8);
    width: 100%;
    flex-wrap: wrap;
}
.mmo-currency-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    gap: 2px;
    text-align: left;
    min-width: 0;
}
.mmo-currency-label {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: rgba(230,245,234,0.85);
    font-weight: 700;
    letter-spacing: 0.06em;
}
.mmo-currency-value {
    font-size: 18px;
    font-weight: 800;
    color: #d9ffba;
    text-shadow: 0 0 6px rgba(90,180,120,0.35);
    word-break: break-all;
}
.mmo-coin-icon {
    width: 16px;
    height: 16px;
}
.mmo-shop-body {
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-height: 540px;
    width: 100%;
    min-width: 0;
}
.phoenix-effect {
    position: relative;
    overflow: hidden;
}
.phoenix-effect::after {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 16px;
    background: radial-gradient(circle at 30% 20%, rgba(255,215,120,0.35), transparent 55%), radial-gradient(circle at 70% 80%, rgba(255,120,80,0.28), transparent 55%);
    opacity: 0.9;
    pointer-events: none;
    animation: phoenixPulse 2.6s infinite ease-in-out;
}
@keyframes phoenixPulse {
    0%, 100% { opacity: 0.85; transform: scale(1); }
    50% { opacity: 0.35; transform: scale(1.03); }
}
.mmo-shop-list {
    display: grid;
    gap: 8px;
    padding-right: 6px;
    overflow-y: auto;
    max-height: 360px;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
    width: 100%;
    min-width: 0;
}
.mmo-shop-list::-webkit-scrollbar { width:0; height:0; }
.mmo-shop-card {
    --shop-border: color-mix(in srgb, var(--wuxia-gold) 24%, rgba(255,255,255,0.16));
    --shop-bg: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)), color-mix(in srgb, #0d1110 88%, rgba(255,255,255,0.05));
    --shop-shadow: 0 12px 26px rgba(0,0,0,0.28), inset 0 0 0 1px rgba(255,255,255,0.03);
    border-radius: 14px;
    border: 1px solid var(--shop-border);
    background: var(--shop-bg);
    color: #f5f5f5;
    padding: 12px;
    text-align: left;
    cursor: pointer;
    box-shadow: var(--shop-shadow);
    transition: transform 0.15s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    appearance: none;
    word-break: keep-all;
}
.mmo-shop-card.is-legend {
    --shop-border: rgba(255,215,120,0.78);
    --shop-bg:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04)),
        radial-gradient(circle at 20% 20%, rgba(255,215,120,0.28), transparent 60%),
        color-mix(in srgb, #1a1410 82%, rgba(255,255,255,0.06));
    --shop-shadow: 0 0 24px rgba(255,215,120,0.3), inset 0 0 0 1px rgba(255,255,255,0.08);
}
.mmo-shop-card.is-legend:hover {
    box-shadow: 0 0 28px rgba(255,215,120,0.4), 0 10px 28px rgba(0,0,0,0.38);
}
/* bump specificity to beat global button styles */
.mmo-shell button.mmo-shop-card {
    border: 1px solid var(--shop-border, color-mix(in srgb, var(--wuxia-gold) 24%, rgba(255,255,255,0.16))) !important;
    background: var(--shop-bg, linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)), color-mix(in srgb, #0d1110 88%, rgba(255,255,255,0.05))) !important;
    box-shadow: var(--shop-shadow, 0 12px 26px rgba(0,0,0,0.28), inset 0 0 0 1px rgba(255,255,255,0.03)) !important;
    color: #f5f5f5 !important;
}
.mmo-shop-card.button,
button.mmo-shop-card {
    border-radius: 14px;
    border: 1px solid var(--shop-border, color-mix(in srgb, var(--wuxia-gold) 24%, rgba(255,255,255,0.16)));
    background: var(--shop-bg, linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)), color-mix(in srgb, #0d1110 88%, rgba(255,255,255,0.05)));
    color: #f5f5f5;
    padding: 12px;
    text-align: left;
    cursor: pointer;
    box-shadow: var(--shop-shadow, 0 12px 26px rgba(0,0,0,0.28), inset 0 0 0 1px rgba(255,255,255,0.03));
    transition: transform 0.15s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    appearance: none;
    word-break: keep-all;
}
.mmo-shop-card.tier-2580 { --shop-bg: linear-gradient(180deg, rgba(120,90,170,0.24), rgba(120,90,170,0.12)); --shop-border: rgba(160,120,210,0.8); }
.mmo-shop-card.tier-1280 { --shop-bg: linear-gradient(180deg, rgba(80,140,200,0.22), rgba(80,140,200,0.1)); --shop-border: rgba(120,170,230,0.8); }
.mmo-shop-card.tier-680 { --shop-bg: linear-gradient(180deg, rgba(140,140,140,0.22), rgba(120,120,120,0.12)); --shop-border: rgba(180,180,180,0.7); }
.mmo-shop-card.is-sale {
    --shop-border: rgba(204,64,64,0.85);
    --shop-shadow: 0 0 16px rgba(204,64,64,0.4), inset 0 0 0 1px rgba(255,255,255,0.05);
    --shop-bg:
        linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02)),
        radial-gradient(circle at 18% 24%, rgba(160,110,200,0.32), transparent 58%),
        color-mix(in srgb, #211327 85%, rgba(255,255,255,0.04));
}
.mmo-shop-card:hover {
    background: rgba(255,255,255,0.08);
    border-color: color-mix(in srgb, var(--wuxia-gold) 30%, rgba(255,255,255,0.2));
    transform: translateY(-2px);
    box-shadow: 0 18px 32px rgba(0,0,0,0.38), 0 0 0 1px color-mix(in srgb, var(--wuxia-gold) 30%, rgba(255,255,255,0.14));
}

@media (max-width: 520px) {
    .mmo-main {
        padding: 0 12px;
    }
    .mmo-shop-body {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    .mmo-shop-list {
        max-height: none;
    }
}
.mmo-shop-detail {
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.05);
    padding: 12px;
    min-height: 200px;
    position: static;
    align-self: stretch;
}
.mmo-shop-title { font-weight: 700; margin-bottom: 6px; }
.mmo-shop-price { color: #f6c36a; margin-bottom: 8px; }
.mmo-shop-note { color: rgba(255,255,255,0.7); margin-top: 6px; font-size: 12px; }
.mmo-gacha-bg {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    border: 1px solid rgba(246,195,106,0.18);
    background:
        linear-gradient(160deg, #0b0f10 0%, #062419 35%, #0a2c2c 70%, #140a1a 100%);
    padding: 50px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-height: 480px;
    box-shadow: none;
}
.mmo-gacha-bg > * { position: relative; z-index: 2; }
.mmo-gacha-triangles {
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    overflow: hidden;
}
.gacha-triangle {
    position: absolute;
    left: var(--x, 0%);
    top: -18%;
    width: var(--size, 12px);
    height: var(--size, 12px);
    background: linear-gradient(180deg, rgba(110, 240, 200, 0.8), rgba(40, 170, 140, 0.8));
    border: 1px solid rgba(210, 255, 240, 0.85);
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    opacity: 0.3;
    animation: gachaTriFall var(--duration, 10s) linear infinite;
    animation-delay: calc(var(--delay, 0s) * -1);
    transform: translate3d(0, 0, 0);
    will-change: transform;
}
@keyframes gachaTriFall {
    from { transform: translate3d(0, -20%, 0); }
    to { transform: translate3d(var(--drift, 0px), 120%, 0); }
}
.mmo-gacha-actions {
    display: flex;
    gap: 8px;
    padding-left: -80px;
    justify-content: center;
    margin-top: auto;
    padding-top: 150px;
    padding-bottom: 10px;
    width: 100%;
}
.mmo-gacha-results {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    gap: 8px;
    min-height: 260px;
    flex: 1;
    transform: translateY(-38px);
    justify-items: stretch;
    align-items: stretch;
}
.mmo-gacha-results.single-grid {
    display: flex;
    justify-content: center;
    align-items: center;
    transform: translateY(90px); /* single draw: drop about two card heights */
}
.mmo-gacha-results.small-grid {
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    gap: 8px;
    transform: translateY(5px); /* ten-pull: drop about one card height */
}
.mmo-gacha-results.compact-grid {
    /* 50-pull compact grid:
       - Top anchor set by translateY below; adjust here for highest visible row
       - Left origin aligns with translateX to offset an extra card width
       - Width range fills 6 columns across available container */
    grid-template-columns: repeat(6, 1fr);
    gap: 8px;
    transform: translate(0, -20px);
}
.mmo-gacha-results.compact-grid .mmo-crystal {
    aspect-ratio: 1 / 1;
    min-height: auto;
    height: auto;
    padding: 6px;
    border-radius: 10px;
    font-size: 13px;
}
.mmo-crystal {
    border-radius: 12px;
    padding: 10px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    font-size: 12px;
    min-height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}
.mmo-gacha-results.single-grid .mmo-crystal {
    min-height: 36px;
    padding: 6px 10px;
}
.mmo-gacha-results.small-grid .mmo-crystal {
    min-height: 28px;
    padding: 4px 8px;
}
.mmo-crystal.compact {
    min-height: auto;
    aspect-ratio: 1 / 1;
    padding: 6px;
    font-size: 13px;
    font-weight: 800;
}
.mmo-crystal.purple { border-color: rgba(180,120,255,0.7); color: #e9d7ff; }
.mmo-crystal.gold { border-color: rgba(255,215,120,0.8); color: #ffe7a6; box-shadow: 0 0 16px rgba(255,215,120,0.35); }
.mmo-recharge-cards {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    overflow-y: auto;
    scrollbar-width: none;
    flex: 1;
    -webkit-overflow-scrolling: touch;
}
.mmo-recharge-cards::-webkit-scrollbar { width:0; height:0; }
.mmo-recharge-card {
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.05);
    padding: 12px;
    display: grid;
    gap: 6px;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
}
.mmo-recharge-card .recharge-amount { font-weight: 800; font-size: 16px; color: #f6c36a; }
.mmo-recharge-card .recharge-price { color: rgba(255,255,255,0.75); }
.mmo-leader-list {
    display: grid;
    gap: 6px;
    max-height: 70vh;
    overflow-y: auto;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
}
.mmo-leader-list::-webkit-scrollbar { width:0; height:0; }
.mmo-rank-row {
    display: grid;
    grid-template-columns: 40px 1fr auto;
    align-items: center;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
}
.rank-name.gold { color: #f6c36a; font-weight: 800; text-shadow: 0 0 10px rgba(255,215,120,0.35); }
.rank-badge.gold {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 6px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,215,120,0.9), rgba(180,120,40,0.9));
    color: #1a1206;
    font-size: 12px;
    box-shadow: 0 0 8px rgba(255,215,120,0.4);
}
.mmo-player-rank { margin-top: 8px; color: #f6c36a; }
.mmo-player-rank {
    position: sticky;
    bottom: 0;
    padding: 14px 0 18px;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.45));
    margin-top: 12px;
}
.mmo-leader {
    padding-bottom: 48px;
}
.mmo-bag-list { display: grid; gap: 6px; }
.mmo-bag-list {
    overflow-y: auto;
    scrollbar-width: none;
    max-height: 70vh;
}
.mmo-bag-list::-webkit-scrollbar { width:0; height:0; }
.mmo-bag-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    color: #f5f5f5;
}
.mmo-bag-row.phoenix-upgraded {
    box-shadow: 0 0 0 1px rgba(255,215,120,0.6), 0 0 0 3px rgba(220,80,60,0.6);
}
.mmo-bag-row em { font-style: normal; color: rgba(255,255,255,0.7); }
.mmo-bag-row.gold { border-color: rgba(255,215,120,0.7); }
.mmo-bag-row.purple { border-color: rgba(180,120,255,0.6); }
.mmo-placeholder { color: rgba(255,255,255,0.7); padding: 6px 0; }
.mmo-toast {
    position: fixed;
    left: 50%;
    bottom: 20px;
    transform: translate(-50%, 20px);
    padding: 8px 12px;
    border-radius: 12px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.1);
    color: #f5f5f5;
    opacity: 0;
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 2000;
}
.mmo-toast.show { opacity: 1; transform: translate(-50%, 0); }
.mmo-coin-icon {
    width: 18px;
    height: 18px;
    margin-right: 6px;
}
.mmo-coin-text {
    vertical-align: auto;
}
.mmo-pixel-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 10px;
    padding: 10px 0;
}
.mmo-pixel-cell {
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 10px;
    background: rgba(255,255,255,0.04);
    display: grid;
    place-items: center;
    padding: 10px;
}

.wechat-chat-window {
    border: none;
    border-radius: 0;
    background: transparent;
    display: none;
    flex-direction: column;
    min-height: 0;
    flex: 1;
    width: 100%;
    align-self: stretch;
    overflow: hidden;
}
.chat-window-head {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    padding: 4px 8px;
    gap: 6px;
    background: transparent;
    border-bottom: none;
    flex-shrink: 0;
    width: 100%;
}
.chat-window-head > * {
    flex-shrink: 0;
}
.chat-head-info {
    display: flex;
    align-items: center;
    gap: 4px;
    flex: 1;
    justify-content: center;
    text-align: center;
    flex-direction: column;
    min-height: 36px;
}
.chat-title {
    font-weight: 600;
    font-size: 15px;
    letter-spacing: 0.02em;
}
.chat-head-status {
    font-size: 12px;
    letter-spacing: 0.08em;
    color: rgba(255, 255, 255, 0.65);
    opacity: 0;
    transition: opacity 0.2s ease;
}
.chat-head-actions {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-wrap: wrap;
    margin-left: auto;
}
.chat-head-btn {
    width: 36px;
    height: 36px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.22);
    color: #f5f1f5;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}
.chat-head-actions button {
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background: rgba(255, 255, 255, 0.06);
    color: #f5f1f5;
    font-size: 11px;
    padding: 4px 10px;
    cursor: pointer;
    transition: border 0.2s ease, background 0.2s ease;
}
.chat-head-actions button:hover {
    border-color: rgba(255, 200, 150, 0.8);
    background: rgba(255, 200, 150, 0.1);
}
.chat-action-btn.danger {
    border-color: rgba(255, 90, 90, 0.5);
    background: rgba(255, 70, 70, 0.14);
    color: #ffdede;
}
#chat-head-controls {
    display: none;
}
#chat-recall-btn {
    min-width: 60px;
    padding: 4px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
    color: #fff;
    font-size: 11px;
    letter-spacing: 0.04em;
    display: none;
}
.chat-unread-total {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(244, 182, 196, 0.9);
    color: #1a0e13;
    font-weight: 800;
    font-size: 11px;
}
.chat-window-log {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 12px 0;
    background: transparent;
    overflow: auto;
    scrollbar-width: none;
    touch-action: pan-y;
    overscroll-behavior: contain;
}
.chat-window-log::-webkit-scrollbar { width:0; height:0; }
.chat-row {
    display: flex;
    gap: 8px;
    padding: 0;
}
.chat-row.in { justify-content: flex-start; }
.chat-row.out { justify-content: flex-end; flex-direction: row-reverse; padding-right: 0; }
.chat-avatar {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.24);
    display: grid;
    place-items: center;
    font-size: 12px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.08);
}
.chat-bubble {
    max-width: 78%;
    padding: 10px 12px;
    border-radius: 16px;
    font-size: 13px;
    line-height: 1.6;
    position: relative;
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
}
.chat-bubble.in { align-self: flex-start; background: #fff; color: #222; border: 1px solid rgba(0,0,0,0.06); }
.chat-bubble.out { align-self: flex-end; background: #6ad35f; color: #0b2b08; border: 1px solid rgba(0,0,0,0.08); margin-left: auto; }
.chat-bubble.pay { background: rgba(120,200,140,0.25); border-color: rgba(120,200,140,0.65); }
.chat-bubble.red { background: rgba(240,120,120,0.22); border-color: rgba(240,120,120,0.6); }
.chat-bubble.red-can-open {
    cursor: pointer;
    box-shadow: 0 0 12px rgba(240,120,120,0.4);
}
.chat-tip-bubble {
    background: rgba(255,255,255,0.18);
    color: #1c1118;
    border: none;
    font-size: 12px;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 60%;
    margin: 0 auto;
    }
.chat-row.system-tip {
    justify-content: center;
}
.chat-bubble.chat-recalled {
    font-style: italic;
    color: rgba(255,255,255,0.68);
}
.chat-window-input {
    display: flex;
    gap: 8px;
    padding: 10px 0;
    border-top: none;
    background: transparent;
    position: sticky;
    bottom: 0;
    flex-shrink: 0;
}
.chat-window-input input {
    flex: 1;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.5);
    color: #fff;
    padding: 7px 10px;
    font-size: 12px;
    outline: none;
}
.chat-window-input button {
    border-radius: 999px;
    border: 1px solid rgba(244,182,196,0.65);
    background: rgba(244,182,196,0.18);
    color: #ffe9f5;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
}
.chat-window-input #chat-actions-toggle {
    width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.08);
    color: #fff;
    font-size: 18px;
    line-height: 1;
}
.chat-window-input #chat-actions-toggle.active {
    background: rgba(244,182,196,0.25);
    border-color: rgba(244,182,196,0.6);
}
.chat-actions-panel {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 0 10px;
    background: rgba(4,4,8,0.92);
    border-top: 1px solid rgba(255,255,255,0.08);
    overflow: hidden;
    max-height: 0;
    transition: max-height .2s ease, padding .2s ease;
}
.chat-actions-panel.open {
    padding: 8px 10px calc(12px + env(safe-area-inset-bottom));
    max-height: 70vh;
    overflow-y: auto;
}
.chat-actions-buttons {
    display: flex;
    gap: 8px;
    width: 100%;
}
.chat-actions-buttons button {
    flex: 1;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.22);
    background: rgba(255,255,255,0.08);
    color: #f5f5f5;
    font-size: 12px;
    padding: 8px 10px;
    cursor: pointer;
}
.chat-action-form {
    flex-basis: 100%;
    display: none;
    flex-direction: column;
    gap: 8px;
}
.chat-action-form.show {
    display: flex;
}
.chat-action-display {
    font-size: 16px;
    font-weight: 700;
    text-align: center;
}
.chat-action-display::-webkit-inner-spin-button,
.chat-action-display::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
.chat-action-display {
    -moz-appearance: textfield;
}
.chat-action-keypad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
}
.chat-action-keypad button {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.05);
    color: #fff;
    font-size: 14px;
    padding: 10px 0;
    cursor: pointer;
}
.chat-action-keypad button[data-key="‚Üê"] {
    font-weight: 700;
}
.chat-action-form-buttons {
    display: flex;
    gap: 8px;
}
.chat-action-form-buttons button {
    flex: 1;
}

/* ÊÇ¨ÊµÆÊâãÊú∫ÊåâÈíÆÔºöÂÉèÁ¥†Â∞èÊâãÊú∫ÂõæÊ†á */
#phone-toggle {
    position: fixed;
    z-index: 1201;
    bottom: calc(20px + env(safe-area-inset-bottom, 0px));
    right: calc(20px + env(safe-area-inset-right, 0px));
    width: 46px;
    height: 46px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background:
        radial-gradient(circle at 30% 30%, rgba(171, 42, 42, 0.2), transparent 60%),
        linear-gradient(180deg, #3a1222 0%, #31121d 100%);
    border: 1px solid rgba(255, 180, 210, 0.45);
    box-shadow:
        0 0 6px rgba(233, 123, 160, 0.35),
        0 4px 12px rgba(0, 0, 0, 0.6);
    box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.06);
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
    overflow: visible;
}

.pixel-phone {
    width: 20px;
    height: 28px;
    border-radius: 5px;
    border: 1px solid rgba(255, 255, 255, 0.7);
    background: #07060a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
}

.pixel-screen {
    width: 14px;
    height: 16px;
    border-radius: 3px;
    background:
        radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255, 130, 170, 0.4), transparent 70%),
        linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.pixel-phone::after {
    content: "";
    width: 6px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
}
#phone-toggle.notify {
    animation: phoneBounce 0.35s ease-in-out 2;
}
#phone-toggle.special-alert {
    animation: toggleSpecialPulse 0.4s ease-in-out 6;
    box-shadow:
        0 0 20px rgba(255, 92, 124, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.12);
}

#phone-toggle.special-alert .pixel-screen {
    background:
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.6), transparent 70%),
        linear-gradient(145deg, rgba(255, 138, 168, 0.6), rgba(82, 29, 54, 0.9));
}

#phone-toggle.special-alert #phone-toggle-bubble {
    background: rgba(255, 92, 124, 0.85);
    color: #1a0409;
}
#phone-toggle-bubble {
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translate(-50%, -10px);
    background: rgba(10,10,14,0.92);
    color: #fff;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.2);
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease, transform .2s ease;
    white-space: nowrap;
}
#phone-toggle-bubble.show {
    opacity: 1;
    transform: translate(-50%, -30px);
}
@keyframes phoneBounce {
    0% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0); }
}

@keyframes toggleSpecialPulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.08);
    }
    100% {
        transform: scale(1);
    }
}

#red-envelope-overlay {
    background: var(--ui-backdrop);
    backdrop-filter: blur(var(--ui-backdrop-blur));
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease;
}
#red-envelope-overlay.show {
    opacity: 1;
    pointer-events: auto;
}
.red-envelope-card {
    width: min(320px, 88vw);
    padding: var(--ui-space-12) var(--ui-space-16);
    border-radius: var(--ui-radius-lg);
    border: 1px solid var(--ui-border);
    background: var(--ui-surface-1);
    box-shadow: var(--ui-shadow-soft);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--ui-space-10);
    text-align: center;
    color: var(--ui-text-strong);
}
.red-envelope-title {
    font-size: 14px;
    opacity: 0.85;
}
.red-envelope-amount {
    font-size: 26px;
    font-weight: 800;
}
.red-envelope-note {
    font-size: 12px;
    opacity: 0.8;
}

#in-call-overlay {
    background: var(--ui-backdrop);
    backdrop-filter: blur(var(--ui-backdrop-blur));
    opacity: 0;
    pointer-events: none;
    transition: opacity .2s ease;
    z-index: var(--ui-z-modal);
}
#in-call-overlay.show {
    opacity: 1;
    pointer-events: auto;
}
.in-call-card {
    width: min(320px, 88vw);
    border-radius: var(--ui-radius-lg);
    border: 1px solid color-mix(in srgb, var(--ui-border) 70%, transparent);
    background:
        radial-gradient(120% 120% at 20% 20%, color-mix(in srgb, var(--ui-accent) 10%, transparent), transparent 70%),
        var(--ui-surface-1);
    padding: var(--ui-space-14, 14px) var(--ui-space-16);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--ui-space-10);
    text-align: center;
    box-shadow: var(--ui-shadow-soft);
}
.in-call-name {
    font-size: 18px;
    font-weight: 800;
}
.in-call-status {
    font-size: 12px;
    color: rgba(255,255,255,0.75);
}
.in-call-timer {
    font-size: 24px;
    letter-spacing: 0.08em;
}
.in-call-transcript {
    width: 100%;
    max-height: 140px;
    overflow-y: auto;
    border-radius: 18px;
    padding: 10px;
    background: rgba(255,255,255,0.03);
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.transcript-row {
    font-size: 12px;
    text-align: left;
    padding: 6px 10px;
    border-radius: 10px;
    background: rgba(255,255,255,0.06);
}
.transcript-row.user {
    align-self: flex-end;
    background: rgba(178, 255, 205, 0.12);
}
.transcript-row.npc {
    align-self: flex-start;
    background: rgba(255, 255, 255, 0.08);
}
#in-call-end {
    width: 100%;
    border-radius: 999px;
    border: none;
    padding: 10px 0;
    font-size: 14px;
    font-weight: 700;
    background: #f45252;
    color: #fff;
    cursor: pointer;
}

.memo-body {
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
}
.memo-controls {
    display: flex;
    justify-content: flex-end;
    padding: 10px 0;
}
.memo-controls button {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.4);
    color: #fff;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
}
.memo-log {
    flex: 1;
    min-height: 0;
    overflow: auto;
    display: flex;
    flex-direction: column;
    gap: 0;
    padding-bottom: 10px;
}
.memo-log::-webkit-scrollbar { width: 0; height: 0; }
.memo-item {
    border-radius: 0;
    border: 1px solid rgba(255,255,255,0.08);
    padding: 8px 10px;
    background: rgba(255,255,255,0.04);
    font-size: 12px;
    color: rgba(255,255,255,0.85);
    display: flex;
    justify-content: space-between;
    gap: 10px;
    width: 100%;
}
.memo-item + .memo-item {
    border-top: none;
}
.memo-item span {
    font-weight: 600;
    color: rgba(255,255,255,0.9);
}

#dynamic-island.call-alert {
    width: 220px;
    height: 80px;
    border-radius: 26px;
}
#dynamic-island.call-alert .island-content {
    display: none;
}
.island-call {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 6px;
}
#dynamic-island.call-alert .island-call {
    display: flex;
}
.island-call-name {
    font-size: 13px;
    font-weight: 700;
}
.island-call-actions {
    display: flex;
    gap: 12px;
}
.pixel-btn {
    width: 32px;
    height: 32px;
    border: 2px solid rgba(255,255,255,0.6);
    border-radius: 6px;
    background: rgba(0,0,0,0.8);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    box-shadow: inset 0 0 0 2px rgba(0,0,0,0.6);
}
.pixel-btn.accept {
    border-color: #88f598;
    color: #88f598;
}
.pixel-btn.decline {
    border-color: #ff8383;
    color: #ff8383;
}

body.pc-mode.phone-open #phone-layer {
    display: flex;
}



/* ÊâãÊú∫Á´ØÔºöÁõ¥Êé•ÊääÁΩëÈ°µÁ´ØÁöÑÊâãÊú∫ÊåâÊØî‰æãÊîæÂ§ßÂ±Ö‰∏≠ÊòæÁ§∫ */
body.mobile-mode #phone-layer {
    position: fixed;
    inset: 0;  /* È°∂ÈÉ®Âà∞Â∫ïÈÉ®ÂÖ®Ë¶ÜÁõñ */
    display: none;
    justify-content: center;
    align-items: center;
    width: auto;
    max-width: 100vw;
    height: auto;
    padding: 10px;             /* ‰∏éÊ°åÈù¢‰∏ÄËá¥ÁöÑÂÜÖËæπË∑ù */

    background: rgba(0,0,0,0.40); /* ÂçäÈÄèÊòéÈÅÆÁΩ© */
    backdrop-filter: blur(6px);

    z-index: 1100;
    pointer-events: none;   /* ÈªòËÆ§‰∏çËÉΩÁÇπÂáªÔºàÊú™Â±ïÂºÄÊó∂Ôºâ */
    opacity: 0;
    transition: opacity .25s ease;
}

/* Â±ïÁ§∫ÊâãÊú∫ */
body.mobile-mode #phone-layer.show {
    display: flex;
    pointer-events: auto;
    opacity: 1;
}

/* ÊâãÊú∫Êú¨‰ΩìÂ∞∫ÂØ∏ÔºöÊåâÊØî‰æãÁº©ÊîæÔºå‰∏ç‰ºöÂèòÂΩ¢ */
body.mobile-mode #phone-shell {
    width: min(380px, 92vw); /* Á≠âÊØîÁº©ÊîæÔºå‰øùÊåÅ‰∏éÊ°åÈù¢‰∏ÄËá¥ */
    transform: scale(1);
    transition: transform .25s ease;
}

/* ÊâãÊú∫Á´ØÁªü‰∏ÄÂ∞ÅË£ÖÂ∞∫ÂØ∏Ôºà‰ΩúÁî®‰∫é phone-packÔºâ */
body.mobile-mode .phone-pack {
    width: min(380px, 92vw);
}

/* ÂΩìÊâãÊú∫Â±ÇÊâìÂºÄÊó∂ÔºåÂèØÊ†πÊçÆÈúÄË¶ÅÈöêËóèËæìÂÖ•ÔºàÂÖà‰øùÁïôÊòæÁ§∫ÔºåËÆ©‰Ω†ÊÑüÂèó‰∏Ä‰∏ãÊïàÊûúÔºâ
   Â¶ÇÊûú‰Ω†Â∏åÊúõÊâãÊú∫Â±ÇÊâìÂºÄÊó∂ÊâãÊú∫Á´ØÈöêËóèËæìÂÖ•ÔºåÂèØ‰ª•ÊîπÊàê display:none; */
body.mobile-mode.phone-open #story-input-row {
    /* display: none;  // Â¶ÇÊûúÊÉ≥ÂÆåÂÖ®ÈöêËóèÔºåÂú®ËøôÈáåËß£Ê≥®Èáä */
}

/* ÂìçÂ∫îÂºèÔºöÊõ¥Á™ÑÊó∂Êï¥‰ΩìÂ∑¶Âè≥ padding Êî∂Á¥ß */
@media (max-width: 600px) {
    #app {
        padding: 10px;
        padding-top: calc(10px + env(safe-area-inset-top, 0px));
        padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
        padding-left: calc(10px + env(safe-area-inset-left, 0px));
        padding-right: calc(10px + env(safe-area-inset-right, 0px));
    }
    #story-panel {
        min-height: 70vh;
    }
}

@media (max-width: 640px) {
    #app {
        padding: 6px;
        padding-top: calc(6px + env(safe-area-inset-top, 0px));
        padding-bottom: calc(6px + env(safe-area-inset-bottom, 0px));
        padding-left: calc(6px + env(safe-area-inset-left, 0px));
        padding-right: calc(6px + env(safe-area-inset-right, 0px));
    }
    #story-panel {
        padding-left: 5px;
        padding-right: 5px;
    }
}


.click-anim {
    transition: transform .12s ease, filter .2s ease;
}
.click-anim:active {
    transform: scale(0.92);
    filter: brightness(1.3);
}


#sb-time {
    font-weight: 600;
    letter-spacing: .5px;
}

/* ‰ø°Âè∑ÂõæÊ†áÔºàÁ∫Ø CSSÔºâ */
.signal {
    display: flex;
    gap: 2px;
}
.signal::before,
.signal::after {
    content: "";
    width: 3px;
    background: #fff;
    border-radius: 2px;
}
.signal::before { height: 6px; opacity: .5; }
.signal::after { height: 10px; }

/* ÁîµÊ±†ÂõæÊ†á */
.battery {
    width: 22px;
    height: 10px;
    border-radius: 3px;
    border: 1px solid #fff;
    position: relative;
}
.battery-level {
    height: 100%;
    background: #fff;
    border-radius: 2px;
    width: 50%;
    transition: width .3s;
}

/* ÁÅµÂä®Â≤õÂàùÂßãÔºàÊäòÂè†Áä∂ÊÄÅÔºâ */
#dynamic-island {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    height: 34px;
    background: rgba(15, 15, 18, 1);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    transition: all 0.25s ease;
    box-shadow:
        0 2px 8px rgba(0,0,0,0.7),
        inset 0 0 0 1px rgba(255,255,255,0.08);
    overflow: hidden;
    z-index: 20;
}

/* Â±ïÂºÄÁä∂ÊÄÅ */
#dynamic-island.expanded {
    width: 260px;
    height: 70px;
    border-radius: 28px;
}

/* ÂÜÖÈÉ®ÂÜÖÂÆπ */
#dynamic-island .island-content {
    opacity: 0.85;
    color: #f6f3f7;
    font-size: 12px;
    pointer-events: none; /* ÂÜÖÂÆπ‰∏çÈòªÊå°ÁÇπÂáª */
}

/* ÊâãÊú∫ÂÜÖÂ±èÂÜÖÂÆπ */
#home-screen,
.app-page {
    margin-top: 40px;
    flex: 1;
    display: grid;
    place-items: center;
}

/* È¶ñÈ°µ app ÂõæÊ†áÊ†ÖÊ†º */
#home-screen {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    padding-top: 62px;   /* iOS È°∂ÈÉ®ËæÉÂ§ßÁ©∫Èöô */
    row-gap: 28px;
    column-gap: 14px;

    width: 100%;
    height: 100%;
    justify-items: center;
}

.app-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    user-select: none;
}

.app-icon .icon {
    width: 54px;
    height: 54px;
    background: radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.18), transparent 60%),
                rgba(22, 22, 26, 0.96);
    border-radius: 16px;
    border: 1px solid rgba(120, 120, 130, 0.9);
    margin-bottom: 6px;
}

.app-icon p {
    font-size: 12px;
    opacity: 0.9;
}

/* app ÂÜÖÈ°µ */
.app-page {
    padding: 10px;
    grid-template-rows: auto 1fr;
}

.app-icon.dragging {
    opacity: 0.4;
    transform: scale(1.1);
}

.page-header {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #f7f7f8;
    font-size: 13px;
}

.page-header .back-home {
    width: 24px;
    height: 24px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.36);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    cursor: pointer;
}

#home-bar {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 110px;
    min-width: 110px;
    height: 6px;
    padding: 0;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(230,240,255,0.9));
    box-shadow:
        0 6px 14px rgba(0,0,0,0.3);
    pointer-events: auto;
    z-index: 30000;
    touch-action: manipulation;
}
#home-bar::before {
    content: "";
    position: absolute;
    inset: -22px -48px;
    background: transparent;
    pointer-events: auto;
}

.page-body {
    margin-top: 8px;
    font-size: 12px;
    color: #ddd;
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 0;
    scrollbar-width: none;
}

/* ÊÇ¨ÊµÆÊâãÊú∫ÊåâÈíÆÔºöÂÉèÁ¥†Â∞èÊâãÊú∫ÂõæÊ†á */
#phone-toggle {
    position: fixed;
    z-index: 1201;
    bottom: calc(20px + env(safe-area-inset-bottom, 0px));
    right: calc(20px + env(safe-area-inset-right, 0px));
    width: 46px;
    height: 46px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.24);
    background:
        radial-gradient(circle at 30% 30%, rgba(171, 42, 42, 0.2), transparent 60%),
        linear-gradient(180deg, #3a1222 0%, #31121d 100%);
    border: 1px solid rgba(255, 180, 210, 0.45);
    box-shadow:
        0 0 6px rgba(233, 123, 160, 0.35),
        0 4px 12px rgba(0, 0, 0, 0.6);
    box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.06);
    padding: 0;
    display: grid;
    place-items: center;
    cursor: pointer;
}

.pixel-phone {
    width: 20px;
    height: 28px;
    border-radius: 5px;
    border: 1px solid rgba(255, 255, 255, 0.7);
    background: #07060a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 3px;
}

.pixel-screen {
    width: 14px;
    height: 16px;
    border-radius: 3px;
    background:
        radial-gradient(circle at 0% 0%, rgba(255, 255, 255, 0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(255, 130, 170, 0.4), transparent 70%),
        linear-gradient(145deg, var(--bg-top), var(--bg-bottom));
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.pixel-phone::after {
    content: "";
    width: 6px;
    height: 2px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
}

/* Âè≥‰æßÊâãÊú∫Âú® PC ‰∏äÁöÑÊ≠£Â∏∏Ê†∑ÂºèÔºà‰øùÊåÅ‰Ω†Áé∞Âú®ÁöÑÂÜôÊ≥ïÔºâ */
#phone-layer {
    width: 380px;
    margin-right: 0;
    max-width: 46vw;
    border-radius: 24px;
    padding: 10px;
    background: radial-gradient(140% 140% at 0% 0%, rgba(255, 255, 255, 0.04), transparent 60%),
                radial-gradient(140% 140% at 100% 100%, rgba(255, 120, 160, 0.18), transparent 55%),
                rgba(5, 6, 10, 0.88);
    border: 1px solid var(--border);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 255, 255, 0.04);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* PC ‰∏äÂèØÈÄöËøá JS Âä† hidden-phone Êù•ÈöêËóèÂè≥‰æßÊâãÊú∫ */
#phone-layer.hidden-phone {
    display: none;
}

/* ------------ Á™ÑÂ±èÔºàÊâãÊú∫ÂÆΩÂ∫¶ÔºâÊó∂ÁöÑË°å‰∏∫ ------------ */
@media (max-width: 900px) {
    /* Â∏ÉÂ±ÄÂèòÊàêÂçïÂàóÔºöÂè™ÊòæÁ§∫ÂâßÊÉÖÈù¢ÊùøÔºåÂè≥‰æßÊâãÊú∫Ëøô‰∏ÄÂàóÂÖàÈöêËóè */
    #app {
        flex-direction: column;
    }

}

/* ÂìçÂ∫îÂºèÔºöÊõ¥Á™ÑÊó∂Êï¥‰ΩìÂ∑¶Âè≥ padding Êî∂Á¥ß */
@media (max-width: 600px) {
    #app {
        padding: 10px;
        padding-top: calc(10px + env(safe-area-inset-top, 0px));
        padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
        padding-left: calc(10px + env(safe-area-inset-left, 0px));
        padding-right: calc(10px + env(safe-area-inset-right, 0px));
    }
    #story-panel {
        min-height: 70vh;
    }
}


.click-anim {
    transition: transform .12s ease, filter .2s ease;
}
.click-anim:active {
    transform: scale(0.92);
    filter: brightness(1.3);
}

.app-icon {
    transition: transform .12s ease, filter .2s ease;
}

.app-icon:hover {
    transform: scale(1.07);
}

.app-icon:active {
    transform: scale(0.92);
    filter: brightness(1.2);
}

@media (hover: none) {
    .app-icon:active {
        transform: scale(0.95);
    }
}

#dynamic-island {
    transition: transform .25s ease, filter .2s ease;
}

#dynamic-island:hover {
    transform: translateX(-50%) scale(1.05);
}

#dynamic-island:active {
    transform: translateX(-50%) scale(0.95);
    filter: brightness(1.15);
}

.app-icon.launching {
    animation: launch 0.18s ease forwards;
}
@keyframes launch {
    to { transform: scale(0.4); opacity: 0; }
}
.story-bubble.reading-mode p {
    margin-bottom: 8px;
}
.narration-lead {
    position: relative;
}

.narration-lead::after {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 12px;
    background: radial-gradient(circle, rgba(255,220,200,0.12), transparent 70%);
    pointer-events: none;
}

@media (max-width: 460px) {
    .story-bubble {
        max-width: 92%;
    }
    .story-block {
        padding: 0 4%;
    }
}
.story-bubble.bubble-center {
    align-self: center;
}

/* --- Mobile Context Menu (Bottom Sheet) --- */
#story-context-menu.mobile-sheet {
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

#story-context-menu.mobile-sheet .context-panel {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    border-radius: 24px 24px 0 0;
    padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
    animation: slideUp 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    background: rgba(28,16,26,0.92);
    backdrop-filter: blur(16px);
}

#story-context-menu.mobile-sheet button {
    padding: 14px 18px;
    font-size: 14px;
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

/* --- Responsive Adjustments --- */
@media (max-width: 768px) {
    .story-edit-sheet .edit-panel {
        width: 95%;
        max-height: 80vh;
    }

    .story-edit-sheet textarea {
        min-height: 200px;
        max-height: 50vh;
        font-size: 14px;
    }
}

.page-header {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}
.contact-add-btn {
    margin-left: auto;
    border-radius: 999px;
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.3);
    font-size: 18px;
}
.chat-head-actions {
    position: relative;
}
.chat-menu-btn {
    width: 36px;
    height: 36px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.3);
}
.chat-head-menu {
    display: none;
    position: absolute;
    right: 0;
    top: 44px;
    background: rgba(8, 6, 12, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 16px;
    padding: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(14px);
    z-index: 50;
    min-width: 150px;
}
.chat-head-menu.show {
    display: grid;
    gap: 8px;
}
.chat-head-menu button {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.12);
    color: #fff;
    font-size: 14px;
    text-align: left;
    padding: 10px 12px;
    border-radius: 12px;
    width: 100%;
}
.chat-head-menu button:hover {
    background: rgba(255, 255, 255, 0.14);
}
.chat-context-menu {
    position: fixed;
    background: rgba(15, 12, 20, 0.95);
    border-radius: 14px;
    padding: 6px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    display: none;
    z-index: 80;
    min-width: 120px;
    backdrop-filter: blur(12px);
}
.chat-context-menu.show {
    display: block;
}
.chat-context-menu button {
    border: none;
    background: transparent;
    color: #fff;
    font-size: 14px;
    padding: 6px 14px;
}
.modal {
    position: absolute;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(2, 2, 4, 0.7);
    backdrop-filter: blur(6px);
    z-index: 200;
}
.modal.show {
    display: flex;
}
.modal-content {
    background: rgba(12, 10, 18, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 18px;
    padding: 20px;
    width: min(320px, 90%);
    backdrop-filter: blur(14px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
}
.modal-content input {
    width: 100%;
    margin: 12px 0;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.04);
    color: #fff;
}
.modal-actions {
    display: flex;
    gap: 10px;
}
.modal-actions button {
    flex: 1;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
    padding: 8px 0;
}
.modal-actions .ghost {
    background: transparent;
}
.moments-notice-rail {
    min-width: 100%;
    height: 14px;
    border-radius: 999px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.08));
    position: relative;
    margin-right: 0;
    opacity: 0.45;
    cursor: pointer;
    transition: opacity 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    z-index: 7;
    pointer-events: auto;
}
.moments-notice-rail::before {
    content: attr(data-count);
    position: absolute;
    right: 6px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    color: #1a0c12;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(255, 223, 196, 0.9);
    display: none;
}
.moments-notice-rail.has-notice::before {
    display: inline-flex;
}
.moments-notice-rail::after {
    content: "";
    position: absolute;
    inset: 3px 4px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}
.moments-notice-rail.has-notice {
    opacity: 0.9;
    box-shadow: 0 0 12px rgba(255, 220, 180, 0.3);
    border: 1px solid rgba(255, 230, 200, 0.4);
}
.moments-notice-rail:hover {
    opacity: 1;
    transform: translateY(-1px);
}
.moments-notice-rail .notice-label {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    color: rgba(255,255,255,0.85);
    background: transparent;
    padding: 0;
    border-radius: 0;
    display: none;
}
.moments-notice-rail.has-notice .notice-label {
    display: inline-flex;
}
.moments-notice-panel {
    position: absolute;
    inset: 0;
    display: none;
    background: rgba(1, 1, 2, 0.92);
    border-radius: 12px;
    padding: 16px;
    margin: 0;
    border: 1px solid rgba(255, 255, 255, 0.08);
    z-index: 30;
    overflow-y: auto;
    overflow-x: hidden;
}
.moments-notice-panel.show {
    display: flex;
}
.moments-notice-inner {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 100%;
}
.notice-panel-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
}
.notice-panel-head button {
    border: none;
    background: transparent;
    color: #fff;
    font-size: 20px;
}
.moments-notice-list {
    max-height: 280px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.moments-notice-item {
    border-radius: 12px;
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.04);
    cursor: pointer;
}
.moments-notice-item:hover {
    border-color: rgba(255, 255, 255, 0.2);
}
.chat-row.system {
    justify-content: center;
}
.chat-system-bubble {
    background: rgba(255, 255, 255, 0.9);
    color: #1a1022;
    border-radius: 12px;
    padding: 8px 12px;
    max-width: 280px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    font-size: 13px;
}
.chat-row.system .chat-avatar {
    display: none;
}
.chat-recalled {
    opacity: 0.6;
    font-style: italic;
}
.moment-delete-btn {
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ff9096;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 8px;
    padding: 4px 10px;
    margin-left: 8px;
}
.wc-item-pinned {
    border-left: 3px solid rgba(255, 160, 180, 0.9);
}
.wc-item-blocked {
    opacity: 0.6;
}

/* Shell opener highlight */
.bubble-opening {
    animation: openerGlow 1.6s ease-in-out;
    box-shadow:
        0 18px 32px rgba(246, 195, 106, 0.18),
        0 0 0 1px rgba(246,195,106,0.22),
        0 0 32px rgba(124, 16, 37, 0.25);
}
@keyframes openerGlow {
    0% { opacity: 0; transform: translateY(6px); }
    40% { opacity: 1; transform: translateY(0); }
    100% { opacity: 1; }
}
@media (prefers-reduced-motion: reduce) {
    .bubble-opening { animation: none; }
}
.mmo-subhead .mmo-currency {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1;
    min-width: 0;
}
.mmo-subhead .mmo-pity,
.mmo-subhead .mmo-wallet-tip {
    flex-shrink: 0;
    white-space: nowrap;
}
