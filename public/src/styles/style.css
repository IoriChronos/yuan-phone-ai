@import url("../ui/tokens.css");
@import url("../ui/components/button.css");
@import url("../ui/components/input.css");
@import url("../ui/components/select.css");
@import url("../ui/components/bubble.css");
@import url("../ui/components/modal.css");
@import url("../ui/components/panel.css");
@import url("../ui/components/header.css");
@import url("../ui/components/chips.css");
@import url("../ui/components/scrollbar.css");
@import url("../ui/surfaces/home.css");
@import url("../shell/pages/chat-page.css");

/* UI Layer: 统一圆角/间距/边框/hover/disabled，禁止裸用原生 button/input/select。 */

:root {
    --accent: #b4ec7c;
    --accent-strong: #9cd56b;
    --accent-ghost: color-mix(in srgb, var(--accent) 18%, transparent);
    --text-main: #f7f1f9;
    --bg-base: #0b0f0c;
    --bg-glow-1: #a4ef9a;
    --bg-glow-2: #2f8f7b;
    --card-bg: rgba(255,255,255,0.03);
    --viewport-height: 100vh;
    --page-max-width: min(1180px, calc(100vw - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 24px));
}

@supports (height: 100svh) {
    :root { --viewport-height: 100svh; }
}
@supports (height: 100dvh) {
    :root { --viewport-height: 100dvh; }
}

/* Global reset & shell layout */
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; height: 100%; }
body {
    font-family: "Inter", "PingFang SC", "Microsoft YaHei", sans-serif;
    background:
        radial-gradient(120% 140% at 18% 16%, color-mix(in srgb, var(--bg-glow-1) 26%, transparent), transparent 58%),
        radial-gradient(140% 140% at 84% 82%, color-mix(in srgb, var(--bg-glow-2) 34%, transparent), transparent 62%),
        linear-gradient(145deg, rgba(30,46,34,0.55), rgba(6,12,9,0.78)),
        var(--bg-base);
    color: var(--text-main);
    overflow: hidden;
}
body.chat-fullscreen {
    overflow: hidden;
}

body.orientation-blocked {
    overflow: hidden;
}
#orientation-lock {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    padding: calc(24px + env(safe-area-inset-top, 0px)) calc(20px + env(safe-area-inset-right, 0px)) calc(24px + env(safe-area-inset-bottom, 0px)) calc(20px + env(safe-area-inset-left, 0px));
    background: rgba(8,4,12,0.9);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 3000;
    text-align: center;
    color: #f6eefa;
}
#orientation-lock.show {
    display: flex;
}
#orientation-lock .orientation-card {
    border: 1px solid rgba(246,195,106,0.45);
    border-radius: 18px;
    padding: 16px 18px;
    background:
        linear-gradient(135deg, rgba(246,195,106,0.12), rgba(0,0,0,0.5)),
        rgba(12,8,14,0.85);
    box-shadow: 0 18px 46px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,255,255,0.08);
    max-width: 320px;
    width: 100%;
}
#orientation-lock .orientation-title {
    margin: 0 0 6px 0;
    letter-spacing: 0.08em;
    font-weight: 700;
}
#orientation-lock .orientation-copy {
    margin: 0;
    color: rgba(244,233,245,0.78);
    line-height: 1.5;
    font-size: 14px;
}
@media (min-width: 901px) {
    #orientation-lock { display: none !important; }
}
a { color: inherit; text-decoration: none; }
button {
    font: inherit;
    -webkit-user-select: none;
    user-select: none;
    white-space: nowrap;
}

/* Fallback: block bare UI by giving any unclassed controls the house style */
button:not(.ui-btn) {
    border: 1px solid color-mix(in srgb, var(--accent) 40%, transparent);
    border-radius: 12px;
    background: color-mix(in srgb, var(--accent) 14%, rgba(0,0,0,0.5));
    color: var(--text-main, #f7f1f9);
    padding: 8px 12px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.26);
    cursor: pointer;
}
input:not(.ui-input-field),
textarea:not(.ui-input-field) {
    border: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
    border-radius: 12px;
    background: color-mix(in srgb, var(--card-bg, rgba(255,255,255,0.05)) 90%, #000 10%);
    color: var(--text-main, #f7f1f9);
    padding: 10px 12px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
}
select {
    border: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
    border-radius: 12px;
    background: color-mix(in srgb, var(--card-bg, rgba(255,255,255,0.05)) 90%, #000 10%);
    color: var(--text-main, #f7f1f9);
    padding: 10px 12px;
}

:root {
    scrollbar-color: var(--ui-scroll-thumb, color-mix(in srgb, var(--accent) 40%, transparent)) var(--ui-scroll-track, rgba(255,255,255,0.04));
}
*::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}
*::-webkit-scrollbar-thumb {
    background: var(--ui-scroll-thumb, color-mix(in srgb, var(--accent) 40%, transparent));
    border-radius: 12px;
}
*::-webkit-scrollbar-track {
    background: var(--ui-scroll-track, rgba(255,255,255,0.04));
}

body.theme-day {
    --text-main: #161018;
    --card-bg: rgba(255,255,255,0.92);
    background:
        linear-gradient(160deg, rgba(255,255,255,0.3), rgba(255,255,255,0.05)),
        radial-gradient(140% 140% at 16% 12%, color-mix(in srgb, var(--bg-glow-1) 32%, transparent), transparent 60%),
        radial-gradient(120% 120% at 80% 90%, color-mix(in srgb, var(--bg-glow-2) 30%, transparent), transparent 60%),
        var(--bg-base, #f6efe3);
    color: var(--text-main);
}
body.theme-day textarea,
body.theme-day input,
body.theme-day .home-rule-inner label textarea,
body.theme-day .home-dialog-panel textarea {
    color: #161018;
}
body.theme-day .home-rule-inner label textarea::placeholder,
body.theme-day .home-dialog-panel textarea::placeholder {
    color: rgba(22,16,24,0.55);
}
body.theme-day #tab-bar {
    background: rgba(255,255,255,0.72);
    border-top-color: rgba(0,0,0,0.06);
    box-shadow: 0 -10px 24px rgba(0,0,0,0.08);
}
body.theme-day #tab-bar .tab-btn.active {
    color: var(--accent);
    border-top-color: var(--accent);
}

#app-shell {
    height: var(--viewport-height);
    min-height: var(--viewport-height);
    display: grid;
    grid-template-rows: 1fr auto;
}
#app-shell.fullscreen {
    grid-template-rows: 1fr;
}
#app-root {
    padding: 16px;
    padding-top: max(8px, env(safe-area-inset-top, 0px));
    padding-left: calc(16px + env(safe-area-inset-left, 0px) / 2);
    padding-right: calc(16px + env(safe-area-inset-right, 0px) / 2);
    padding-bottom: 8px;
    height: calc(var(--viewport-height) - (56px + env(safe-area-inset-bottom)));
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) rgba(255,255,255,0.08);
    scrollbar-gutter: stable both-edges;
}
#app-root.home-page,
#app-root.unlock-page {
    width: var(--page-max-width);
    max-width: 100%;
    margin: 0 auto;
    justify-self: center;
}
#app-root.unlock-page + #tab-bar {
    display: none;
}
#app-shell.fullscreen #app-root {
    padding: 0;
    height: var(--viewport-height);
    overflow: hidden;
}
#app-root::-webkit-scrollbar { width: 10px; }
#app-root::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
}
#app-root::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 60%, transparent), color-mix(in srgb, var(--bg-glow-2) 52%, transparent));
    border-radius: 10px;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
}
#app-root::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 76%, transparent), color-mix(in srgb, var(--bg-glow-2) 62%, transparent));
}

.save-toast {
    position: fixed;
    left: 50%;
    bottom: 28px;
    transform: translate(-50%, 20px);
    padding: 8px 14px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.72);
    border: 1px solid rgba(255, 255, 255, 0.18);
    color: var(--text-main);
    font-size: 12px;
    letter-spacing: 0.04em;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.35);
    opacity: 0;
    transition: transform 0.2s ease, opacity 0.2s ease;
    z-index: 1200;
}
.save-toast.ok {
    border-color: color-mix(in srgb, var(--accent) 70%, transparent);
    color: var(--accent);
}
.save-toast.fail {
    border-color: rgba(255, 120, 150, 0.65);
    color: #ff9cbc;
}
.save-toast.show {
    opacity: 1;
    transform: translate(-50%, 0);
}
.save-toast.hide {
    opacity: 0;
    transform: translate(-50%, 20px);
}
#tab-bar {
    position: fixed;
    inset: auto 0 0 0;
    height: calc(56px + env(safe-area-inset-bottom));
    padding-bottom: env(safe-area-inset-bottom);
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border-top: 0;
    background:
        linear-gradient(180deg, rgba(10,12,11,0.95), rgba(6,10,8,0.92)),
        radial-gradient(140% 90% at 50% -20%, color-mix(in srgb, var(--bg-glow-1) 22%, transparent), transparent 60%);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow:
        0 -1px 0 rgba(255,255,255,0.05),
        0 -12px 26px rgba(0,0,0,0.48);
    z-index: 15;
}
#app-shell.fullscreen #tab-bar {
    display: none;
}
#tab-bar .tab-btn {
    border: none;
    background: transparent;
    padding: 10px;
    color: rgba(244,233,245,0.82);
    cursor: pointer;
    position: relative;
}
#tab-bar .tab-btn::after {
    content: "";
    position: absolute;
    inset: auto 18% 6px 18%;
    height: 2px;
    border-radius: 999px;
    background: transparent;
    transition: all 0.2s ease;
    box-shadow: none;
}
#tab-bar .tab-btn.active {
    color: color-mix(in srgb, var(--accent) 88%, #ffe6b8);
    font-weight: 700;
}
#tab-bar .tab-btn.active::after {
    height: 3px;
    inset: auto 14% 6px 14%;
    background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 80%, #f6c36a), color-mix(in srgb, var(--accent) 70%, #d9b673));
    box-shadow: 0 0 18px rgba(246,195,106,0.35), 0 0 1px rgba(255,255,255,0.4);
}

.primary {
    border-radius: 12px;
    border: 1px solid color-mix(in srgb, var(--accent) 60%, transparent);
    background: color-mix(in srgb, var(--accent) 16%, transparent);
    color: var(--accent);
    padding: 10px 14px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.18s ease;
}
.ghost {
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.06);
    color: inherit;
    padding: 8px 12px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.18s ease;
}
.ghost-compact {
    padding: 6px 10px;
    font-size: 12px;
}
.primary:hover,
.ghost:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.25);
}
.primary:active,
.ghost:active {
    transform: translateY(1px);
}
.empty {
    color: rgba(244,233,245,0.6);
}

/* Call transcript fold */
.story-bubble .bubble-fold {
    width: min(90%, 520px);
    margin: 4px auto 12px;
    background:
        linear-gradient(135deg, rgba(246, 195, 106, 0.12), rgba(60, 16, 34, 0.35)),
        rgba(16, 8, 16, 0.72);
    border: 1px solid rgba(246, 195, 106, 0.26);
    border-radius: 14px;
    overflow: hidden;
    box-shadow:
        0 10px 26px rgba(0, 0, 0, 0.5),
        0 0 18px rgba(246, 195, 106, 0.12);
    position: relative;
}
.story-bubble .bubble-fold::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(120% 120% at 30% 0%, rgba(255, 255, 255, 0.08), transparent 55%);
    pointer-events: none;
}
.story-bubble .bubble-fold .fold-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 10px 12px;
    color: #fbe7cf;
    font-weight: 700;
    letter-spacing: 0.06em;
}
.story-bubble .bubble-fold .fold-title {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    position: relative;
}
.story-bubble .bubble-fold .fold-title::before {
    content: "✉";
    font-size: 12px;
    opacity: 0.8;
}
.story-bubble .bubble-fold .fold-toggle {
    border: 1px solid rgba(246, 195, 106, 0.5);
    background: rgba(246, 195, 106, 0.12);
    color: #f6c36a;
    border-radius: 10px;
    padding: 6px 10px;
    font-size: 12px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.2s ease;
}
.story-bubble .bubble-fold .fold-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35);
}
.story-bubble .bubble-fold .fold-body {
    max-height: 0;
    overflow: hidden;
    padding: 0 12px;
    transition: max-height 0.25s ease, padding 0.2s ease;
    border-top: 1px dashed rgba(246, 195, 106, 0.28);
    background: rgba(8, 4, 10, 0.55);
}
.story-bubble .bubble-fold.open .fold-body {
    padding: 12px 14px 14px;
}
.story-bubble .bubble-fold .fold-body p {
    margin: 6px 0;
    color: #f5ecff;
    text-align: left;
}

/* Setup Assistant prompt */
.setup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    z-index: 1200;
}
.setup-dialog {
    width: min(440px, 90vw);
    background:
        linear-gradient(135deg, rgba(246,195,106,0.1), rgba(60,16,34,0.28)),
        rgba(12,8,14,0.92);
    border: 1px solid rgba(246,195,106,0.35);
    border-radius: 16px;
    box-shadow: 0 18px 36px rgba(0,0,0,0.55);
    padding: 14px;
    display: grid;
    gap: 10px;
}
.setup-dialog h4 {
    margin: 0;
    font-size: 16px;
    letter-spacing: 0.06em;
}
.setup-dialog p {
    margin: 0;
    color: rgba(244,233,245,0.78);
    font-size: 13px;
}
.setup-dialog textarea,
.setup-dialog input {
    width: 100%;
    border-radius: 12px;
    border: 1px solid rgba(246,195,106,0.35);
    background: rgba(0,0,0,0.4);
    color: #f6eefa;
    padding: 10px;
    font: inherit;
    min-height: 80px;
    resize: vertical;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}
.setup-dialog .dialog-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
}
.setup-dialog button {
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: #f6eefa;
    cursor: pointer;
}
.setup-dialog button.primary {
    border-color: rgba(246,195,106,0.6);
    background: color-mix(in srgb, var(--accent) 18%, rgba(0,0,0,0.55));
    color: var(--accent);
}
.setup-dialog button:focus {
    outline: 2px solid color-mix(in srgb, var(--accent) 35%, transparent);
}

/* Initializer */
button.init-bubble-btn {
    position: absolute;
    left: 12px;
    bottom: 18px;
    z-index: 20;
    padding: 10px 14px;
    border-radius: 16px;
    border: 1px solid rgba(246,195,106,0.45);
    background:
        linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.4)),
        rgba(10,6,12,0.9);
    color: var(--accent);
    box-shadow: 0 12px 28px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font: inherit;
    text-shadow: 0 1px 2px rgba(0,0,0,0.45);
}
button.init-bubble-btn::before {
    content: "◉";
    font-size: 12px;
    opacity: 0.85;
    animation: pulse 1.4s ease-in-out infinite;
}
button.init-bubble-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
.initializer-overlay {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: var(--viewport-height);
    min-height: var(--viewport-height);
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    z-index: 2000;
}
.initializer-dialog {
    width: min(480px, 92vw);
    background:
        linear-gradient(140deg, rgba(255,255,255,0.05), rgba(0,0,0,0.35)),
        rgba(12,8,14,0.92);
    border: 1px solid rgba(246,195,106,0.4);
    border-radius: 16px;
    box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    padding: 16px;
    display: grid;
    gap: 12px;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    max-width: 520px;
    width: min(520px, 92vw);
    border: 1px solid rgba(246,195,106,0.5);
}
.initializer-dialog .init-anim {
    font-size: 14px;
    color: var(--accent);
    letter-spacing: 0.08em;
    display: flex;
    align-items: center;
    gap: 6px;
}
.initializer-dialog .init-icon {
    font-size: 18px;
}
.init-spinner {
    display: inline-flex;
    gap: 6px;
    align-items: center;
}
.init-spinner span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0.45;
    animation: initPulse 1.1s ease-in-out infinite;
}
.init-spinner span:nth-child(2) { animation-delay: 0.12s; }
.init-spinner span:nth-child(3) { animation-delay: 0.24s; }
@keyframes initPulse {
    0%, 100% { transform: translateY(0); opacity: 0.35; }
    50% { transform: translateY(-4px); opacity: 0.95; }
}
.initializer-dialog p {
    margin: 0;
    color: rgba(244,233,245,0.8);
    font: inherit;
}
.initializer-dialog .init-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
}
.initializer-overlay .initializer-dialog button {
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid rgba(246,195,106,0.45);
    background:
        linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.35)),
        rgba(0,0,0,0.4);
    color: var(--accent);
    cursor: pointer;
    box-shadow: 0 10px 20px rgba(0,0,0,0.35);
    font: inherit;
    text-shadow: 0 1px 2px rgba(0,0,0,0.45);
}
.initializer-overlay .initializer-dialog button.primary {
    border-color: rgba(246,195,106,0.7);
    background:
        linear-gradient(135deg, rgba(246,195,106,0.22), rgba(0,0,0,0.2)),
        rgba(20,12,20,0.8);
    color: var(--accent);
}

.init-controls-floating {
    position: absolute;
    right: 16px;
    bottom: 18px;
    display: flex;
    gap: 8px;
    z-index: 19;
    pointer-events: none;
}
.init-controls-floating button {
    pointer-events: auto;
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.35);
    color: #f6eefa;
    cursor: pointer;
    box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    font: inherit;
    text-shadow: 0 1px 2px rgba(0,0,0,0.45);
}
.init-controls-floating button.primary {
    border-color: rgba(246,195,106,0.5);
    color: var(--accent);
    background:
        linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.35)),
        rgba(0,0,0,0.4);
}

/* Force themed buttons for initializer layers */
.initializer-overlay button,
.init-controls-floating button,
button.init-bubble-btn {
    background: linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.4)), rgba(10,6,12,0.9) !important;
    border: 1px solid rgba(246,195,106,0.55) !important;
    color: var(--accent) !important;
    border-radius: 14px !important;
    font: inherit !important;
}
.initializer-overlay button.ghost,
.init-controls-floating button.ghost {
    background: rgba(0,0,0,0.3) !important;
    border-color: rgba(255,255,255,0.25) !important;
    color: #f6eefa !important;
}
.initializer-dialog .init-message[data-tone="error"] { color: #ffbebe; }
.initializer-dialog .init-message[data-tone="success"] { color: #c6ffa1; }
.initializer-dialog .init-message[data-tone="info"] { color: rgba(244,233,245,0.8); }

/* Initializer bubbles embedded in story log */
.initializer-bubbles {
    display: grid;
    gap: 4px;
    margin: 6px;
    max-width: min(520px, calc(100vw - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 4px));
    align-items: flex-start;
    margin-top: 10px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}
.initializer-bubbles .bubble-init {
    width: min(520px, 100%);
    max-width: 100%;
    border: 1px solid rgba(246,195,106,0.5);
    background: linear-gradient(145deg, rgba(29,16,28,0.9), rgba(6,4,8,0.75));
    box-shadow: 0 16px 40px rgba(0,0,0,0.45), 0 0 0 1px rgba(255,255,255,0.05);
    padding: 0px 0px;
    border-radius: 14px;
}
.initializer-bubbles .bubble-init.status .bubble-main-text { display: grid; gap: 6px; }
.initializer-bubbles .bubble-init.actions .bubble-content { padding: 0px 0px; }
.initializer-bubbles .bubble-init .bubble-content {
    padding: 0px 0px;
}
.initializer-bubbles .bubble-init .init-actions {
    display: flex;
    gap: 8px;
    padding: 2px 0;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
}
.initializer-bubbles .bubble-init .init-chip {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
    background: linear-gradient(135deg, rgba(246,195,106,0.18), rgba(0,0,0,0.5));
    border: 1px solid rgba(246,195,106,0.65);
    color: var(--accent);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 10px 18px rgba(0,0,0,0.4);
}
.initializer-bubbles .bubble-init .init-actions .init-chip {
    padding: 10px 14px;
    border-radius: 18px;
    border: 1px solid rgba(246,195,106,0.55);
    background: linear-gradient(135deg, rgba(246,195,106,0.16), rgba(0,0,0,0.45));
    color: var(--accent);
    cursor: pointer;
    font: inherit;
    text-shadow: 0 1px 2px rgba(0,0,0,0.35);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 10px 18px rgba(0,0,0,0.4);
    min-width: 0;
    flex: 1 1 140px;
    max-width: 100%;
    white-space: normal;
    text-align: center;
}
.initializer-bubbles .bubble-init .init-actions .init-chip.ghost {
    border-color: rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.35);
    color: #f6eefa;
    box-shadow: 0 10px 18px rgba(0,0,0,0.35);
}
.initializer-bubbles .bubble-init .init-message[data-tone="error"] { color: #ffbebe; }
.initializer-bubbles .bubble-init .init-message[data-tone="success"] { color: #c6ffa1; }
.initializer-bubbles .bubble-init .init-message[data-tone="info"] { color: rgba(244,233,245,0.9); }

@media (max-width: 640px) {
    .initializer-bubbles {
        grid-template-columns: 1fr;
        gap: 6px;
        max-width: min(520px, 94vw);
    }
    .initializer-bubbles .bubble-init {
        width: 100%;
        max-width: 100%;
    }
}

/* Wallet extras */

/* Home */
.home-page { display: grid; gap: 14px; position: relative; padding-top: 6px; }
.home-page > :not(.home-stars) { position: relative; z-index: 2; }
.home-stars {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    opacity: 0.35;
    mix-blend-mode: screen;
}
.home-topbar {
    position: sticky;
    top: 0;
    z-index: 6;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 14px 16px;
    margin-bottom: 10px;
    background:
        linear-gradient(145deg, rgba(255,255,255,0.06), rgba(0,0,0,0.22)),
        radial-gradient(120% 120% at 12% 16%, color-mix(in srgb, var(--bg-glow-1) 18%, transparent), transparent 60%),
        radial-gradient(140% 120% at 82% 12%, color-mix(in srgb, var(--bg-glow-2) 18%, transparent), transparent 62%),
        rgba(12,18,12,0.82);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;
    box-shadow: 0 16px 40px rgba(0,0,0,0.55);
}
.home-topbar-left { display: grid; gap: 6px; }
.home-topbar h2 { margin: 0; letter-spacing: 0.08em; font-size: 28px; }
.home-topbar-status { color: rgba(244,233,245,0.76); font-size: 14px; }
.home-global-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.06);
    background:
        linear-gradient(145deg, rgba(255,255,255,0.04), rgba(0,0,0,0.18)),
        radial-gradient(140% 120% at 12% 40%, color-mix(in srgb, var(--bg-glow-1) 16%, transparent), transparent 62%),
        rgba(10,16,12,0.78);
}
.home-global-text { color: rgba(244,233,245,0.82); }
.home-global-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.home-hero {
    padding: 18px;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 18px;
    background:
        linear-gradient(160deg, rgba(255,255,255,0.05), rgba(0,0,0,0.28)),
        radial-gradient(140% 120% at 18% 18%, color-mix(in srgb, var(--bg-glow-1) 18%, transparent), transparent 60%),
        radial-gradient(120% 120% at 82% 22%, color-mix(in srgb, var(--bg-glow-2) 18%, transparent), transparent 62%),
        rgba(10,14,10,0.9);
    box-shadow: 0 18px 44px rgba(0,0,0,0.55);
    position: relative;
    overflow: visible;
}
.home-hero::after {
    content: "";
    position: absolute;
    inset: 6px;
    border-radius: 16px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.2));
    pointer-events: none;
}
.home-kicker { letter-spacing: 0.1em; color: rgba(244,233,245,0.6); margin: 0; }
.home-kicker,
.home-hero h1,
.home-sub { line-height: 1.4; }
.home-hero h1 { margin: 4px 0; letter-spacing: 0.08em; }
.home-title-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.home-badges { display: flex; gap: 6px; align-items: center; }
.home-sub { margin: 4px 0 10px 0; color: rgba(244,233,245,0.75); }
.home-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.home-rules-preview { margin: 6px 0 0 0; color: rgba(244,233,245,0.65); }
.home-dialog { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 40; }
.home-dialog.show { display: flex; }
.home-dialog-mask { position: absolute; inset: 0; background: rgba(0,0,0,0.6); }
.home-dialog-panel {
    position: relative;
    width: min(520px, 92%);
    background: rgba(12,8,12,0.92);
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 18px 50px rgba(0,0,0,0.6);
    display: grid;
    gap: 10px;
}
.home-dialog-label { display: grid; gap: 6px; color: rgba(244,233,245,0.9); }
.home-dialog-panel textarea,
.home-dialog-panel input,
.home-dialog-panel select {
    width: 100%;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.2);
    background:
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)),
        rgba(0,0,0,0.32);
    color: #f4e9f5;
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 6px 14px rgba(0,0,0,0.35);
}
.home-dialog-panel select { cursor: pointer; }
.home-dialog-note { color: rgba(244,233,245,0.7); margin: 0; }
.home-dialog-actions { display: flex; gap: 8px; justify-content: flex-end; }
.home-rule-drawer {
    display: none;
    margin: 8px 0 12px;
}
.home-rule-drawer.show {
    display: block;
}
.home-rule-inner {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 14px;
    background:
        linear-gradient(140deg, rgba(255,255,255,0.04), rgba(0,0,0,0.28)),
        rgba(12,8,12,0.8);
    box-shadow: 0 14px 32px rgba(0,0,0,0.5);
    display: grid;
    gap: 10px;
}
.home-rule-inner label textarea,
.home-rule-inner label input,
.home-rule-inner label select {
    border: 1px solid rgba(246,195,106,0.25);
    border-radius: 12px;
    background:
        radial-gradient(120% 120% at 10% 10%, rgba(255,255,255,0.04), transparent 60%),
        rgba(0,0,0,0.35);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
    color: #f4e9f5;
}
.home-rule-inner label select { cursor: pointer; }
.home-rule-inner label textarea:focus,
.home-rule-inner label input:focus,
.home-rule-inner label select:focus {
    outline: 2px solid color-mix(in srgb, var(--accent) 40%, transparent);
    box-shadow:
        0 0 0 1px rgba(246,195,106,0.4),
        0 12px 26px rgba(0,0,0,0.4);
}
.home-rule-inner label textarea::placeholder {
    color: rgba(244,233,245,0.6);
    letter-spacing: 0.04em;
}
.home-dialog-panel select,
.home-rule-inner label select,
.role-detail-form select,
.persona-card select,
.character-sheet .card-form select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    padding-right: 44px;
    background-image:
        linear-gradient(45deg, transparent 50%, rgba(244,233,245,0.9) 50%),
        linear-gradient(135deg, rgba(244,233,245,0.9) 50%, transparent 50%),
        linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.08));
    background-position:
        right 16px center,
        right 10px center,
        right 34px center;
    background-size: 8px 8px, 8px 8px, 1px 60%;
    background-repeat: no-repeat;
}
.pill-select {
    border-color: color-mix(in srgb, var(--accent) 35%, transparent);
    background:
        linear-gradient(180deg, rgba(246,195,106,0.12), rgba(0,0,0,0.18)),
        rgba(0,0,0,0.2);
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.05),
        0 8px 18px rgba(0,0,0,0.35);
}
.pill-select:focus {
    border-color: color-mix(in srgb, var(--accent) 55%, transparent);
    box-shadow:
        0 0 0 1px rgba(246,195,106,0.45),
        0 12px 28px rgba(0,0,0,0.45);
}
.pill-select option {
    background: #0c0810;
    color: #f4e9f5;
}
.character-sheet .card-form textarea::-webkit-scrollbar,
.role-detail-form textarea::-webkit-scrollbar,
.home-rule-inner textarea::-webkit-scrollbar {
    width: 10px;
}
.character-sheet .card-form textarea::-webkit-scrollbar-thumb,
.role-detail-form textarea::-webkit-scrollbar-thumb,
.home-rule-inner textarea::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, rgba(246,195,106,0.5), rgba(90,110,180,0.4));
    border-radius: 10px;
}
.character-sheet .card-form textarea::-webkit-scrollbar-track,
.role-detail-form textarea::-webkit-scrollbar-track,
.home-rule-inner textarea::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.06);
    border-radius: 10px;
}
.character-sheet .card-form textarea {
    scrollbar-width: none;
}
.character-sheet .card-form textarea::-webkit-scrollbar {
    width: 0;
    height: 0;
}
.character-sheet .sheet-body.ui-modal-body {
    overflow-x: hidden;
    scrollbar-width: thin;
    padding-right: 10px;
}
.character-sheet .sheet-body.ui-modal-body::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}
.character-sheet .sheet-body.ui-modal-body::-webkit-scrollbar-thumb {
    background: color-mix(in srgb, var(--accent) 45%, transparent);
    border-radius: 999px;
}
.character-sheet .sheet-body.ui-modal-body::-webkit-scrollbar-track {
    background: transparent;
}
.character-sheet .sheet-body.ui-modal-body .sheet-grid {
    min-width: 0;
    width: 100%;
}
.character-sheet input[type="range"],
.role-detail-form input[type="range"],
.home-rule-inner input[type="range"],
.home-dialog-panel input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 10px;
    border-radius: 999px;
    background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 50%, transparent), rgba(255,255,255,0.08));
    outline: none;
}
.character-sheet input[type="range"]::-webkit-slider-thumb,
.role-detail-form input[type="range"]::-webkit-slider-thumb,
.home-rule-inner input[type="range"]::-webkit-slider-thumb,
.home-dialog-panel input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(246,195,106,0.9));
    box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.2);
}
.character-sheet input[type="range"]::-moz-range-thumb,
.role-detail-form input[type="range"]::-moz-range-thumb,
.home-rule-inner input[type="range"]::-moz-range-thumb,
.home-dialog-panel input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(246,195,106,0.9));
    box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.2);
}
.home-rule-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}
.home-rule-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.home-gallery {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 14px;
    background:
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.32)),
        radial-gradient(150% 120% at 78% 18%, color-mix(in srgb, var(--bg-glow-2) 18%, transparent), transparent 60%),
        radial-gradient(140% 140% at 14% 82%, color-mix(in srgb, var(--bg-glow-1) 12%, transparent), transparent 58%),
        rgba(8,12,10,0.78);
    box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    display: grid;
    gap: 12px;
}
.home-gallery-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
.home-masonry { column-count: 2; column-gap: 12px; }
@media (min-width: 880px) {
    .home-masonry { column-count: 3; }
}
.home-card {
    break-inside: avoid;
    margin-bottom: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    box-shadow: 0 12px 28px rgba(0,0,0,0.5);
    overflow: hidden;
    display: grid;
    gap: 10px;
}
.home-card-upload { position: relative; display: block; }
.home-card-upload input {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
}
.upload-frame {
    position: relative;
    width: 100%;
    aspect-ratio: 16 / 9;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    background:
        linear-gradient(135deg, color-mix(in srgb, var(--accent) 24%, transparent), color-mix(in srgb, var(--bg-glow-2) 18%, transparent)),
        radial-gradient(140% 120% at 82% 82%, rgba(255,255,255,0.08), transparent 60%),
        rgba(10,14,12,0.78);
    display: flex;
    align-items: flex-end;
    padding: 12px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.upload-frame::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(0,0,0,0) 30%, rgba(0,0,0,0.48) 100%);
    pointer-events: none;
    opacity: 0.8;
}
.upload-frame[data-has-image="1"] {
    background-size: cover;
    background-position: center;
}
.upload-frame:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(0,0,0,0.38);
}
.upload-hint {
    position: relative;
    z-index: 1;
    background: rgba(0,0,0,0.45);
    border: 1px solid rgba(255,255,255,0.18);
    border-radius: 10px;
    padding: 6px 10px;
    font-size: 12px;
    letter-spacing: 0.08em;
    color: var(--accent);
}
.home-card-body { padding: 0 12px 12px; display: grid; gap: 6px; }
.home-card-name-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.home-card-name { font-weight: 700; letter-spacing: 0.04em; }
.home-card-tag {
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(244,233,245,0.9);
}
.home-card-tag.is-placeholder {
    border-color: rgba(246,195,106,0.4);
    color: var(--accent);
    background: rgba(246,195,106,0.12);
}
.home-card-preview { margin: 0; color: rgba(244,233,245,0.72); line-height: 1.5; }

/* Messages */
.messages-page {
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 10px;
    position: relative;
    min-height: calc(var(--viewport-height) - 56px);
    height: calc(var(--viewport-height) - 56px - env(safe-area-inset-bottom));
    overflow: hidden;
    padding-top: 0;
}
.msg-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
}
.msg-header h2 { margin: 0; letter-spacing: 0.08em; }
.msg-topbar {
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    z-index: 12;
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(260px, 520px) auto;
    align-items: center;
    gap: 12px;
    padding: 12px;
    min-height: 72px;
    height: 165px;
    border-radius: 14px;
    width: 100%;
    background:
        linear-gradient(145deg, rgba(0,0,0,0.3), rgba(0,0,0,0.4)),
        rgba(8,5,10,0.94);
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow:
        0 18px 42px rgba(0,0,0,0.65),
        0 12px 18px rgba(0,0,0,0.4);
    position: relative;
    margin-bottom: 0;
}
.msg-top-left {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
    flex: 0 0 auto;
    flex-shrink: 0;
}
.msg-header h2 { white-space: nowrap; margin: 0; }
.msg-top-actions {
    justify-self: end;
    width: 100%;
    max-width: 520px;
    min-width: 220px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.msg-title-row { margin-top: 4px; }
.msg-search {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.14);
    background:
        linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.28)),
        rgba(0,0,0,0.28);
    min-width: 0;
    width: 100%;
}
.msg-count {
    justify-self: end;
    align-self: center;
    white-space: nowrap;
}
.messages-scroll {
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 0 0 80px 0;
}
.msg-list { padding-top: 8px; }
@media (max-width: 900px) {
    .msg-topbar {
        grid-template-columns: 1fr;
        align-items: flex-start;
    }
    .msg-top-actions {
        max-width: none;
        min-width: 0;
        justify-self: stretch;
    }
    .msg-count {
        justify-self: start;
    }
}
.msg-kicker { margin: 0; letter-spacing: 0.12em; color: rgba(244,233,245,0.6); font-size: 12px; }
.msg-title-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.msg-title-row h2 { margin: 0; letter-spacing: 0.06em; }
.msg-count {
    padding: 4px 8px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    font-size: 12px;
    color: rgba(244,233,245,0.85);
}
.msg-search input {
    border: none;
    background: transparent;
    color: inherit;
    width: 100%;
    outline: none;
}
.msg-search-icon { opacity: 0.7; }
.msg-list {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}
.msg-card,
.role-card {
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    padding: 12px;
    background:
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.16)),
        radial-gradient(120% 120% at 16% 12%, color-mix(in srgb, var(--accent) 12%, transparent), transparent 65%),
        rgba(14,10,16,0.7);
    box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    display: grid;
    gap: 8px;
    position: relative;
    overflow: hidden;
    min-height: 0;
    transition: transform 0.16s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    max-height: 280px;
    align-self: start;
}
.msg-card::after,
.role-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.4));
    pointer-events: none;
}
.home-card.pressed,
.msg-card.pressed,
.role-card.pressed,
.settings-card.pressed,
.upload-frame.pressed {
    transform: translateY(1px) scale(0.99);
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
}
.msg-card {
    cursor: pointer;
}
.msg-card:hover,
.role-card:hover {
    transform: translateY(-2px);
    border-color: color-mix(in srgb, var(--accent) 45%, transparent);
    box-shadow: 0 16px 36px rgba(0,0,0,0.45);
}
.msg-head {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 8px;
    row-gap: 6px;
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
}
.msg-role {
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    min-width: 0;
}
.msg-role-name { display: inline-flex; align-items: center; }
.msg-title-wrap {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    min-width: 0;
}
.msg-title-display { max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.msg-title {
    padding: 5px 9px;
    border-radius: 10px;
    font-size: 12px;
}
.msg-time {
    font-size: 12px;
    color: rgba(244,233,245,0.7);
}
.msg-preview-row {
    display: flex;
    align-items: flex-start;
    gap: 10px;
}
.msg-preview-row .msg-preview { flex: 1; min-width: 0; }
.msg-preview-row .msg-time { margin-left: auto; white-space: nowrap; }
.msg-head-actions { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
.msg-turns {
    padding: 4px 8px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(0,0,0,0.2);
    font-size: 12px;
    color: rgba(244,233,245,0.8);
}
.msg-title-input {
    padding: 5px 9px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.3);
    color: #f4e9f5;
    min-width: 60px;
    width: auto;
    max-width: 200px;
}
.msg-preview {
    margin: 0;
    color: rgba(244,233,245,0.78);
    line-height: 1.5;
    position: relative;
    z-index: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
.msg-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.msg-card.hidden { display: none; }
.msg-back-top {
    position: fixed;
    right: 18px;
    bottom: calc(110px + env(safe-area-inset-bottom));
    padding: 10px 14px;
    border-radius: 12px;
    border: 1px solid color-mix(in srgb, var(--accent) 60%, transparent);
    background: rgba(0,0,0,0.65);
    color: var(--accent);
    box-shadow: 0 14px 30px rgba(0,0,0,0.5);
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
}
.msg-confirm {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
}
.msg-confirm.show { display: flex; }
.msg-confirm-mask {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.75);
}
.msg-confirm-panel {
    position: relative;
    width: min(400px, 90%);
    border-radius: 16px;
    background: rgba(14,10,16,0.9);
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 18px 46px rgba(0,0,0,0.6);
    padding: 16px;
    display: grid;
    gap: 10px;
}
.msg-confirm-actions { display: flex; gap: 8px; justify-content: flex-end; }
.msg-back-top.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(-2px);
}

/* Chat */
.chat-page {
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0;
    height: var(--viewport-height);
    overflow: hidden;
}
.legacy-chat-shell {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.25s ease, transform 0.25s ease;
    will-change: opacity, transform;
    overflow: hidden;
}
.chat-single {
    flex: 1;
    display: flex;
    min-height: 0;
}
.legacy-chat-shell.chat-enter {
    opacity: 1;
    transform: translateY(0);
}
.legacy-chat-shell:not(.chat-enter) .legacy-chat-frame {
    pointer-events: none;
}
.chat-floating-head {
    position: absolute;
    top: 10px;
    left: 12px;
    transform: translateX(0);
    display: flex;
    justify-content: flex-start;
    width: auto;
    z-index: 4;
    pointer-events: auto;
    transition: transform 0.25s ease, opacity 0.25s ease;
    z-index: 20;
    overflow: visible;
}
.chat-floating-head::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 100%;
    width: 30px;
    pointer-events: none;
}
.chat-head-main {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 16px;
    background: rgba(0,0,0,0.28);
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 14px 32px rgba(0,0,0,0.45);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    pointer-events: auto;
}
.chat-floating-head.collapsed {
    transform: translate(calc(-100% - 16px), 0) scale(0.98);
    opacity: 1;
}
.chat-floating-head.collapsed::before {
    pointer-events: auto;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 0px;
    color: var(--accent);
    font-weight: 700;
    letter-spacing: 0.06em;
    content: "<";
    background: linear-gradient(
        90deg,
        transparent 0%,
        transparent calc(100% - 20px),
        var(--accent) calc(100% - 10px),
        var(--accent) 100%
    );
    border-radius: 0 12px 12px 0;
}
.chat-floating-head.collapsed .chat-head-main {
    opacity: 1;
    cursor: pointer;
}
.chat-floating-head.collapsed .pill-text {
    opacity: 0;
    width: 0;
    overflow: hidden;
}
.chat-floating-head:hover,
.chat-floating-head:focus-within {
    transform: translate(0,0);
    opacity: 1;
}
.chat-head-divider {
    width: 1px;
    height: 28px;
    background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
    opacity: 0.8;
}
.chat-head-subtitle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: rgba(244,233,245,0.82);
    font-size: 12px;
    letter-spacing: 0.08em;
    white-space: nowrap;
    max-width: min(320px, 42vw);
    overflow: hidden;
    text-overflow: ellipsis;
    pointer-events: none;
}
.chat-head-sub-label {
    padding: 3px 6px;
    border-radius: 8px;
    border: 1px solid rgba(246,195,106,0.4);
    background: rgba(246,195,106,0.12);
    color: var(--accent);
    font-size: 11px;
    letter-spacing: 0.06em;
}
.chat-head-sub-text {
    opacity: 0.9;
}
.chat-edge-strip {
    display: none;
}
.chat-head-pill {
    pointer-events: auto;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 14px;
    background: rgba(0,0,0,0.15);
    color: #f4e9f5;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    transition: border 0.18s ease, transform 0.18s ease, background 0.18s ease;
    white-space: nowrap;
    position: relative;
}
.chat-head-pill::after {
    content: "";
    position: absolute;
    top: -1px;
    bottom: -1px;
    left: 100%;
    width: 14px;
    background: rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.14);
    border-left: 0;
    border-radius: 0 14px 14px 0;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    opacity: 0;
    transition: opacity 0.25s ease;
    pointer-events: none;
}
.chat-floating-head.collapsed .chat-head-pill::after {
    opacity: 1;
    width: calc(14px + 1ch);
}
.chat-head-pill::before {
    content: "";
    position: absolute;
    left: 10px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: color-mix(in srgb, var(--accent) 70%, transparent);
    box-shadow: 0 0 0 2px rgba(0,0,0,0.35);
    opacity: 0;
    transition: opacity 0.18s ease;
}
.chat-floating-head.collapsed .chat-head-pill::before {
    opacity: 1;
}
.chat-head-pill:hover {
    border-color: rgba(255,200,150,0.5);
    background: rgba(255,255,255,0.08);
    transform: translateY(-1px);
}
.chat-head-pill .pill-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: center;
    white-space: nowrap;
}
.chat-head-pill .pill-role {
    font-weight: 700;
    font-size: 14px;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 3ch;
    padding: 0 2px;
}
.chat-head-pill .pill-role-text {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-width: 2ch;
    white-space: nowrap;
    text-align: center;
    transition: opacity 0.15s ease;
}
.chat-head-pill .pill-role-exit {
    position: absolute;
    inset: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-width: 3ch;
    padding: 0 2px;
    text-align: center;
    opacity: 0;
    transition: opacity 0.15s ease;
}
.chat-head-pill:hover .pill-role-text,
.chat-head-pill:focus-visible .pill-role-text,
.chat-head-pill.show-exit .pill-role-text {
    opacity: 0;
}
.chat-head-pill:hover .pill-role-exit,
.chat-head-pill:focus-visible .pill-role-exit,
.chat-head-pill.show-exit .pill-role-exit {
    opacity: 1;
}
.legacy-chat-frame {
    flex: 1;
    width: 100%;
    border: none;
    border-radius: 0;
    background: #05010a;
    min-height: 0;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.28s ease, visibility 0s linear 0.28s;
}
.legacy-chat-frame.is-ready {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.28s ease;
}


/* Roles */
.roles-page {
    display: grid;
    gap: 12px;
    padding: 12px 6px calc(12px + env(safe-area-inset-bottom));
    border-radius: 14px;
    background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));
    border: 1px solid rgba(255,255,255,0.05);
    max-height: none;
    overflow: visible;
    scrollbar-width: none;
}
.roles-page::-webkit-scrollbar { display: none; }
.roles-head {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    padding: 6px 6px 8px;
    min-height: 72px;
    height: 90px;
    background:
        linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.4)),
        rgba(8,5,10,0.94);
    border-bottom: 1px solid rgba(255,255,255,0.12);
    z-index: 6;
    margin-bottom: 10px;
}
.roles-kicker { letter-spacing: 0.08em; color: rgba(244,233,245,0.65); margin: 0; text-transform: uppercase; font-size: 12px; }
.role-list { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
.role-card { cursor: pointer; }
.role-head { display: flex; justify-content: space-between; gap: 8px; align-items: flex-start; flex-wrap: wrap; row-gap: 6px; }
.role-head-text { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
.role-name { font-weight: 700; }
.role-meta { margin: 2px 0 0 0; color: rgba(244,233,245,0.6); font-size: 13px; }
.role-bio {
    margin: 0;
    color: rgba(244,233,245,0.78);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
.role-actions { display: flex; gap: 6px; flex-wrap: wrap; justify-content: flex-end; }
.role-actions button:disabled { opacity: 0.5; cursor: not-allowed; }
.role-confirm { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 30; }
.role-confirm.show { display: flex; }
.role-confirm-mask { position: absolute; inset: 0; background: rgba(0,0,0,0.7); }
.role-confirm-panel { position: relative; width: min(420px, 90%); background: rgba(12,8,12,0.94); border: 1px solid rgba(255,255,255,0.16); border-radius: 16px; padding: 14px; box-shadow: 0 18px 40px rgba(0,0,0,0.6); display: grid; gap: 10px; }
.role-confirm-actions { display: flex; gap: 8px; justify-content: flex-end; }
.role-detail-page { display: grid; gap: 10px; justify-items: center; padding: 4px 6px 12px; }
.role-detail-form {
    max-width: min(1180px, calc(100vw - 14px));
    width: 100%;
    display: grid;
    gap: 12px;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: clamp(12px, 2vw, 18px);
    padding-bottom: 90px;
    background:
        linear-gradient(145deg, rgba(255,255,255,0.04), rgba(0,0,0,0.28)),
        rgba(14,10,16,0.82);
    box-shadow: 0 14px 36px rgba(0,0,0,0.5);
}
.role-detail-shell { display: grid; gap: 12px; }
.role-detail-head {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    justify-content: flex-start;
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    padding: 8px 6px;
    border-radius: 14px;
    background:
        linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.2)),
        rgba(10,6,12,0.65);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 6;
    margin-bottom: 10px;
}
.role-detail-sub { margin: 4px 0 0; color: rgba(244,233,245,0.7); }
.role-detail-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}
.role-detail-form .role-card {
    cursor: default;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    padding: 12px;
    background:
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2)),
        radial-gradient(140% 120% at 82% 12%, color-mix(in srgb, var(--accent) 10%, transparent), transparent 60%),
        rgba(14,10,16,0.78);
    box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    display: grid;
    gap: 10px;
    max-height: none;
    overflow: visible;
}
.role-detail-form .role-card-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}
.role-detail-form .role-card-note { margin: 0; color: rgba(244,233,245,0.7); font-size: 12px; }
.role-detail-form .role-card-actions { display: flex; gap: 8px; justify-content: flex-end; }
.role-detail-form .role-field-grid { display: grid; gap: 10px; }
.role-detail-form .role-field-grid.grid-two { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
.role-detail-form .role-card label { display: grid; gap: 6px; color: rgba(244,233,245,0.9); }
.role-detail-form .role-card input,
.role-detail-form .role-card textarea,
.role-detail-form .role-card select {
    width: 100%;
    font: inherit;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--accent) 38%, transparent);
    background:
        linear-gradient(180deg, rgba(246,195,106,0.08), rgba(0,0,0,0.4)),
        rgba(0,0,0,0.32);
    color: #f4e9f5;
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.04),
        0 6px 14px rgba(0,0,0,0.3);
}
.role-detail-form .role-card textarea { min-height: 96px; }
.role-detail-actions {
    position: sticky;
    bottom: 10px;
    padding: 10px 12px 4px;
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    align-self: flex-end;
    justify-self: flex-end;
    width: max-content;
    max-width: 100%;
    background:
        linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.55));
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    border-radius: 12px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.35);
}
.role-detail-note { margin: 0; font-size: 12px; color: rgba(244,233,245,0.7); }
.role-required-hint { color: #f66; font-size: 12px; display: inline-flex; align-items: center; margin-right: 8px; }
.required { color: var(--accent, #f6c36a); font-size: 12px; margin-left: 4px; }
.save-hint { color: #f66; font-size: 12px; display: inline-flex; align-items: center; margin-right: 8px; }
.role-chip {
    border-radius: 12px;
    border: 1px solid color-mix(in srgb, var(--accent) 60%, transparent);
    padding: 4px 10px;
    color: var(--accent);
    background: color-mix(in srgb, var(--accent) 12%, transparent);
    font-size: 12px;
    letter-spacing: 0.04em;
}
.role-chip.ghost-chip {
    border-color: rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.06);
    color: rgba(244,233,245,0.85);
}
@media (min-width: 1200px) {
    .role-detail-form {
        padding: 16px 18px 110px;
        gap: 14px;
    }
}

/* Player persona */
.persona-page { padding: 10px; padding-bottom: calc(14px + env(safe-area-inset-bottom)); display: grid; gap: 12px; min-height: calc(var(--viewport-height) - 56px); }
.persona-head {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 10px;
    flex-wrap: wrap;
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    padding: 6px 4px;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.18));
    z-index: 3;
}
.persona-sub { margin: 4px 0 0; color: rgba(244,233,245,0.72); }
.persona-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
.persona-card {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 12px;
    background:
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2)),
        radial-gradient(140% 120% at 82% 12%, color-mix(in srgb, var(--accent) 10%, transparent), transparent 60%),
        rgba(14,10,16,0.8);
    box-shadow: 0 12px 28px rgba(0,0,0,0.45);
    display: grid;
    gap: 10px;
}
.persona-card-head { font-weight: 700; letter-spacing: 0.05em; margin: 0; display: flex; align-items: center; gap: 8px; }
.persona-note { margin: 0; color: rgba(244,233,245,0.68); font-size: 13px; }
.persona-form { display: grid; gap: 10px; }
.persona-form.grid-two { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.persona-card label { display: grid; gap: 6px; color: rgba(244,233,245,0.9); }
.persona-card input,
.persona-card textarea,
.persona-card select {
    font: inherit;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(0,0,0,0.2);
    color: #f4e9f5;
    cursor: text;
}
.persona-card select { cursor: pointer; }
.persona-card textarea { min-height: 140px; }
.persona-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    position: sticky;
    bottom: 8px;
    padding: 8px 4px;
    background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.5));
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 2;
}

/* Character sheet */
.character-sheet {
    position: fixed;
    top: var(--sheet-top, 12px);
    left: max(8px, env(safe-area-inset-left, 0px));
    right: max(8px, env(safe-area-inset-right, 0px));
    bottom: var(--sheet-bottom, 12px);
    margin: 0 auto;
    max-width: min(1180px, calc(100vw - 24px));
    width: min(1180px, calc(100vw - 24px));
    max-height: calc(var(--viewport-height) - 48px);
    z-index: 40;
    pointer-events: none;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.24s ease, transform 0.24s ease;
}
.character-sheet.show,
.character-sheet.open {
    pointer-events: auto;
    opacity: 1;
    transform: translateY(0);
}
.character-sheet .sheet-inner {
    height: 100%;
    max-height: calc(var(--viewport-height) - 120px);
    overflow: auto;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,0.1);
    background:
        linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.25)),
        rgba(8,6,10,0.9);
    box-shadow: 0 18px 38px rgba(0,0,0,0.6);
    padding: 14px;
}
.character-sheet .sheet-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 8px;
}
.character-sheet .sheet-head.combined { align-items: flex-start; }
.character-sheet .sheet-kicker { margin: 0; letter-spacing: 0.08em; font-size: 12px; color: rgba(244,233,245,0.65); text-transform: uppercase; }
.character-sheet .sheet-head h3 { margin: 2px 0 4px; }
.character-sheet .sheet-tagline { margin: 0; color: rgba(244,233,245,0.7); line-height: 1.4; }
.character-sheet #character-sheet-close {
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 12px;
    color: #f4e9f5;
    padding: 6px 10px;
    cursor: pointer;
}
.character-sheet .sheet-tabs {
    display: flex;
    gap: 8px;
    margin: 0 0 10px 0;
}
.character-sheet .tab-btn {
    padding: 10px 14px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.12);
    background:
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.25)),
        rgba(0,0,0,0.12);
    color: #f4e9f5;
    cursor: pointer;
    min-width: 94px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}
.character-sheet .tab-btn.active {
    border-color: color-mix(in srgb, var(--accent) 55%, transparent);
    background: color-mix(in srgb, var(--accent) 14%, transparent);
    color: var(--accent);
    box-shadow:
        0 10px 26px rgba(0,0,0,0.35),
        inset 0 0 0 1px color-mix(in srgb, var(--accent) 25%, transparent);
}
.character-sheet .sheet-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}
.character-sheet .sheet-grid.edit-grid {
    grid-template-columns: 1fr;
}
.character-sheet .info-card {
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 12px;
    background: rgba(255,255,255,0.03);
    box-shadow: 0 10px 26px rgba(0,0,0,0.35);
    max-height: 72vh;
    overflow: auto;
}
.character-sheet .card-head {
    margin: 0 0 4px 0;
    font-weight: 700;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    gap: 8px;
}
.character-sheet .card-note {
    margin: 0 0 10px 0;
    color: color-mix(in srgb, var(--accent) 85%, rgba(255,255,255,0.8));
    font-size: 12px;
}
.character-sheet .card-note.gold { color: var(--accent); }
.character-sheet .card-form {
    display: grid;
    gap: 10px;
}
.character-sheet .card-form.grid-two {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
}
.character-sheet .card-form.slim {
    grid-template-columns: 1fr;
}
.character-sheet .card-form label {
    display: grid;
    gap: 6px;
    font-size: 14px;
}
.character-sheet .card-form input,
.character-sheet .card-form textarea,
.character-sheet .card-form select {
    width: 100%;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--accent) 38%, transparent);
    background:
        linear-gradient(180deg, rgba(246,195,106,0.08), rgba(0,0,0,0.4)),
        rgba(0,0,0,0.38);
    color: #f4e9f5;
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 6px 14px rgba(0,0,0,0.35);
}
.character-sheet .card-actions.inline {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 6px;
}
.player-global-lines {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.player-global-pill {
    padding: 6px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    font-size: 12px;
    color: rgba(244,233,245,0.85);
}
.character-sheet .card-head::before {
    content: "";
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 12px color-mix(in srgb, var(--accent) 60%, transparent);
}
.global-rule-box {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 10px;
    background: rgba(255,255,255,0.04);
}
.global-rule-box .card-head.small { margin: 0 0 6px 0; font-size: 12px; letter-spacing: 0.06em; }
.global-rule-text { margin: 0; color: rgba(244,233,245,0.8); line-height: 1.6; white-space: pre-wrap; }
.global-rule-box.system-only {
    background:
        linear-gradient(140deg, rgba(246,195,106,0.08), rgba(255,255,255,0.03)),
        rgba(12,8,12,0.5);
    border-color: rgba(246,195,106,0.35);
}
@media (min-width: 1200px) {
    .character-sheet .sheet-grid.edit-grid {
        grid-template-columns: 1.1fr 0.9fr;
    }
}

@media (max-width: 720px) {
    .character-sheet {
        left: max(4px, env(safe-area-inset-left, 0px));
        right: max(4px, env(safe-area-inset-right, 0px));
        max-width: calc(100vw - 8px);
        width: calc(100vw - 8px);
    }
    .character-sheet .sheet-inner {
        padding: 12px;
    }
    .character-sheet .sheet-tabs {
        flex-wrap: wrap;
    }
    .character-sheet .sheet-grid,
    .character-sheet .sheet-grid.edit-grid {
        grid-template-columns: 1fr;
    }
    .character-sheet .info-card {
        max-height: none;
    }
}

/* Settings */
.settings-page {
    position: relative;
    width: min(1080px, calc(100vw - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 16px));
    max-width: calc(100vw - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 8px);
    margin: 0 auto;
    padding: 12px;
    display: grid;
    gap: 12px;
    background:
        linear-gradient(135deg, rgba(12,8,14,0.9), rgba(6,4,10,0.85)),
    radial-gradient(120% 120% at 20% 10%, rgba(246,195,106,0.08), transparent 60%);
    border: 1px solid rgba(246,195,106,0.18);
    box-shadow: 0 18px 48px rgba(0,0,0,0.35);
    overflow: visible;
}
.settings-page::-webkit-scrollbar {
    display: none;
}
.settings-grid {
    display: grid;
    gap: 12px;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    width: 100%;
    max-width: 1040px;
    margin: 0 auto;
}
.settings-card {
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    padding: 14px;
    background:
        linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.2)),
        radial-gradient(140% 120% at 78% 18%, color-mix(in srgb, var(--accent) 10%, transparent), transparent 60%),
        rgba(255,255,255,0.03);
    display: grid;
    gap: 10px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.45);
}
.settings-card-head { display: flex; flex-direction: column; gap: 4px; }
.settings-kicker { margin: 0; letter-spacing: 0.12em; color: rgba(244,233,245,0.65); font-size: 12px; text-transform: uppercase; }
.settings-card h3 { margin: 0; letter-spacing: 0.04em; }
.settings-toggle { display: flex; gap: 8px; }
.settings-toggle .ghost.active {
    border-color: color-mix(in srgb, var(--accent) 50%, transparent);
    background: color-mix(in srgb, var(--accent) 18%, transparent);
    color: var(--accent);
    box-shadow: 0 8px 18px rgba(0,0,0,0.35);
}
.settings-desc { margin: 0; color: rgba(244,233,245,0.7); line-height: 1.5; }
.accent-card { position: relative; overflow: hidden; }
.accent-preview {
    position: relative;
    min-height: 160px;
    border-radius: 12px;
    background:
        linear-gradient(120deg, rgba(255,255,255,0.05), rgba(0,0,0,0.35)),
        radial-gradient(140% 120% at 20% 20%, color-mix(in srgb, var(--accent-preview, var(--bg-base)) 38%, transparent), transparent 70%);
    display: grid;
    align-content: space-between;
    gap: 12px;
    padding: 14px;
    isolation: isolate;
    overflow: hidden;
}
.accent-glow {
    position: absolute;
    inset: -20%;
    background: radial-gradient(circle at 30% 30%, color-mix(in srgb, var(--accent-preview, var(--bg-base)) 45%, transparent), transparent 60%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.12), transparent 50%);
    filter: blur(0px);
    opacity: 0.6;
    z-index: 0;
}
.accent-glow.blur {
    filter: blur(24px);
    opacity: 0.5;
}
.accent-color-pick {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.accent-color-pick input[type="color"] {
    appearance: none;
    -webkit-appearance: none;
    border: none;
    width: 52px;
    height: 36px;
    border-radius: 10px;
    padding: 0;
    background: transparent;
    cursor: pointer;
    box-shadow:
        inset 0 0 0 2px rgba(255,255,255,0.2),
        0 8px 18px rgba(0,0,0,0.35);
}
.accent-color-pick input[type="color"]::-webkit-color-swatch { border: none; border-radius: 10px; }
.accent-color-pick input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
.accent-value { font-family: monospace; letter-spacing: 0.08em; }
.settings-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.settings-hint { color: var(--accent); min-height: 18px; }

@media (max-width: 720px) {
    .settings-page {
        width: calc(100% - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px));
        max-width: none;
        padding: 12px 10px;
    }
    .settings-grid {
        max-width: none;
        grid-template-columns: 1fr;
    }
    .settings-card {
        padding: 12px;
    }
}

/* Unlock */
.unlock-page {
    min-height: calc(var(--viewport-height) - (56px + env(safe-area-inset-bottom, 0px)));
    display: grid;
    place-items: center;
    padding: max(16px, calc(12px + env(safe-area-inset-top, 0px))) max(16px, calc(12px + env(safe-area-inset-right, 0px))) max(18px, calc(12px + env(safe-area-inset-bottom, 0px))) max(16px, calc(12px + env(safe-area-inset-left, 0px)));
    position: relative;
}
.unlock-gate {
    width: 100%;
    max-width: calc(100% - 2px);
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 20px;
    padding: 18px;
    background:
        radial-gradient(120% 120% at 20% 10%, color-mix(in srgb, var(--bg-glow-1) 18%, transparent), transparent 60%),
        radial-gradient(140% 140% at 80% 90%, color-mix(in srgb, var(--bg-glow-2) 20%, transparent), transparent 60%),
        linear-gradient(160deg, rgba(12,18,14,0.9), rgba(6,10,8,0.82));
    box-shadow:
        0 24px 60px rgba(0,0,0,0.75),
        inset 0 0 0 1px rgba(255,255,255,0.05);
    position: relative;
    overflow: hidden;
}
.unlock-anim {
    position: absolute;
    inset: 0;
    pointer-events: none;
}
.unlock-anim .scan-lines {
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(180deg, rgba(255,255,255,0.06) 0 1px, transparent 1px 8px);
    opacity: 0.2;
    animation: scanMove 2s linear infinite;
}
.unlock-anim .glow-bar {
    position: absolute;
    inset: -40% 10%;
    transform: translateY(-100%);
    background: radial-gradient(120% 50% at 50% 50%, color-mix(in srgb, var(--accent) 40%, transparent), transparent 60%);
    filter: blur(18px);
    animation: gateSweep 1.4s ease forwards;
    opacity: 0.6;
}
.pixel-stars {
    position: absolute;
    inset: 0;
    pointer-events: none;
}
.pixel-stars span {
    position: absolute;
    width: 6px; height: 6px;
    background: color-mix(in srgb, var(--accent) 78%, #e8ffe4);
    image-rendering: pixelated;
    box-shadow: 0 0 14px color-mix(in srgb, var(--accent) 70%, transparent);
    animation: twinkle 2.6s ease-in-out infinite, pixelFloat 5.6s ease-in-out infinite alternate;
    transform: translate3d(0,0,0) scale(var(--star-scale, 1));
    transition: left 2.6s ease, top 2.6s ease, transform 2.6s ease, opacity 2s ease;
}

.unlock-gate.ready .glow-bar { animation-play-state: paused; opacity: 0; }

.unlock-content {
    position: relative;
    z-index: 2;
    display: grid;
    gap: 8px;
}
.unlock-kicker {
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(244,233,245,0.6);
    margin: 0;
}
.unlock-sub { margin: 0; color: rgba(244,233,245,0.76); }
.unlock-form {
    display: grid;
    gap: 10px;
    margin-top: 6px;
}
.unlock-form input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.3);
    color: #f4e9f5;
    font-size: 16px;
}
.unlock-remember {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    color: rgba(244,233,245,0.8);
    cursor: pointer;
    user-select: none;
    padding: 6px 2px;
    line-height: 1.4;
    white-space: nowrap;
}
.unlock-remember input[type="checkbox"] {
    appearance: none;
    width: 16px;
    height: 16px;
    padding: 0;
    margin: 0;
    border-radius: 3px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.25);
    position: relative;
    cursor: pointer;
    flex-shrink: 0;
    box-sizing: border-box;
    display: inline-grid;
    place-items: center;
    vertical-align: middle;
}
.unlock-remember input[type="checkbox"]:checked {
    border-color: color-mix(in srgb, var(--accent) 70%, transparent);
    background: color-mix(in srgb, var(--accent) 25%, transparent);
}
.unlock-remember input[type="checkbox"]:checked::after {
    content: "✓";
    position: absolute;
    inset: 0;
    color: var(--accent);
    font-size: 12px;
    line-height: 1;
    display: grid;
    place-items: center;
}
.unlock-remember .remember-text {
    flex: 0;
    white-space: nowrap;
}
.unlock-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.unlock-actions .primary,
.unlock-actions .ghost {
    flex: 1;
    text-align: center;
}
.unlock-hint { color: var(--accent); min-height: 18px; }

@media (max-width: 540px) {
    .unlock-gate {
        padding: 16px;
    }
    .unlock-actions {
        flex-direction: column;
    }
    .unlock-actions .primary,
    .unlock-actions .ghost {
        width: 100%;
    }
}

/* Unlock splash (auto on page load) */
#unlock-splash {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 120;
    pointer-events: none;
    opacity: 0;
    transform: scale(0.99);
    transition: opacity 0.3s ease, transform 0.4s ease;
}
#unlock-splash.show {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1);
}
#unlock-splash.hide {
    opacity: 0;
    pointer-events: none;
    transform: scale(0.985);
}
#unlock-splash .unlock-splash-mask {
    position: absolute;
    inset: 0;
    background: radial-gradient(140% 140% at 10% 10%, rgba(246,195,106,0.14), transparent 55%),
        radial-gradient(140% 140% at 90% 90%, rgba(108,82,188,0.16), transparent 55%),
        rgba(6,3,10,0.82);
    backdrop-filter: blur(6px);
}
#unlock-splash .unlock-splash-panel {
    position: relative;
    width: min(360px, 90%);
    padding: 14px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(12,8,12,0.9);
    box-shadow: 0 14px 36px rgba(0,0,0,0.7), inset 0 0 0 1px rgba(255,255,255,0.04);
    overflow: hidden;
}
#unlock-splash .unlock-splash-anim .scan-lines {
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(180deg, rgba(255,255,255,0.08) 0 1px, transparent 1px 8px);
    opacity: 0.18;
    animation: scanMove 2s linear infinite;
}
#unlock-splash .unlock-splash-anim .glow-bar {
    position: absolute;
    inset: -30% 12%;
    transform: translateY(-110%);
    background: radial-gradient(120% 50% at 50% 50%, color-mix(in srgb, var(--accent) 38%, transparent), transparent 65%);
    filter: blur(12px);
    animation: gateSweep 1.2s ease forwards;
    opacity: 0.8;
}
#unlock-splash.ready .glow-bar {
    animation-play-state: paused;
    opacity: 0;
}
#unlock-splash .splash-kicker {
    margin: 0 0 4px 0;
    color: rgba(244,233,245,0.7);
    letter-spacing: 0.12em;
    font-size: 12px;
}
#unlock-splash h3 {
    margin: 0;
}
#unlock-splash .splash-sub {
    margin: 6px 0 0 0;
    color: rgba(244,233,245,0.7);
}

@keyframes scanMove {
    0% { transform: translateY(0); }
    100% { transform: translateY(10px); }
}
@keyframes gateSweep {
    0% { transform: translateY(-120%); opacity: 0.4; }
    40% { transform: translateY(0%); opacity: 0.8; }
    100% { transform: translateY(120%); opacity: 0; }
}
@keyframes twinkle {
    0%, 100% { opacity: 0.4; transform: scale(0.8); }
    50% { opacity: 1; transform: scale(1.1); }
}
@keyframes pixelFloat {
    0% { transform: translate3d(0, 0, 0) scale(var(--star-scale, 1)); }
    100% { transform: translate3d(var(--drift-x, 0px), var(--drift-y, -10px), 0) scale(var(--star-scale, 1)); }
}

@media (prefers-reduced-motion: reduce) {
    .unlock-anim .scan-lines,
    .unlock-anim .glow-bar,
    .pixel-stars span {
        animation: none;
    }
    #unlock-splash .unlock-splash-anim .scan-lines,
    #unlock-splash .unlock-splash-anim .glow-bar {
        animation: none;
    }
}

@media (max-width: 720px) {
    #app-root {
        padding: 12px;
        padding-top: calc(12px + env(safe-area-inset-top, 0px) / 2);
        padding-left: calc(12px + env(safe-area-inset-left, 0px) / 2);
        padding-right: calc(12px + env(safe-area-inset-right, 0px) / 2);
    }
    .home-actions, .msg-actions { flex-direction: column; }
}
.character-sheet input[type="number"],
.role-detail-form input[type="number"],
.home-rule-inner input[type="number"],
.home-dialog-panel input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
    padding-right: 36px;
    position: relative;
}
.character-sheet input[type="number"]::-webkit-outer-spin-button,
.character-sheet input[type="number"]::-webkit-inner-spin-button,
.role-detail-form input[type="number"]::-webkit-outer-spin-button,
.role-detail-form input[type="number"]::-webkit-inner-spin-button,
.home-rule-inner input[type="number"]::-webkit-outer-spin-button,
.home-rule-inner input[type="number"]::-webkit-inner-spin-button,
.home-dialog-panel input[type="number"]::-webkit-outer-spin-button,
.home-dialog-panel input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
.pill-input {
    border-radius: 14px;
    border: 1px solid color-mix(in srgb, var(--accent) 32%, transparent);
    background:
        linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.35)),
        rgba(0,0,0,0.38);
    color: #f4e9f5;
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 6px 14px rgba(0,0,0,0.35);
}
